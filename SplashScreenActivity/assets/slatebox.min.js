// Slatebox.js 0.5.0
// http://dev.slatebox.com
// (c) 2009-2012 Tim Heckel, Slatebox LLC
// Slatebox.js may be freely distributed under the MIT license.

// Rapha?l 2.1.0 - JavaScript Vector Library
// Copyright ? 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)
// Copyright ? 2008-2012 Sencha Labs (http://sencha.com)
// Licensed under the MIT (http://raphaeljs.com/license.html) license.

// Eve 0.3.4 - JavaScript Events Library
// Copyright (c) 2008-2011 Dmitry Baranovskiy (http://dmitry.baranovskiy.com/)
// Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.

/*!
 * SignalR JavaScript Library v1.0.0
 * http://signalr.net/
 *
 * Copyright David Fowler and Damian Edwards 2012
 * Licensed under the MIT.
 * https://github.com/SignalR/SignalR/blob/master/LICENSE.md
 */

// Underscore.js 1.4.2
// http://underscorejs.org
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore may be freely distributed under the MIT license.

// emile.js (c) 2009 Thomas Fuchs
// Licensed under the terms of the MIT license.

(function(){var d=function(e){var f=this;var g=null;if(!(f instanceof d)){return new d(e)}if(f.slate===undefined){alert("You have not included a reference to Slatebox.slate.js!")}f.slates=new Array();f._options=e;window.Slatebox.instance=f};d.trim=function(f){var g=f.replace(/^\s\s*/,""),h=/\s/,e=g.length;while(h.test(g.charAt(-e))){}return g.slice(0,e+1)};d.windowSize=function(){var f=0;var e=0;if(!window.innerWidth){if(!(document.documentElement.clientWidth==0)){f=document.documentElement.clientWidth;e=document.documentElement.clientHeight}else{f=document.body.clientWidth;e=document.body.clientHeight}}else{f=window.innerWidth;e=window.innerHeight}return{width:f,height:e}};d.clone=function(e){return JSON.parse(JSON.stringify(e))};d.isEqualTo=function(e,f){for(p in f){if(typeof(e[p])=="undefined"){return false}}for(p in f){if(f[p]){switch(typeof(f[p])){case"object":if(!f[p].equals(e[p])){return false}break;case"function":if(typeof(e[p])=="undefined"||(p!="equals"&&f[p].toString()!=e[p].toString())){return false}break;default:if(f[p]!=e[p]){return false}}}else{if(e[p]){return false}}}for(p in e){if(typeof(f[p])=="undefined"){return false}}return true};d.each=function(j,e){if(!j){return}var h,f=0,g=j.length;if(g===undefined){for(h in j){if(e.call(j[h],h,j[h])===false){break}}}else{for(var k=j[0];f<g&&e.call(k,f,k)!==false;k=j[++f]){}}return j};d.isElement=function(e){return(typeof HTMLElement==="object"?e instanceof HTMLElement:typeof e==="object"&&e.nodeType===1&&typeof e.nodeName==="string")};d.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"};d.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};d.el=function(e){return document.getElementById(e)};d.extend=function(g,e,f){if(typeof e!="object"){return g}if(g&&e){d.each(e,function(h,j){if(!f||typeof j!="function"){g[h]=j}})}return g};d.select=function(h){var f=h.indexOf(".");if(f!=-1){var j=h.slice(0,f)||"*";var g=h.slice(f+1,h.length);var e=[];d.each(document.getElementsByTagName(j),function(){if(this.className&&this.className.indexOf(g)!=-1){e.push(this)}});return e}};d.getKey=function(f){var h=0;try{h=f.keyCode}catch(g){h=f.which}return h};d.stopEvent=function(f){f=f||window.event;if(f.preventDefault){f.stopPropagation();f.preventDefault()}else{f.returnValue=false;f.cancelBubble=true}return false};d.toShortDateString=function(h){var e=h;try{var f=new Date(parseInt(h.substr(6)));e=(f.getMonth()+1)+"/"+f.getDate()+"/"+f.getFullYear()}catch(g){}return e};d.addEvent=function(f,g,e){if(f.attachEvent){f["e"+g+e]=e;f[g+e]=function(){f["e"+g+e](window.event)};f.attachEvent("on"+g,f[g+e])}else{f.addEventListener(g,e,false)}};d.removeEvent=function(f,g,e){if(f.detachEvent){f.detachEvent("on"+g,f[g+e]);f[g+e]=null}else{f.removeEventListener(g,e,false)}};d.bind=function(g,e,f){g[e]=g[e]||[];g[e].push(f)};d.imageExists=function(j,g,h){var e="temp_"+d.guid();var f=document.body.appendChild(document.createElement("img"));f.style.position="absolute";f.style.top="-10000px";f.style.left="-10000px";f.setAttribute("src",j);f.setAttribute("id",e);d.addEvent(f,"load",function(l){var k=d.getDimensions(f);document.body.removeChild(f);g.apply(this,[true,k.width,k.height,h])});d.addEvent(f,"error",function(k){document.body.removeChild(f);g.apply(this,[false,0,0,h])})};d.urlExists=function(f){var e=new XMLHttpRequest();e.open("GET",f,false);e.send();return e.status==200};d.ajax=function(k,g,e,l,n,j){n=this.ActiveXObject;k=[k,k.indexOf("?")===-1?"?":"&","guid="+d.guid()].join("");n=new (n?n:XMLHttpRequest)("Microsoft.XMLHTTP");var m=e?(l?l:"POST"):(l?l:"GET");n.open(m,k,1);n.setRequestHeader("Content-type","application/json; charset=utf-8");if(j){d.each(j,function(){n.setRequestHeader(this.n,this.v)})}n.onreadystatechange=function(){n.readyState>3&&g?g(n.responseText,n):0};n.send(e)};var c=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};d.guid=function(){return(c()+c()+c())};d.number=function(){return Math.floor(Math.random()*9999)+999};var b=document.getElementsByTagName("head")[0],a=this;d.getJSON=function(h,e){id=c()+c();var f=document.createElement("script"),g="__jsonp"+id;a[g]=e;f.src=h.replace(/\?(&|$)/,"__jsonp"+id+"$1");f.onload=function(){delete f;f=null;delete a[g]};b.appendChild(f)};d.positionedOffset=function(g){var e=0;var f=0;if(g.offsetParent){do{e+=g.offsetLeft;f+=g.offsetTop}while(g=g.offsetParent)}return{left:e,top:f}};d.getDimensions=function(e){var g=0,f=0;if(typeof e.clip!=="undefined"){g=e.clip.width;f=e.clip.height}else{if(e.style.pixelWidth){g=e.style.pixelWidth;f=e.style.pixelHeight}else{g=e.offsetWidth;f=e.offsetHeight}}return{width:g,height:f}};d.isNumeric=function(e){return !isNaN(parseFloat(e))&&isFinite(e)};d.isIE=function(){var e=999;if(navigator.appVersion.indexOf("MSIE")!==-1&&navigator.appVersion.indexOf("chromeframe")===-1){e=parseFloat(navigator.appVersion.split("MSIE")[1])}return e};d.isIpad=function(){return navigator.userAgent.match(/iPad/i)!==null};d.mousePos=function(g){if(document.all){mouseX=window.event.clientX;mouseY=window.event.clientY}else{if(g.targetTouches){if(g.targetTouches.length){var h=g.targetTouches[0];mouseX=h.clientX;mouseY=h.clientY;var f=[];for(var j in g.targetTouches){f.push({x:g.targetTouches[j].clientX,y:g.targetTouches[j].clientY})}}}else{mouseX=g.pageX;mouseY=g.pageY}}return{x:mouseX,y:mouseY,allTouches:f}};d.ensureEle=function(e){return(typeof e==="string"?document.getElementById(e):e)};d.onOff=function(f,h,g){var j=d.guid().replace("-","").substring(0,8);var e=d.ensureEle(h);e.innerHTML="<div style='cursor:pointer;overflow:hidden;width:53px;height:20px;'><img id='"+j+"' style='margin-top:0px;' src='"+f+"/public/images/checkbox-switch-stateful.png' alt='toggle'/>";d.el(j).onclick=function(k){g.apply(this,[j])};return j};d.isOn=function(f){var e=d.ensureEle(f);if(e.style.marginTop==="0px"){return false}return true};d.toggleOnOff=function(f){var e=d.ensureEle(f);if(e.style.marginTop==="0px"){e.style.marginTop="-22px"}else{e.style.marginTop="0px"}};d.div=function(j,l,m,k,g){var f="temp_"+d.guid();var e=j.appendChild(document.createElement("div"));e.style.position="absolute";e.style.top=m+"px";e.style.left=l+"px";e.style.width=k+"px";e.style.height=g+"px";e.style.border="1px solid red";e.style.backgroundColor="#f8f8f8";e.setAttribute("id",f);return f};d.fn=d.prototype={initNode:function(){var e=this;$s.each($s.fn.node.fn,function(){if(d.isFunction(this)){if(arguments[0].substring(0,1)==="_"){this.apply(e)}}})}};if(!Array.prototype.filter){Array.prototype.filter=function(e){if(this===void 0||this===null){throw new TypeError()}var j=Object(this);var g=j.length>>>0;if(typeof e!=="function"){throw new TypeError()}var h=[];var k=arguments[1];for(var f=0;f<g;f++){if(f in j){var l=j[f];if(e.call(k,l,f,j)){h.push(l)}}}return h}}window.Slatebox=d})();(function(a){a.fn.slate=function(g){if(!(this instanceof a.fn.slate)){return new a.fn.slate(g)}var j=this;j.options={id:a.guid(),container:"",instance:"",name:"",description:"",containerStyle:{width:"auto",height:"auto"},viewPort:{allowDrag:true,originalWidth:50000,width:50000,height:50000,left:5000,top:5000,zoom:{w:50000,h:50000,r:1}},events:{onNodeDragged:null,onCanvasClicked:null},enabled:true,showBirdsEye:true,sizeOfBirdsEye:200,showMultiSelect:true,showZoom:true,showStatus:true,collaboration:{allow:true,showPanel:true,panelContainer:null,useLongPolling:false,jsonp:false,localizedOnly:false,userName:"",userProfile:"",userIP:"",sizeOfBirdsEye:200,hubName:"slateHub",url:"",callbacks:{onCollaboration:null,onCollaborationStarted:null,onCollaborationWired:null,onUnauthorized:null}},isPublic:false};var f=j.options.viewPort;var d=j.options.containerStyle;var e=j.options.events;var b=j.options.collaboration;a.extend(j.options,g);a.extend(j.options.collaboration,a.extend(b,g.collaboration||{}));a.extend(j.options.viewPort,a.extend(f,g.viewPort||{}));a.extend(j.options.events,a.extend(e,g.events||{}));a.extend(j.options.containerStyle,a.extend(d,g.containerStyle||{}));if(!a.isElement(j.options.container)){j.options.container=a.el(j.options.container)}var k={statusPanelAtRest:33,statusPanelExpanded:200};function o(q){return options.ajax.rootUrl+options.ajax.urlFlavor+q}var l=[];j.glow=function(q){l.push(q.glow())};j.unglow=function(){a.each(l,function(){this.remove()});l=[]};var n=[];j.addtip=function(q){if(q){n.push(q)}};j.untooltip=function(){a.each(n,function(){this&&this.remove()})};j.save=function(){alert(Slatebox.toJSON(j))};j.reset=function(){var q=50000;j.options.viewPort={allowDrag:true,originalWidth:q,width:q,height:q,left:5000,top:5000,zoom:{w:q,h:q,r:1}};j.zoom(0,0,q,q,false);j.canvas.resize(q)};j.zoom=function(u,v,s,r,q){this.paper.setViewBox(u,v,s,r,q)};j.present=function(u){var q=[],r=null;var s=function(){if(q.length===0){if(u.nodes.length>0){var v=u.nodes.shift();r=_.detect(j.nodes.allNodes,function(x){return x.options.name==v.name});q=v.operations;u.nodeChanged&&u.nodeChanged(v)}}if(q.length>0){var w=q.shift();u.opChanged&&u.opChanged(w);m(u,r,w,function(y){var x=u.sync!==undefined?u.sync[y.operation]:false;switch(y.operation){case"zoom":x&&j.signalr&&j.signalr.send({type:"onZoom",data:{id:y.id,zoomLevel:y.zoomLevel}});break;case"position":x&&j.signalr&&j.signalr.send({type:"onNodePositioned",data:{id:y.id,location:y.location,easing:y.easing}});break}s()})}else{u.complete&&u.complete()}};s()};function m(y,w,x,v){var q=x.split("@"),u=q[1];switch(q[0]){case"zoom":var r=q.length>2?parseFloat(q[2]):y.defaultDuration;w.zoom(u,r,v);break;case"position":var s=q.length>2?q[2]:y.defaultEasing,r=q.length>3?parseFloat(q[3]):y.defaultDuration;w.position(u,v,s,r);break}}j.setSize=function(r,q){this.paper.setSize(r,q)};j.loadJSON=function(u,x){var s=this.options.enabled;if(x===undefined){this.paper.clear();j.nodes.allNodes=[]}var v=JSON.parse(u);var q=this.options.collaboration;a.extend(this.options,v.options);this.id=v.id;this.options.collaboration=q;var r=[];a.each(v.nodes,function(){var y=a.instance.node(this.options);j.nodes.add(y);r.push({bt:y,json:this})});a.each(r,function(){var y=this;y.bt.addRelationships(y.json,function(z){_.invoke(z,"toFront");y.bt.vect.toFront();y.bt.text.toFront();y.bt.link.toFront()})});var w=Math.max(this.options.viewPort.zoom.w,this.options.viewPort.zoom.h);this.zoom(0,0,w,w,false);this.canvas.resize(w);if(!s){j.disable()}};j.exportDifference=function(u){var r=a.extend({},j.options);var s=r.collaboration.panelContainer;var q=r.collaboration.callbacks;delete r.collaboration.panelContainer;delete r.collaboration.callbacks;delete r.container;delete r.events;var v={options:a.clone(r),nodes:[]};a.each(j.nodes.allNodes,function(){var w=false;var x=this;a.each(u.nodes.allNodes,function(){if(this.options.id===x.options.id){w=true;return}});if(!w){v.nodes.push(x.serialize())}});r.collaboration.panelContainer=s;r.collaboration.callbacks=q;return JSON.stringify(v)};j.exportJSON=function(){var r=j.options.container;var u=j.options.collaboration.panelContainer||null;var q=j.options.collaboration.callbacks||null;var s=j.options;delete s.container;delete s.collaboration.panelContainer;var v={id:s.id,options:a.clone(s),nodes:[]};j.options.container=r;j.options.collaboration.panelContainer=u;j.options.collaboration.callbacks=q;delete v.options.events;delete v.options.ajax;delete v.options.container;var w=[];a.each(j.nodes.allNodes,function(){v.nodes.push(this.serialize())});return JSON.stringify(v)};j.snapshot=function(){var q=JSON.parse(j.exportJSON());q.nodes.allNodes=q.nodes;return q};j.getOrientation=function(r){var A="landscape",D=j.options.viewPort.width,C=j.options.viewPort.height,E=0,F=0;var v=new Array();v.left=99999;v.right=0;v.top=99999;v.bottom=0;var u=r||j.nodes.allNodes;if(u.length>0){for(_px=0;_px<u.length;_px++){var B=10;var q=u[_px].vect.getBBox();var s=j.options.viewPort.zoom.r||1;var H=q.x*s;var I=q.y*s;var G=q.width*s;var z=q.height*s;v.left=Math.abs(Math.min(v.left,H-B));v.right=Math.abs(Math.max(v.right,H+G+B));v.top=Math.abs(Math.min(v.top,I-B));v.bottom=Math.abs(Math.max(v.bottom,I+z+B))}var D=v.right-v.left;var C=v.bottom-v.top;if(C>D){A="portrait"}}return{orientation:A,height:C,width:D,left:v.left,top:v.top}};j.resize=function(s,u,y){var q=(y||0);if(q<6){q=6}s=s-((q*2)||0);var x=j.getOrientation();var B=(x.width/s)*j.options.viewPort.width;var v=(x.height/s)*j.options.viewPort.height;var z=Math.max(B,v);var r=Math.max(j.options.viewPort.width,j.options.viewPort.height)/z;var w=x.left*r-q;var A=x.top*r-q;j.zoom(0,0,z,z,true);j.options.viewPort.zoom={w:z,h:z,l:parseInt(w*-1),t:parseInt(A*-1),r:j.options.viewPort.originalWidth/z};j.canvas.move({x:w,y:A,dur:u,isAbsolute:true})};j.stopEditing=function(){a.each(j.nodes.allNodes,function(){this.editor&&this.editor.end();this.images&&this.images.end();this.links&&this.links.end()})};var h;j.disable=function(q){a.each(j.nodes.allNodes,function(){this.disable()});h=j.options.enabled;if(q===undefined){j.options.enabled=false;j.options.viewPort.allowDrag=false}};j.enable=function(){a.each(j.nodes.allNodes,function(){this.enable()});j.options.enabled=h;j.options.viewPort.allowDrag=true};j.unMarkAll=function(){a.each(j.nodes.allNodes,function(){this.unmark()})};var c=false;j.hasChanged=function(){return c};j.setChanged=function(q){c=q};j.init=function(){if(j.options.showZoom){j.zoomSlider.show();j.zoomSlider.setValue(j.options.viewPort.width)}if(j.options.showBirdsEye){if(j.birdseye.enabled()){j.birdseye.reload(j.exportJSON())}else{j.birdseye.show({size:j.options.sizeOfBirdsEye||200,onHandleMove:function(q,r){}})}}if(j.options.collaboration&&j.options.collaboration.allow){j.signalr.init({un:j.options.collaboration.userName,up:j.options.collaboration.userProfile,ip:j.options.collaboration.userIP,hubName:j.options.collaboration.hubName,url:j.options.collaboration.url||"",callbacks:{onCollaborationWired:j.options.collaboration.callbacks.onCollaborationWired,onCollaborationStarted:j.options.collaboration.callbacks.onCollaborationStarted,onUnauthorized:j.options.collaboration.callbacks.onUnauthorized,onCollaboration:j.options.collaboration.callbacks.onCollaboration}})}if(j.options.showMultiSelect){j.multiselection&&j.multiselection.init()}};a.each(a.fn.slate.fn,function(){if(a.isFunction(this)){if(arguments[0].substring(0,1)==="_"){var q=arguments[0].replace("_","");j[q]={};j[q]=this.apply(j[q]);j[q]._=j}}});j.tempNodeId=a.guid();if(a.isFunction(j.options.onInitCompleted)){j.options.onInitCompleted.apply(this)}return j};a.fn.slate.fn=a.fn.slate.prototype={}})(Slatebox);(function($s){$s.fn.node=function(_options){if(!(this instanceof $s.fn.node)){return new $s.fn.node(_options)}var _node=this,_marker;_node.options={id:$s.guid(),name:"",text:"",isPinned:false,isPinnedExact:false,pinnedRowCount:5,image:"",imageTiled:false,xPos:0,yPos:0,height:10,width:10,borderWidth:2,lineColor:"#000000",lineWidth:3,lineOpacity:1,allowDrag:true,allowMenu:true,allowContext:true,backgroundColor:"#f8f8f8",foregroundColor:"#000",fontSize:13,fontFamily:"Trebuchet MS",fontStyle:"normal",vectorPath:"",rotationAngle:0,link:{show:false,type:"",data:"",thumbnail:{width:175,height:175}}};$s.extend(_node.options,_options);if(_node.options.name===""){_node.options.name=_node.options.id}_node.constants={statusPanelAtRest:33,statusPanelExpanded:200};_node.del=function(){var _reposParents=[],_unlinkId=_node.options.id;if(_node.options.isPinnedExact){_reposParents=_node.relationships.parents}_node.slate.nodes.closeAllMenus();_node.relationships.removeAll();_node.slate.options.viewPort.allowDrag=true;$s.each(_node.slate.nodes.allNodes,function(){if(this.options.link&&this.options.link.show&&this.options.link.data===_unlinkId){$s.extend(this.options.link,{show:false,type:"",data:""});this.link.hide()}});_node.slate.unMarkAll();_node.slate.nodes.remove(_node);$s.each(_reposParents,function(){this.parent.pinChildNodes(true)})};function url(opt){return _node.options.ajax.rootUrl+_node.options.ajax.urlFlavor+opt}_node.setStartDrag=function(){_node.slate.options.viewPort.allowDrag=false;_node.slate.stopEditing();_node.connectors&&_node.connectors.reset();_node.context&&_node.context.hide();if(_node.menu&&_node.menu.isOpen()){_node.menu.wasOpen=true}};_node.setEndDrag=function(){if(_node.slate&&_node.slate.options.enabled){_node.slate.options.viewPort.allowDrag=true}if(_node.menu&&$s.isFunction(_node.menu.show)&&_node.options.allowMenu){_node.menu.show()}};_node.serialize=function(){var jsonNode={};$s.extend(jsonNode,{options:_node.options});$s.each(["allowMenu","allowDrag"],function(){jsonNode.options[this]=true});jsonNode.relationships={parents:[],associations:[]};$s.each(_node.relationships.parents,function(){jsonNode.relationships.parents.push(bindRel(this))});$s.each(_node.relationships.associations,function(){jsonNode.relationships.associations.push(bindRel(this))});return jsonNode};function bindRel(obj){return{childId:obj.child.options.id,parentId:obj.parent.options.id,isStraightLine:obj.blnStraight,lineColor:obj.lineColor,lineOpacity:obj.lineOpacity,lineWidth:obj.lineWidth,showParentArrow:obj.showParentArrow||false,showChildArrow:obj.showChildArrow||false}}_node.addRelationships=function(json,cb){var _lines=[];if(json.relationships){if($s.isArray(json.relationships.parents)){$s.each(json.relationships.parents,function(){var _pr=this,_pn=null;$s.each(_node.slate.nodes.allNodes,function(){if(this["options"]["id"]===_pr.parentId){_pn=this;return}});if(_pn){var _conn=_node.relationships.addParent(_pn,_pr,false);_lines.push(_conn.line);_pn.pinChildNodes();return}})}if($s.isArray(json.relationships.associations)){$s.each(json.relationships.associations,function(){var _pr=this,_pn=null;$s.each(_node.slate.nodes.allNodes,function(){if(this.options.id===_pr.parentId&&_node.options.id!==this.options.id){_pn=this;return}});if(_pn){var _conn=_node.relationships.addAssociation(_pn,_pr);_lines.push(_conn.line);return}})}}if($s.isFunction(cb)){cb.apply(this,[_lines])}};_node.allAttachedRelationships=function(){var relationships=[];$s.each(_node.slate.nodes.allNodes,function(){$s.each(this.relationships.children,function(){if(this.parent.options.id===_node.options.id){relationships.push(this)}if(this.child.options.id===_node.options.id){relationships.push(this)}});$s.each(this.relationships.parents,function(){if(this.parent.options.id===_node.options.id){relationships.push(this)}if(this.child.options.id===_node.options.id){relationships.push(this)}});$s.each(this.relationships.associations,function(){if(this.parent.options.id===_node.options.id){relationships.push(this)}if(this.child.options.id===_node.options.id){relationships.push(this)}})});return relationships};_node.toFront=function(){$s.each(_node.relationships.children,function(){this.line.toFront();if(this.child.options.isPinnedExact){this.child.vect.toFront();this.child.text.toFront();this.child.link.toFront()}});_.invoke(_.pluck(_node.relationships.parents,"line"),"toFront");_.invoke(_.pluck(_node.relationships.associations,"line"),"toFront");_node.vect.toFront();_node.text.toFront();_node.link.toFront()};_node.toBack=function(){_node.link.toBack();_node.text.toBack();_node.vect.toBack();$s.each(_node.relationships.children,function(){this.line.toBack();if(this.child.options.isPinnedExact){this.child.link.toBack();this.child.text.toBack();this.child.vect.toBack()}});_.invoke(_.pluck(_node.relationships.parents,"line"),"toBack");_.invoke(_.pluck(_node.relationships.associations,"line"),"toBack")};_node.hide=function(){_node.vect.hide();_node.text.hide();_node.options.link.show&&_node.link.hide()};_node.show=function(){_node.vect.show();_node.text.show();_node.options.link.show&&_node.link.show()};function posAtt(p){switch(_node.options.vectorPath){case"ellipse":return{cx:p.x,cy:p.y};case"rectangle":case"roundedrectangle":return{x:p.x,y:p.y};default:var _animPath=Raphael.transformPath(_node.options.vectorPath,"T"+p.x+","+p.y);return{path:_animPath}}}_node.setPosition=function(p,blnKeepMenusOpen){_node.vect.attr(posAtt(p));_node.relationships.refresh();_node.options.xPos=p.x;_node.options.yPos=p.y;var lc=_node.linkCoords();_node.text.attr(_node.textCoords());_node.link.transform(["t",lc.x,",",lc.y,"s",".8",",",".8","r","180"].join());if(blnKeepMenusOpen!==true){_node.slate.nodes.closeAllMenus()}_node.pinChildNodes()};_node.refresh=function(){_node.relationships.refresh();_node.pinChildNodes(true);if(_node.options.isPinnedExact){$s.each(_node.relationships.parents,function(){this.parent.relationships.refresh();this.parent.pinChildNodes(true)})}};_node.move=function(pkg){var p=pkg.data||pkg;var d=p.dur||500;var e=p.easing||">";var lx=p.x-5;var tx=p.x+(_node.options.width/2);var ty=p.y+(_node.options.height/2);if(_node.vect.type!=="rect"){tx=p.x;ty=p.y}_node.link.hide();_node.menu.hide();var onAnimate=function(){var dx=_node.options.vectorPath==="ellipse"?_node.vect.attr("cx"):_node.vect.attr("x");var dy=_node.options.vectorPath==="ellipse"?_node.vect.attr("cy"):_node.vect.attr("y");_node.options.yPos=dy;_node.options.xPos=dx;_node.refresh()};eve.on("raphael.anim.frame.*",onAnimate);_node.text.animate({x:tx,y:ty},d,e);_node.link.animate({x:lx,y:ty},d,e);var att={};switch(_node.options.vectorPath){case"ellipse":att={cx:p.x,cy:p.y};break;case"rectangle":case"roundedrectangle":att={x:p.x,y:p.y};break;default:var _animPath=Raphael.transformPath(_node.options.vectorPath,"T"+p.x+","+p.y);att={path:_animPath};break}_node.vect.animate(att,d,e,function(){_node.options.yPos=p.y;_node.options.xPos=p.x;_node.refresh();eve.unbind("raphael.anim.frame.*",onAnimate);var lc=_node.linkCoords();_node.link.transform(["t",lc.x,",",lc.y,"s",".8",",",".8","r","180"].join());if(_node.options.link&&_node.options.link.show){_node.link.show()}_node.slate.birdseye&&_node.slate.birdseye.refresh(true);pkg.cb&&pkg.cb()})};_node.zoom=function(zoomPercent,duration,cb){_node.slate.canvas.zoom({dur:duration,zoomPercent:zoomPercent,callbacks:{during:function(percentComplete,easing){},after:function(zoomVal){cb&&cb.apply(this,[{id:_node.options.id,operation:"zoom",zoomLevel:zoomVal}])}}})};_node.position=function(location,cb,easing,dur){easing=easing||"swingFromTo";dur=dur||1000;var _vpt=_node.vect.getBBox(),zr=_node.slate.options.viewPort.zoom.r;var d=$s.getDimensions(_node.slate.options.container);var cw=d.width,ch=d.height,nw=_node.options.width*zr,nh=_node.options.height*zr,pad=10;var _x=(_vpt.x*zr);var _y=(_vpt.y*zr);switch(location){case"lowerright":_x=_x-(cw-nw)-pad;_y=_y-(ch-nh)-pad;break;case"lowerleft":_x=_x-pad;_y=_y-(ch-nh)-pad;break;case"upperright":_x=_x-(cw-nw)-pad;_y=_y-pad;break;case"upperleft":_x=_x-pad;_y=_y-pad;break;default:_x=_x-(cw/2-nw/2);_y=_y-(ch/2-nh/2);break}if(_x===_node.slate.options.viewPort.left&&_y===_node.slate.options.viewPort.top){cb.apply()}else{_node.slate.canvas.move({x:_x,y:_y,dur:dur,callbacks:{after:function(){cb.apply(this,[{id:_node.options.id,operation:"position",location:location,easing:easing}])}},isAbsolute:true,easing:easing})}};_node.mark=function(){var _vpt=_node.vect.getBBox(),_x=_vpt.x,_y=_vpt.y;if(!_marker){_marker=_node.slate.paper.rect(_x-10,_y-10,_node.options.width+20,_node.options.height+20,10).attr({"stroke-width":_node.options.borderWidth,stroke:"red",fill:"#ccc","fill-opacity":0.8}).toBack()}else{_marker.attr({x:(_x-10),y:(_y-10),width:(_node.options.width+20),height:(_node.options.height+20)})}};_node.unmark=function(){_marker&&_marker.remove();_marker=null};var lm;_node.unbutton=function(){lm&&lm.unbutton()};_node.button=function(options){lm=_node.slate.paper.set();lm.push(_node.vect);lm.push(_node.text);$s.extend(options,{node:_node});lm.button(options)};_node.disable=function(){_node.options.allowMenu=false;_node.options.allowDrag=false;_node.relationships.unwireHoverEvents()};_node.enable=function(){_node.options.allowMenu=true;_node.options.allowDrag=true;_node.relationships.wireHoverEvents()};_node.offset=function(){var _x=_node.options.xPos-_node.slate.options.viewPort.left;var _y=_node.options.yPos-_node.slate.options.viewPort.top;if(_node.options.vectorPath==="ellipse"){_x=_x-(_node.options.width/2);_y=_y-(_node.options.height/2)}return{x:_x,y:_y}};_node.pinChildNodes=function(){var pinRow=3,totPinned=0,mxHeight=0,ypad=20,xpad=20;var _y=_node.options.yPos+(_node.options.vectorPath==="ellipse"?_node.options.height/2:_node.options.height)+ypad;var widthx=[];var xys=[];var xyst=[];$s.each(_node.relationships.children,function(){if(this.child.options.isPinnedExact){totPinned++;mxHeight=Math.max(mxHeight,this.child.options.height);widthx.push(this.child.options.width+xpad);var tot=0;$s.each(widthx,function(){tot+=this});var edge=tot/2;var offs=this.child.options.vectorPath==="ellipse"?0:_node.options.width/2;var baseX=_node.options.xPos+offs-edge+xpad/2;xyst=[];for(wx=0;wx<widthx.length;wx++){xyst.push({y:_y,x:baseX});baseX+=widthx[wx]}if(totPinned%_node.options.pinnedRowCount===0){_y+=mxHeight+ypad;$s.each(xyst,function(){xys.push(this)});widthx=[];xyst=[]}}else{if(this.child.options.isPinned){}}});$s.each(xyst,function(){xys.push(this)});var pi=-1;$s.each(_node.relationships.children,function(){if(this.child.options.isPinnedExact){pi++;var _x=this.child.options.vectorPath==="ellipse"?xys[pi].x+(this.child.options.width/2):xys[pi].x;var _y=this.child.options.vectorPath==="ellipse"?xys[pi].y+(this.child.options.height/2):xys[pi].y;this.child.setPosition({x:_x,y:_y},true)}});if(xys.length===0){return{x:0,y:0}}return{x:xys[xys.length-1].x,y:xys[xys.length-1].y}};_node.textCoords=function(){var tx=_node.options.xPos+(_node.options.width/2);var ty=_node.options.yPos+(_node.options.height/2);if(_node.vect.type!=="rect"){tx=_node.options.xPos;ty=_node.options.yPos}return{x:tx,y:ty}};_node.linkCoords=function(){var x=_node.options.xPos-20;var y=_node.options.yPos+(_node.options.height/2)-22;if(_node.vect.type!=="rect"){y=_node.options.yPos-22;x=(_node.options.xPos-_node.options.width/2)-20}return{x:x,y:y}};_node.animCoords=function(){var att=_self._.options.vectorPath==="ellipse"?{cx:_self._.vect.ox+dx,cy:_self._.vect.oy+dy}:{x:_self._.vect.ox+dx,y:_self._.vect.oy+dy}};_node.init=function(){if(_node.options.id>-1){$s.ajax(url(_node.options.ajax.nodeCreated),function(respText,resp){_node.options.holdData=eval("("+respText+")");bindSlates(_node.options.holdData)},JSON.stringify(_node.options))}};_node.rotate=function(_opts){var opts={angle:0,cb:null,dur:0};$s.extend(opts,_opts);var ta=["r",opts.angle].join("");if(opts.dur===0){_node.vect.transform(ta);_node.text.transform(ta);if(_node.options.link.show){_node.link.transform(ta)}opts.cb&&opts.cb()}else{var lm=_node.slate.paper.set();lm.push(_node.vect);lm.push(_node.text);if(_node.options.link.show){lm.push(_node.link)}lm.animate({transform:ta},opts.dur,">",function(){opts.cb&&opts.cb()})}};$s.each($s.fn.node.fn,function(){if(Slatebox.isFunction(this)){if(arguments[0].substring(0,1)==="_"){var p=arguments[0].replace("_","");_node[p]={};_node[p]=this.apply(_node[p]);_node[p]._=_node}}});return _node};$s.fn.node.fn=$s.fn.node.prototype={}})(Slatebox);(function(c,b){var g=document.createElement("div"),h=("backgroundColor borderBottomColor borderBottomWidth borderLeftColor borderLeftWidth borderRightColor borderRightWidth borderSpacing borderTopColor borderTopWidth bottom color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex").split(" ");function d(l,m,k){return(l+(m-l)*k).toFixed(3)}function j(m,l,k){return m.substr(l,k||1)}function a(q,s,n){var l=2,m,k,u,w=[],o=[];while(m=3,k=arguments[l-1],l--){if(j(k,0)=="r"){k=k.match(/\d+/g);while(m--){w.push(~~k[m])}}else{if(k.length==4){k="#"+j(k,1)+j(k,1)+j(k,2)+j(k,2)+j(k,3)+j(k,3)}while(m--){w.push(parseInt(j(k,1+m*2,2),16))}}}while(m--){u=~~(w[m+3]+(w[m]-w[m+3])*n);o.push(u<0?0:u>255?255:u)}return"rgb("+o.join(",")+")"}function f(l){var k=parseFloat(l),m=l.replace(/^[\-\d\.]+/,"");return isNaN(k)?{v:m,f:a,u:""}:{v:k,f:d,u:m}}function e(n){var k,m={},l=h.length,o;g.innerHTML='<div style="'+n+'"></div>';k=g.childNodes[0].style;while(l--){if(o=k[h[l]]){m[h[l]]=f(o)}}return m}b[c]=function(o,w,s){o=typeof o=="string"?document.getElementById(o):o;s=s||{};var x=e(w),k=o.currentStyle?o.currentStyle:getComputedStyle(o,null),u,l={},v=+new Date,m=s.duration||200,q=v+m,r,n=s.easing||function(y){return(-Math.cos(y*Math.PI)/2)+0.5};for(u in x){l[u]=f(k[u])}r=setInterval(function(){var z=+new Date,y=z>q?1:(z-v)/m;for(u in x){var A=s.onMove?s.onMove(u):x[u].f(l[u].v,x[u].v,n(y));o.style[u]=A+x[u].u}if(z>q){clearInterval(r);s.after&&s.after()}else{s.during&&s.during.apply(this,[(z-v)/m])}},10)}})("emile",this);(function(b,a){var c=function(){var d=this;if(!(d instanceof Notify)){return new Notify()}var f=b.guid();var e={msg:"",hgt:50,duration:300,className:"warningBar",delayClose:0,spinner:null,hideClose:false,onOpen:null,msgBar:"messageBar"+f,popFromBottom:false};d.message=function(h){b.extend(e,h);b.each(b.select("div.notify"),function(){this.style.visibility="hidden"});if(b.el(e.msgBar)&&b.el(e.msgBar).style.visibility==="visible"){var g=b.getDimensions(b.el(e.msgBar)).height;a(b.el(e.msgBar),"top:"+g*-1+"px",{duration:e.duration,after:function(){if(b.el(e.msgBar)!==null){document.body.removeChild(b.el(e.msgBar))}j()}})}else{j()}function j(){var l="<div style='min-width:950px;'><div id='msgSpinner_"+f+"' style='padding:2px;float:left;width:30px;'></div><div style='text-align:left;padding: 10px;float:left;width:84%;' id='notifyBarMessage_"+f+"'>"+e.msg+"</div><div style='float:right;margin-top:6px;padding-right:2px;width:4%;'><a href='javascript:' class='lnkCloseMessage uk-button uk-button-success' id='lnkCloseMessage_"+f+"'>บันทึก</a></div></div>";var m=document.createElement("div");m.setAttribute("class",e.className+" notify");m.setAttribute("rel",e.popFromBottom);m.style.position="absolute";m.style.height=e.hgt+"px";var k="top:0px";if(e.popFromBottom){var n=b.windowSize();m.style.top=(n.height+e.hgt)+"px";k="top:"+(n.height-e.hgt)+"px"}else{m.style.top=(e.hgt*-1)+"px"}m.setAttribute("id",e.msgBar);m.innerHTML=l;document.body.appendChild(m);a(b.el(e.msgBar),k,{duration:e.duration,after:function(){if(e.spinner){e.spinner=new spinner(b.el("msgSpinner_"+f),e.spinner.innerDiameter,e.spinner.outerDiameter,e.spinner.ticks,e.spinner.ticksWidth,e.spinner.color)}if(!e.hideClose){b.el("lnkCloseMessage_"+f).onclick=function(o){o.preventDefault();d.closeMessage()}}else{b.el("lnkCloseMessage_"+f).style.display="none"}if(e.delayClose&&e.delayClose>0){setTimeout(function(){if(b.isFunction(e.spinner)){e.spinner()}setTimeout(function(){d.closeMessage()},e.duration)},e.delayClose)}if(b.isFunction(e.onOpen)){e.onOpen.apply(this,[b.el("notifyBarMessage_"+f),d])}}})}return d};d.changeMessage=function(g){b.el("notifyBarMessage_"+f).innerHTML=g;return d};d.visible=function(){return b.el(e.msgBar)!==null};d.resize=function(l,k,j){if(b.el(e.msgBar)!==null){var g="top:"+(l*-1)+"px";if(e.popFromBottom){g="top:"+(b.windowSize().height-l)+"px"}a(b.el(e.msgBar),g,{duration:k,after:function(){if(b.isFunction(j)){j.apply(this)}}})}else{if(b.isFunction(j)){j.apply(this)}}};d.closeMessage=function(h){if(b.el(e.msgBar)!==null){var g="top:"+(e.hgt*-1)+"px";if(e.popFromBottom){g="top:"+(b.windowSize().height+e.hgt)+"px"}a(b.el(e.msgBar),g,{duration:e.duration,after:function(){document.body.removeChild(b.el(e.msgBar));b.each(b.select("div.notify"),function(){this.style.visibility="visible"});if(b.isFunction(e.onClose)){e.onClose.apply(this)}if(b.isFunction(h)){h.apply(this)}}})}else{if(b.isFunction(h)){h.apply(this)}}}};b.addEvent(window,"resize",function(){b.each(b.select("div.notify"),function(){if(this.getAttribute("rel")==="true"){var f=b.windowSize();var e=b.getDimensions(this);this.style.top=(f.height-e.height)+"px"}})});window.Notify=c})(Slatebox,emile);spinner=(function(){var a=function b(l,u,w,h,A,f){var y=h||12,e=f||"#fff",D=A||15,s=Math.min(u,w)||35,v=Math.max(u,w)||60,j=v+D,k=v+D,q=Raphael(l,v*2+D*2,v*2+D*2),x=[],n=[],d=2*Math.PI/y,o={stroke:e,"stroke-width":D,"stroke-linecap":"round"};Raphael.getColor.reset();for(var m=0;m<y;m++){var c=d*m-Math.PI/2,g=Math.cos(c),z=Math.sin(c);n[m]=1/y*m;x[m]=q.path([["M",j+s*g,k+s*z],["L",j+v*g,k+v*z]]).attr(o);if(e=="rainbow"){x[m].attr("stroke",Raphael.getColor())}}var B;(function C(){n.unshift(n.pop());for(var r=0;r<y;r++){x[r].attr("opacity",n[r])}q.safari();B=setTimeout(C,1000/y)})();return function(){clearTimeout(B);q.clear()}};return a})();(function(){var N=this;var K=N._;var e={};var c=Array.prototype,J=Object.prototype,q=Function.prototype;var L=c.push,O=c.slice,f=c.concat,Q=c.unshift,P=J.toString,s=J.hasOwnProperty;var z=c.forEach,E=c.map,F=c.reduce,G=c.reduceRight,y=c.filter,x=c.every,H=c.some,A=c.indexOf,D=c.lastIndexOf,B=Array.isArray,C=Object.keys,w=q.bind;var a=function(R){if(R instanceof a){return R}if(!(this instanceof a)){return new a(R)}this._wrapped=R};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=a}exports._=a}else{N._=a}a.VERSION="1.4.2";var h=a.each=a.forEach=function(W,T,R){if(W==null){return}if(z&&W.forEach===z){W.forEach(T,R)}else{if(W.length===+W.length){for(var S=0,V=W.length;S<V;S++){if(T.call(R,W[S],S,W)===e){return}}}else{for(var U in W){if(a.has(W,U)){if(T.call(R,W[U],U,W)===e){return}}}}}};a.map=a.collect=function(T,S,R){var U=[];if(T==null){return U}if(E&&T.map===E){return T.map(S,R)}h(T,function(X,V,W){U[U.length]=S.call(R,X,V,W)});return U};a.reduce=a.foldl=a.inject=function(V,T,U,R){var S=arguments.length>2;if(V==null){V=[]}if(F&&V.reduce===F){if(R){T=a.bind(T,R)}return S?V.reduce(T,U):V.reduce(T)}h(V,function(Y,W,X){if(!S){U=Y;S=true}else{U=T.call(R,U,Y,W,X)}});if(!S){throw new TypeError("Reduce of empty array with no initial value")}return U};a.reduceRight=a.foldr=function(X,T,W,R){var S=arguments.length>2;if(X==null){X=[]}if(G&&X.reduceRight===G){if(R){T=a.bind(T,R)}return arguments.length>2?X.reduceRight(T,W):X.reduceRight(T)}var V=X.length;if(V!==+V){var U=a.keys(X);V=U.length}h(X,function(aa,Y,Z){Y=U?U[--V]:--V;if(!S){W=X[Y];S=true}else{W=T.call(R,W,X[Y],Y,Z)}});if(!S){throw new TypeError("Reduce of empty array with no initial value")}return W};a.find=a.detect=function(T,S,R){var U;b(T,function(X,V,W){if(S.call(R,X,V,W)){U=X;return true}});return U};a.filter=a.select=function(T,S,R){var U=[];if(T==null){return U}if(y&&T.filter===y){return T.filter(S,R)}h(T,function(X,V,W){if(S.call(R,X,V,W)){U[U.length]=X}});return U};a.reject=function(T,S,R){return a.filter(T,function(W,U,V){return !S.call(R,W,U,V)},R)};a.every=a.all=function(T,S,R){S||(S=a.identity);var U=true;if(T==null){return U}if(x&&T.every===x){return T.every(S,R)}h(T,function(X,V,W){if(!(U=U&&S.call(R,X,V,W))){return e}});return !!U};var b=a.some=a.any=function(T,S,R){S||(S=a.identity);var U=false;if(T==null){return U}if(H&&T.some===H){return T.some(S,R)}h(T,function(X,V,W){if(U||(U=S.call(R,X,V,W))){return e}});return !!U};a.contains=a.include=function(S,T){var R=false;if(S==null){return R}if(A&&S.indexOf===A){return S.indexOf(T)!=-1}R=b(S,function(U){return U===T});return R};a.invoke=function(T,S){var R=O.call(arguments,2);return a.map(T,function(U){return(a.isFunction(S)?S:U[S]).apply(U,R)})};a.pluck=function(S,R){return a.map(S,function(T){return T[R]})};a.where=function(S,R){if(a.isEmpty(R)){return[]}return a.filter(S,function(U){for(var T in R){if(R[T]!==U[T]){return false}}return true})};a.max=function(T,S,R){if(!S&&a.isArray(T)&&T[0]===+T[0]&&T.length<65535){return Math.max.apply(Math,T)}if(!S&&a.isEmpty(T)){return -Infinity}var U={computed:-Infinity};h(T,function(Y,W,X){var V=S?S.call(R,Y,W,X):Y;V>=U.computed&&(U={value:Y,computed:V})});return U.value};a.min=function(T,S,R){if(!S&&a.isArray(T)&&T[0]===+T[0]&&T.length<65535){return Math.min.apply(Math,T)}if(!S&&a.isEmpty(T)){return Infinity}var U={computed:Infinity};h(T,function(Y,W,X){var V=S?S.call(R,Y,W,X):Y;V<U.computed&&(U={value:Y,computed:V})});return U.value};a.shuffle=function(S){var T;var R=0;var U=[];h(S,function(V){T=a.random(R++);U[R-1]=U[T];U[T]=V});return U};var v=function(R){return a.isFunction(R)?R:function(S){return S[R]}};a.sortBy=function(T,U,R){var S=v(U);return a.pluck(a.map(T,function(X,V,W){return{value:X,index:V,criteria:S.call(R,X,V,W)}}).sort(function(X,Y){var V=X.criteria;var W=Y.criteria;if(V!==W){if(V>W||V===void 0){return 1}if(V<W||W===void 0){return -1}}return X.index<Y.index?-1:1}),"value")};var r=function(U,W,S,R){var V={};var T=v(W);h(U,function(Z,X){var Y=T.call(S,Z,X,U);R(V,Y,Z)});return V};a.groupBy=function(S,T,R){return r(S,T,R,function(V,U,W){(a.has(V,U)?V[U]:(V[U]=[])).push(W)})};a.countBy=function(S,T,R){return r(S,T,R,function(V,U,W){if(!a.has(V,U)){V[U]=0}V[U]++})};a.sortedIndex=function(R,X,U,S){U=U==null?a.identity:v(U);var Y=U.call(S,X);var V=0,T=R.length;while(V<T){var W=(V+T)>>>1;U.call(S,R[W])<Y?V=W+1:T=W}return V};a.toArray=function(R){if(!R){return[]}if(R.length===+R.length){return O.call(R)}return a.values(R)};a.size=function(R){if(R==null){return 0}return(R.length===+R.length)?R.length:a.keys(R).length};a.first=a.head=a.take=function(R,T,S){if(R==null){return void 0}return(T!=null)&&!S?O.call(R,0,T):R[0]};a.initial=function(R,T,S){return O.call(R,0,R.length-((T==null)||S?1:T))};a.last=function(R,T,S){if(R==null){return void 0}if((T!=null)&&!S){return O.call(R,Math.max(R.length-T,0))}else{return R[R.length-1]}};a.rest=a.tail=a.drop=function(R,T,S){return O.call(R,(T==null)||S?1:T)};a.compact=function(R){return a.filter(R,function(S){return !!S})};var o=function(R,T,S){h(R,function(U){if(a.isArray(U)){T?L.apply(S,U):o(U,T,S)}else{S.push(U)}});return S};a.flatten=function(R,S){return o(R,S,[])};a.without=function(R){return a.difference(R,O.call(arguments,1))};a.uniq=a.unique=function(R,U,V,S){var T=V?a.map(R,V,S):R;var W=[];var X=[];h(T,function(Z,Y){if(U?(!Y||X[X.length-1]!==Z):!a.contains(X,Z)){X.push(Z);W.push(R[Y])}});return W};a.union=function(){return a.uniq(f.apply(c,arguments))};a.intersection=function(R){var S=O.call(arguments,1);return a.filter(a.uniq(R),function(T){return a.every(S,function(U){return a.indexOf(U,T)>=0})})};a.difference=function(R){var S=f.apply(c,O.call(arguments,1));return a.filter(R,function(T){return !a.contains(S,T)})};a.zip=function(){var R=O.call(arguments);var T=a.max(a.pluck(R,"length"));var U=new Array(T);for(var S=0;S<T;S++){U[S]=a.pluck(R,""+S)}return U};a.object=function(T,V){if(T==null){return{}}var U={};for(var R=0,S=T.length;R<S;R++){if(V){U[T[R]]=V[R]}else{U[T[R][0]]=T[R][1]}}return U};a.indexOf=function(R,U,T){if(R==null){return -1}var S=0,V=R.length;if(T){if(typeof T=="number"){S=(T<0?Math.max(0,V+T):T)}else{S=a.sortedIndex(R,U);return R[S]===U?S:-1}}if(A&&R.indexOf===A){return R.indexOf(U,T)}for(;S<V;S++){if(R[S]===U){return S}}return -1};a.lastIndexOf=function(R,V,S){if(R==null){return -1}var T=S!=null;if(D&&R.lastIndexOf===D){return T?R.lastIndexOf(V,S):R.lastIndexOf(V)}var U=(T?S:R.length);while(U--){if(R[U]===V){return U}}return -1};a.range=function(U,W,V){if(arguments.length<=1){W=U||0;U=0}V=arguments[2]||1;var S=Math.max(Math.ceil((W-U)/V),0);var R=0;var T=new Array(S);while(R<S){T[R++]=U;U+=V}return T};var g=function(){};a.bind=function d(U,T){var S,R;if(U.bind===w&&w){return w.apply(U,O.call(arguments,1))}if(!a.isFunction(U)){throw new TypeError}R=O.call(arguments,2);return S=function(){if(!(this instanceof S)){return U.apply(T,R.concat(O.call(arguments)))}g.prototype=U.prototype;var W=new g;var V=U.apply(W,R.concat(O.call(arguments)));if(Object(V)===V){return V}return W}};a.bindAll=function(S){var R=O.call(arguments,1);if(R.length==0){R=a.functions(S)}h(R,function(T){S[T]=a.bind(S[T],S)});return S};a.memoize=function(R,S){var T={};S||(S=a.identity);return function(){var U=S.apply(this,arguments);return a.has(T,U)?T[U]:(T[U]=R.apply(this,arguments))}};a.delay=function(S,T){var R=O.call(arguments,2);return setTimeout(function(){return S.apply(null,R)},T)};a.defer=function(R){return a.delay.apply(a,[R,1].concat(O.call(arguments,1)))};a.throttle=function(T,Y){var S,R,X,W;var V=0;var U=function(){V=new Date;X=null;W=T.apply(S,R)};return function(){var Z=new Date;var aa=Y-(Z-V);S=this;R=arguments;if(aa<=0){clearTimeout(X);V=Z;W=T.apply(S,R)}else{if(!X){X=setTimeout(U,aa)}}return W}};a.debounce=function(R,V,S){var U,T;return function(){var Y=this,W=arguments;var Z=function(){U=null;if(!S){T=R.apply(Y,W)}};var X=S&&!U;clearTimeout(U);U=setTimeout(Z,V);if(X){T=R.apply(Y,W)}return T}};a.once=function(R){var T=false,S;return function(){if(T){return S}T=true;S=R.apply(this,arguments);R=null;return S}};a.wrap=function(R,S){return function(){var T=[R];L.apply(T,arguments);return S.apply(this,T)}};a.compose=function(){var R=arguments;return function(){var S=arguments;for(var T=R.length-1;T>=0;T--){S=[R[T].apply(this,S)]}return S[0]}};a.after=function(S,R){if(S<=0){return R()}return function(){if(--S<1){return R.apply(this,arguments)}}};a.keys=C||function(T){if(T!==Object(T)){throw new TypeError("Invalid object")}var S=[];for(var R in T){if(a.has(T,R)){S[S.length]=R}}return S};a.values=function(S){var T=[];for(var R in S){if(a.has(S,R)){T.push(S[R])}}return T};a.pairs=function(S){var T=[];for(var R in S){if(a.has(S,R)){T.push([R,S[R]])}}return T};a.invert=function(S){var T={};for(var R in S){if(a.has(S,R)){T[S[R]]=R}}return T};a.functions=a.methods=function(T){var S=[];for(var R in T){if(a.isFunction(T[R])){S.push(R)}}return S.sort()};a.extend=function(R){h(O.call(arguments,1),function(T){for(var S in T){R[S]=T[S]}});return R};a.pick=function(T){var R={};var S=f.apply(c,O.call(arguments,1));h(S,function(U){if(U in T){R[U]=T[U]}});return R};a.omit=function(U){var R={};var T=f.apply(c,O.call(arguments,1));for(var S in U){if(!a.contains(T,S)){R[S]=U[S]}}return R};a.defaults=function(R){h(O.call(arguments,1),function(T){for(var S in T){if(R[S]==null){R[S]=T[S]}}});return R};a.clone=function(R){if(!a.isObject(R)){return R}return a.isArray(R)?R.slice():a.extend({},R)};a.tap=function(S,R){R(S);return S};var l=function(R,U,T,W){if(R===U){return R!==0||1/R==1/U}if(R==null||U==null){return R===U}if(R instanceof a){R=R._wrapped}if(U instanceof a){U=U._wrapped}var X=P.call(R);if(X!=P.call(U)){return false}switch(X){case"[object String]":return R==String(U);case"[object Number]":return R!=+R?U!=+U:(R==0?1/R==1/U:R==+U);case"[object Date]":case"[object Boolean]":return +R==+U;case"[object RegExp]":return R.source==U.source&&R.global==U.global&&R.multiline==U.multiline&&R.ignoreCase==U.ignoreCase}if(typeof R!="object"||typeof U!="object"){return false}var Z=T.length;while(Z--){if(T[Z]==R){return W[Z]==U}}T.push(R);W.push(U);var ab=0,aa=true;if(X=="[object Array]"){ab=R.length;aa=ab==U.length;if(aa){while(ab--){if(!(aa=l(R[ab],U[ab],T,W))){break}}}}else{var S=R.constructor,V=U.constructor;if(S!==V&&!(a.isFunction(S)&&(S instanceof S)&&a.isFunction(V)&&(V instanceof V))){return false}for(var Y in R){if(a.has(R,Y)){ab++;if(!(aa=a.has(U,Y)&&l(R[Y],U[Y],T,W))){break}}}if(aa){for(Y in U){if(a.has(U,Y)&&!(ab--)){break}}aa=!ab}}T.pop();W.pop();return aa};a.isEqual=function(R,S){return l(R,S,[],[])};a.isEmpty=function(S){if(S==null){return true}if(a.isArray(S)||a.isString(S)){return S.length===0}for(var R in S){if(a.has(S,R)){return false}}return true};a.isElement=function(R){return !!(R&&R.nodeType===1)};a.isArray=B||function(R){return P.call(R)=="[object Array]"};a.isObject=function(R){return R===Object(R)};h(["Arguments","Function","String","Number","Date","RegExp"],function(R){a["is"+R]=function(S){return P.call(S)=="[object "+R+"]"}});if(!a.isArguments(arguments)){a.isArguments=function(R){return !!(R&&a.has(R,"callee"))}}if(typeof(/./)!=="function"){a.isFunction=function(R){return typeof R==="function"}}a.isFinite=function(R){return isFinite(R)&&!isNaN(parseFloat(R))};a.isNaN=function(R){return a.isNumber(R)&&R!=+R};a.isBoolean=function(R){return R===true||R===false||P.call(R)=="[object Boolean]"};a.isNull=function(R){return R===null};a.isUndefined=function(R){return R===void 0};a.has=function(S,R){return s.call(S,R)};a.noConflict=function(){N._=K;return this};a.identity=function(R){return R};a.times=function(U,T,R){for(var S=0;S<U;S++){T.call(R,S)}};a.random=function(S,R){if(R==null){R=S;S=0}return S+(0|Math.random()*(R-S+1))};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};j.unescape=a.invert(j.escape);var k={escape:new RegExp("["+a.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+a.keys(j.unescape).join("|")+")","g")};a.each(["escape","unescape"],function(R){a[R]=function(S){if(S==null){return""}return(""+S).replace(k[R],function(T){return j[R][T]})}});a.result=function(R,S){if(R==null){return null}var T=R[S];return a.isFunction(T)?T.call(R):T};a.mixin=function(R){h(a.functions(R),function(T){var S=a[T]=R[T];a.prototype[T]=function(){var U=[this._wrapped];L.apply(U,arguments);return M.call(this,S.apply(a,U))}})};var u=0;a.uniqueId=function(S){var R=u++;return S?S+R:R};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/;var n={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var m=/\\|'|\r|\n|\t|\u2028|\u2029/g;a.template=function(Z,R,W){W=a.defaults({},W,a.templateSettings);var U=new RegExp([(W.escape||I).source,(W.interpolate||I).source,(W.evaluate||I).source].join("|")+"|$","g");var T=0;var X="__p+='";Z.replace(U,function(ad,aa,ac,ab,ae){X+=Z.slice(T,ae).replace(m,function(af){return"\\"+n[af]});X+=aa?"'+\n((__t=("+aa+"))==null?'':_.escape(__t))+\n'":ac?"'+\n((__t=("+ac+"))==null?'':__t)+\n'":ab?"';\n"+ab+"\n__p+='":"";T=ae+ad.length});X+="';\n";if(!W.variable){X="with(obj||{}){\n"+X+"}\n"}X="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+X+"return __p;\n";try{var V=new Function(W.variable||"obj","_",X)}catch(S){S.source=X;throw S}if(R){return V(R,a)}var Y=function(aa){return V.call(this,aa,a)};Y.source="function("+(W.variable||"obj")+"){\n"+X+"}";return Y};a.chain=function(R){return a(R).chain()};var M=function(R){return this._chain?a(R).chain():R};a.mixin(a);h(["pop","push","reverse","shift","sort","splice","unshift"],function(S){var R=c[S];a.prototype[S]=function(){var T=this._wrapped;R.apply(T,arguments);if((S=="shift"||S=="splice")&&T.length===0){delete T[0]}return M.call(this,T)}});h(["concat","join","slice"],function(S){var R=c[S];a.prototype[S]=function(){return M.call(this,R.apply(this._wrapped,arguments))}});a.extend(a.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);
/*
 * SignalR JavaScript Library v1.0.0
 * http://signalr.net/
 *
 * Copyright David Fowler and Damian Edwards 2012
 * Licensed under the MIT.
 * https://github.com/SignalR/SignalR/blob/master/LICENSE.md
 */
(function(a,l){if(typeof(a)!=="function"){throw new Error("SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.")}if(!l.JSON){throw new Error("SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.")}var k,b,c=(l.document.readyState==="complete"),d=a(l),f={onStart:"onStart",onStarting:"onStarting",onSending:"onSending",onReceived:"onReceived",onError:"onError",onConnectionSlow:"onConnectionSlow",onReconnect:"onReconnect",onStateChanged:"onStateChanged",onDisconnect:"onDisconnect"},j=function(q,n){if(n===false){return}var o;if(typeof(l.console)==="undefined"){return}o="["+new Date().toTimeString()+"] SignalR: "+q;if(l.console.debug){l.console.debug(o)}else{if(l.console.log){l.console.log(o)}}},g=function(n){var m;n=a.trim(n);if(n.indexOf("http")!==0){return false}m=l.document.createElement("a");m.href=n;return m.protocol+m.host!==l.location.protocol+l.location.host},e=function(m,n,o){if(n===m.state){a(m).trigger(f.onStateChanged,[{oldState:m.state,newState:o}]);m.state=o;return true}return false},h=function(m){return m.state===k.connectionState.disconnected};k=function(o,n,m){return new k.fn.init(o,n,m)};k.events=f;k.changeState=e;k.isDisconnecting=h;k.connectionState={connecting:0,connected:1,reconnecting:2,disconnected:4};k.hub={start:function(){throw new Error("SignalR: Error loading hubs. Ensure your hubs reference is correct, e.g. <script src='/signalr/hubs'></script>.")}};d.load(function(){c=true});k.fn=k.prototype={init:function(o,n,m){this.url=o;this.qs=n;this.keepAliveData={};if(typeof(m)==="boolean"){this.logging=m}},ajaxDataType:"json",logging:false,state:k.connectionState.disconnected,reconnectDelay:2000,keepAliveTimeoutCount:2,keepAliveWarnAt:2/3,start:function(s,m){var o=this,n={waitForPageLoad:true,transport:"auto",jsonp:false},r,q=o.deferral||a.Deferred(),u=l.document.createElement("a");if(a.type(s)==="function"){m=s}else{if(a.type(s)==="object"){a.extend(n,s);if(a.type(n.callback)==="function"){m=n.callback}}}if(!c&&n.waitForPageLoad===true){d.load(function(){o.deferral=q;o.start(s,m)});return q.promise()}if(e(o,k.connectionState.disconnected,k.connectionState.connecting)===false){q.resolve(o);return q.promise()}u.href=o.url;if(!u.protocol||u.protocol===":"){o.protocol=l.document.location.protocol;o.host=l.document.location.host;o.baseUrl=o.protocol+"//"+o.host}else{o.protocol=u.protocol;o.host=u.host;o.baseUrl=u.protocol+"//"+u.host}o.wsProtocol=o.protocol==="https:"?"wss://":"ws://";if(n.transport==="auto"&&n.jsonp===true){n.transport="longPolling"}if(g(o.url)){o.log("Auto detected cross domain url.");if(n.transport==="auto"){n.transport=["webSockets","longPolling"]}if(!n.jsonp){n.jsonp=!a.support.cors;if(n.jsonp){o.log("Using jsonp because this browser doesn't support CORS")}}}o.ajaxDataType=n.jsonp?"jsonp":"json";a(o).bind(f.onStart,function(x,w){if(a.type(m)==="function"){m.call(o)}q.resolve(o)});r=function(z,w){w=w||0;if(w>=z.length){if(!o.transport){a(o).trigger(f.onError,"SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization.");q.reject("SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization.");o.stop()}return}var y=z[w],x=a.type(y)==="object"?y:k.transports[y];if(y.indexOf("_")===0){r(z,w+1);return}x.start(o,function(){if(x.supportsKeepAlive){k.transports._logic.monitorKeepAlive(o)}o.transport=x;e(o,k.connectionState.connecting,k.connectionState.connected);a(o).trigger(f.onStart);d.unload(function(){o.stop(false)})},function(){r(z,w+1)})};var v=o.url+"/negotiate";o.log("Negotiating with '"+v+"'.");a.ajax({url:v,global:false,cache:false,type:"GET",data:{},dataType:o.ajaxDataType,error:function(w){a(o).trigger(f.onError,[w.responseText]);q.reject("SignalR: Error during negotiation request: "+w.responseText);o.stop()},success:function(x){var w=o.keepAliveData;o.appRelativeUrl=x.Url;o.id=x.ConnectionId;o.webSocketServerUrl=x.WebSocketServerUrl;if(x.KeepAlive){x.KeepAlive*=1000;w.timeout=x.KeepAlive*o.keepAliveTimeoutCount;w.timeoutWarning=w.timeout*o.keepAliveWarnAt;w.checkInterval=(w.timeout-w.timeoutWarning)/3}if(!x.ProtocolVersion||x.ProtocolVersion!=="1.0"){a(o).trigger(f.onError,"SignalR: Incompatible protocol version.");q.reject("SignalR: Incompatible protocol version.");return}a(o).trigger(f.onStarting);var z=[],y=[];a.each(k.transports,function(A){if(A==="webSockets"&&!x.TryWebSockets){return true}y.push(A)});if(a.isArray(n.transport)){a.each(n.transport,function(){var A=this;if(a.type(A)==="object"||(a.type(A)==="string"&&a.inArray(""+A,y)>=0)){z.push(a.type(A)==="string"?""+A:A)}})}else{if(a.type(n.transport)==="object"||a.inArray(n.transport,y)>=0){z.push(n.transport)}else{z=y}}r(z)}});return q.promise()},starting:function(n){var o=this,m=a(o);m.bind(f.onStarting,function(r,q){n.call(o);m.unbind(f.onStarting)});return o},send:function(n){var m=this;if(m.state===k.connectionState.disconnected){throw new Error("SignalR: Connection must be started before data can be sent. Call .start() before .send()")}if(m.state===k.connectionState.connecting){throw new Error("SignalR: Connection has not been fully initialized. Use .start().done() or .start().fail() to run logic after the connection has started.")}m.transport.send(m,n);return m},sending:function(m){var n=this;a(n).bind(f.onSending,function(q,o){m.call(n)});return n},received:function(m){var n=this;a(n).bind(f.onReceived,function(q,o){m.call(n,o)});return n},stateChanged:function(m){var n=this;a(n).bind(f.onStateChanged,function(q,o){m.call(n,o)});return n},error:function(m){var n=this;a(n).bind(f.onError,function(q,o){m.call(n,o)});return n},disconnected:function(m){var n=this;a(n).bind(f.onDisconnect,function(q,o){m.call(n)});return n},connectionSlow:function(m){var n=this;a(n).bind(f.onConnectionSlow,function(q,o){m.call(n)});return n},reconnected:function(m){var n=this;a(n).bind(f.onReconnect,function(q,o){m.call(n)});return n},stop:function(m,o){var n=this;if(n.state===k.connectionState.disconnected){return}try{if(n.transport){if(o!==false){n.transport.abort(n,m)}if(n.transport.supportsKeepAlive){k.transports._logic.stopMonitoringKeepAlive(n)}n.transport.stop(n);n.transport=null}a(n).trigger(f.onDisconnect);delete n.messageId;delete n.groups}finally{e(n,n.state,k.connectionState.disconnected)}return n},log:function(m){j(m,this.logging)}};k.fn.init.prototype=k.fn;k.noConflict=function(){if(a.connection===k){a.connection=b}return k};if(a.connection){b=a.connection}a.connection=a.signalR=k}(window.jQuery,window));(function(a,e){var d=a.signalR,c=a.signalR.events;d.transports={};function b(f){var h=f.keepAliveData;if(f.state===d.connectionState.connected){var g=new Date(),j;g.setTime(g-h.lastKeepAlive);j=g.getTime();if(j>=h.timeout){f.log("Keep alive timed out.  Notifying transport that connection has been lost.");f.transport.lostConnection(f)}else{if(j>=h.timeoutWarning){if(!h.userNotified){f.log("Keep alive has been missed, connection may be dead/slow.");a(f).triggerHandler(c.onConnectionSlow);h.userNotified=true}}else{h.userNotified=false}}}if(h.monitoring){e.setTimeout(function(){b(f)},h.checkInterval)}}d.transports._logic={addQs:function(g,f){if(!f.qs){return g}if(typeof(f.qs)==="object"){return g+"&"+a.param(f.qs)}if(typeof(f.qs)==="string"){return g+"&"+f.qs}return g+"&"+e.escape(f.qs.toString())},getUrl:function(h,l,k,f){var g=l==="webSockets"?"":h.baseUrl,m=g+h.appRelativeUrl,j="transport="+l+"&connectionId="+e.escape(h.id);if(h.data){j+="&connectionData="+e.escape(h.data)}if(!k){m=m+"/connect"}else{if(f){m=m+"/reconnect"}if(h.messageId){j+="&messageId="+h.messageId}if(h.groups){j+="&groups="+e.escape(JSON.stringify(h.groups))}}m+="?"+j;m=this.addQs(m,h);m+="&tid="+Math.floor(Math.random()*11);return m},ajaxSend:function(f,g){var h=f.url+"/send?transport="+f.transport.name+"&connectionId="+e.escape(f.id);h=this.addQs(h,f);return a.ajax({url:h,global:false,type:f.ajaxDataType==="jsonp"?"GET":"POST",dataType:f.ajaxDataType,data:{data:g},success:function(j){if(j){a(f).trigger(c.onReceived,[j])}},error:function(j,k){if(k==="abort"||(k==="parsererror"&&f.ajaxDataType==="jsonp")){return}a(f).trigger(c.onError,[j])}})},ajaxAbort:function(g,f){if(typeof(g.transport)==="undefined"){return}f=typeof f==="undefined"?true:f;var h=g.url+"/abort?transport="+g.transport.name+"&connectionId="+e.escape(g.id);h=this.addQs(h,g);a.ajax({url:h,async:f,timeout:1000,global:false,type:"POST",dataType:g.ajaxDataType,data:{}});g.log("Fired ajax abort async = "+f)},processMessages:function(g,h){if(g.transport){var f=a(g);if(g.transport.supportsKeepAlive){this.updateKeepAlive(g)}if(!h){return}if(h.Disconnect){g.log("Disconnect command received from server");g.stop(false,false);return}if(h.Messages){a.each(h.Messages,function(){try{f.trigger(c.onReceived,[this])}catch(j){g.log("Error raising received "+j);a(g).trigger(c.onError,[j])}})}if(h.MessageId){g.messageId=h.MessageId}if(h.TransportData){g.groups=h.TransportData.Groups}}},monitorKeepAlive:function(f){var g=f.keepAliveData;if(!g.monitoring){g.monitoring=true;this.updateKeepAlive(f);f.log("Now monitoring keep alive with a warning timeout of "+g.timeoutWarning+" and a connection lost timeout of "+g.timeout);b(f)}else{f.log("Tried to monitor keep alive but it's already being monitored")}},stopMonitoringKeepAlive:function(f){var g=f.keepAliveData;if(g.monitoring){g.monitoring=false;g={};f.log("Stopping the monitoring of the keep alive")}},updateKeepAlive:function(f){f.keepAliveData.lastKeepAlive=new Date()},foreverFrame:{count:0,connections:{}}}}(window.jQuery,window));(function(a,f){var d=a.signalR,c=a.signalR.events,b=a.signalR.changeState,e=d.transports._logic;d.transports.webSockets={name:"webSockets",supportsKeepAlive:true,attemptingReconnect:false,currentSocketID:0,send:function(g,h){g.socket.send(h)},start:function(h,k,j){var o,l=false,n=this,m=!k,g=a(h);if(f.MozWebSocket){f.WebSocket=f.MozWebSocket}if(!f.WebSocket){j();return}if(!h.socket){if(h.webSocketServerUrl){o=h.webSocketServerUrl}else{o=h.wsProtocol+h.host}a(h).trigger(c.onSending);o+=e.getUrl(h,this.name,m);h.log("Connecting to websocket endpoint '"+o+"'");h.socket=new f.WebSocket(o);h.socket.ID=++n.currentSocketID;h.socket.onopen=function(){l=true;h.log("Websocket opened");if(n.attemptingReconnect){n.attemptingReconnect=false}if(k){k()}else{if(b(h,d.connectionState.reconnecting,d.connectionState.connected)===true){g.trigger(c.onReconnect)}}};h.socket.onclose=function(q){if(this.ID===n.currentSocketID){if(!l){if(j){j()}else{if(m){n.reconnect(h)}}return}else{if(typeof q.wasClean!=="undefined"&&q.wasClean===false){a(h).trigger(c.onError,[q.reason]);h.log("Unclean disconnect from websocket."+q.reason)}else{h.log("Websocket closed")}}n.reconnect(h)}};h.socket.onmessage=function(s){var r=f.JSON.parse(s.data),q=a(h);if(r){if(a.isEmptyObject(r)||r.Messages){e.processMessages(h,r)}else{q.trigger(c.onReceived,[r])}}}}},reconnect:function(g){var h=this;if(!h.attemptingReconnect){h.attemptingReconnect=true}f.setTimeout(function(){if(h.attemptingReconnect){h.stop(g)}if(g.state===d.connectionState.reconnecting||b(g,d.connectionState.connected,d.connectionState.reconnecting)===true){g.log("Websocket reconnecting");h.start(g)}},g.reconnectDelay)},lostConnection:function(g){this.reconnect(g)},stop:function(g){if(g.socket!==null){g.log("Closing the Websocket");g.socket.close();g.socket=null}},abort:function(g){}}}(window.jQuery,window));(function(a,f){var d=a.signalR,c=a.signalR.events,b=a.signalR.changeState,e=d.transports._logic;d.transports.serverSentEvents={name:"serverSentEvents",supportsKeepAlive:true,reconnectTimeout:false,currentEventSourceID:0,timeOut:3000,start:function(h,m,l){var q=this,n=false,g=a(h),o=!m,r,j;if(h.eventSource){h.log("The connection already has an event source. Stopping it.");h.stop()}if(!f.EventSource){if(l){h.log("This browser doesn't support SSE.");l()}return}g.trigger(c.onSending);r=e.getUrl(h,this.name,o);try{h.log("Attempting to connect to SSE endpoint '"+r+"'");h.eventSource=new f.EventSource(r);h.eventSource.ID=++q.currentEventSourceID}catch(k){h.log("EventSource failed trying to connect with error "+k.Message);if(l){l()}else{g.trigger(c.onError,[k]);if(o){q.reconnect(h)}}return}j=f.setTimeout(function(){if(n===false){h.log("EventSource timed out trying to connect");h.log("EventSource readyState: "+h.eventSource.readyState);if(!o){q.stop(h)}if(o){q.reconnect(h)}else{if(l){l()}}}},q.timeOut);h.eventSource.addEventListener("open",function(s){h.log("EventSource connected");if(j){f.clearTimeout(j)}if(q.reconnectTimeout){f.clearTimeout(q.reconnectTimeout)}if(n===false){n=true;if(m){m()}if(o){if(b(h,d.connectionState.reconnecting,d.connectionState.connected)===true){g.trigger(c.onReconnect)}}}},false);h.eventSource.addEventListener("message",function(s){if(s.data==="initialized"){return}e.processMessages(h,f.JSON.parse(s.data))},false);h.eventSource.addEventListener("error",function(s){if(this.ID===q.currentEventSourceID){if(!n){if(l){l()}return}h.log("EventSource readyState: "+h.eventSource.readyState);if(s.eventPhase===f.EventSource.CLOSED){h.log("EventSource reconnecting due to the server connection ending");q.reconnect(h)}else{h.log("EventSource error");g.trigger(c.onError)}}},false)},reconnect:function(g){var h=this;h.reconnectTimeout=f.setTimeout(function(){h.stop(g);if(g.state===d.connectionState.reconnecting||b(g,d.connectionState.connected,d.connectionState.reconnecting)===true){g.log("EventSource reconnecting");h.start(g)}},g.reconnectDelay)},lostConnection:function(g){this.reconnect(g)},send:function(g,h){e.ajaxSend(g,h)},stop:function(g){if(g&&g.eventSource){g.log("EventSource calling close()");g.eventSource.close();g.eventSource=null;delete g.eventSource}},abort:function(h,g){e.ajaxAbort(h,g)}}}(window.jQuery,window));(function(a,f){var d=a.signalR,c=a.signalR.events,b=a.signalR.changeState,e=d.transports._logic;d.transports.foreverFrame={name:"foreverFrame",supportsKeepAlive:true,timeOut:3000,start:function(g,m,l){var n=this,k=(e.foreverFrame.count+=1),o,h,j=a("<iframe data-signalr-connection-id='"+g.id+"' style='position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;' src=''></iframe>");if(f.EventSource){if(l){g.log("This brower supports SSE, skipping Forever Frame.");l()}return}a(g).trigger(c.onSending);o=e.getUrl(g,this.name);o+="&frameId="+k;j.prop("src",o);e.foreverFrame.connections[k]=g;g.log("Binding to iframe's readystatechange event.");j.bind("readystatechange",function(){if(a.inArray(this.readyState,["loaded","complete"])>=0){g.log("Forever frame iframe readyState changed to "+this.readyState+", reconnecting");n.reconnect(g)}});g.frame=j[0];g.frameId=k;if(m){g.onSuccess=m}a("body").append(j);h=f.setTimeout(function(){if(g.onSuccess){g.log("Failed to connect using forever frame source, it timed out after "+n.timeOut+"ms.");n.stop(g);if(l){l()}}},n.timeOut)},reconnect:function(g){var h=this;f.setTimeout(function(){if(!g.frame){return}if(g.state===d.connectionState.reconnecting||b(g,d.connectionState.connected,d.connectionState.reconnecting)===true){var j=g.frame,k=e.getUrl(g,h.name,true)+"&frameId="+g.frameId;g.log("Upating iframe src to '"+k+"'.");j.src=k}},g.reconnectDelay)},lostConnection:function(g){this.reconnect(g)},send:function(g,h){e.ajaxSend(g,h)},receive:function(g,j){var h;e.processMessages(g,j);g.frameMessageCount=(g.frameMessageCount||0)+1;if(g.frameMessageCount>50){g.frameMessageCount=0;h=g.frame.contentWindow||g.frame.contentDocument;if(h&&h.document){a("body",h.document).empty()}}},stop:function(g){var h=null;if(g.frame){if(g.frame.stop){g.frame.stop()}else{h=g.frame.contentWindow||g.frame.contentDocument;if(h.document&&h.document.execCommand){h.document.execCommand("Stop")}}a(g.frame).remove();delete e.foreverFrame.connections[g.frameId];g.frame=null;g.frameId=null;delete g.frame;delete g.frameId;g.log("Stopping forever frame")}},abort:function(h,g){e.ajaxAbort(h,g)},getConnection:function(g){return e.foreverFrame.connections[g]},started:function(g){if(g.onSuccess){g.onSuccess();g.onSuccess=null;delete g.onSuccess}else{if(b(g,d.connectionState.reconnecting,d.connectionState.connected)===true){a(g).trigger(c.onReconnect)}}}}}(window.jQuery,window));(function(a,g){var e=a.signalR,c=a.signalR.events,b=a.signalR.changeState,d=a.signalR.isDisconnecting,f=e.transports._logic;e.transports.longPolling={name:"longPolling",supportsKeepAlive:false,reconnectDelay:3000,start:function(h,l,k){var m=this,j=false;if(h.pollXhr){h.log("Polling xhr requests already exists, aborting.");h.stop()}h.messageId=null;g.setTimeout(function(){(function n(q,s){a(q).trigger(c.onSending);var r=q.messageId,o=(r===null),v=!o,x=f.getUrl(q,m.name,v,s),w=null,u=false;if(v===true&&s===true){if(h.state!==e.connectionState.reconnecting&&b(h,e.connectionState.connected,e.connectionState.reconnecting)===false){return}}h.log("Attempting to connect to '"+x+"' using longPolling.");q.pollXhr=a.ajax({url:x,global:false,cache:false,type:"GET",dataType:h.ajaxDataType,success:function(y){var z=0,A=false;if(j===false){l();j=true}if(s===true){if(u===false){h.log("Raising the reconnect event");if(b(h,e.connectionState.reconnecting,e.connectionState.connected)===true){a(q).trigger(c.onReconnect);u=true}}}f.processMessages(q,y);if(y&&y.TransportData&&a.type(y.TransportData.LongPollDelay)==="number"){z=y.TransportData.LongPollDelay}if(y&&y.TimedOut){A=y.TimedOut}if(y&&y.Disconnect){return}if(d(q)===true){return}if(z>0){g.setTimeout(function(){n(q,A)},z)}else{n(q,A)}},error:function(y,z){if(z==="abort"){h.log("Aborted xhr requst.");return}h.log("An error occurred using longPolling. Status = "+z+". "+y.responseText);if(w){g.clearTimeout(w)}a(q).trigger(c.onError,[y.responseText]);g.setTimeout(function(){if(d(q)===false){n(q,true)}},h.reconnectDelay)}});if(s===true){w=g.setTimeout(function(){if(u===false){if(b(h,e.connectionState.reconnecting,e.connectionState.connected)===true){a(q).trigger(c.onReconnect);u=true}}},m.reconnectDelay)}}(h));g.setTimeout(function(){if(j===false){l();j=true}},150)},250)},lostConnection:function(h){throw new Error("Lost Connection not handled for LongPolling")},send:function(h,j){f.ajaxSend(h,j)},stop:function(h){if(h.pollXhr){h.pollXhr.abort();h.pollXhr=null;delete h.pollXhr}},abort:function(j,h){f.ajaxAbort(j,h)}}}(window.jQuery,window));(function(a,k){var b=0,c={},d=".hubProxy";function j(l){return l+d}if(!Array.prototype.hasOwnProperty("map")){Array.prototype.map=function(m,r){var l=this,n,o=l.length,q=[];for(n=0;n<o;n+=1){if(l.hasOwnProperty(n)){q[n]=m.call(r,l[n],n,l)}}return q}}function e(l){return a.isFunction(l)?null:(a.type(l)==="undefined"?null:l)}function f(m){for(var l in m){if(m.hasOwnProperty(l)){return true}}return false}function h(l,m){return new h.fn.init(l,m)}h.fn=h.prototype={init:function(l,m){this.state={};this.connection=l;this.hubName=m;this._={callbackMap:{}}},hasSubscriptions:function(){return f(this._.callbackMap)},on:function(n,l){var o=this,m=o._.callbackMap;n=n.toLowerCase();if(!m[n]){m[n]={}}m[n][l]=function(r,q){l.apply(o,q)};a(o).bind(j(n),m[n][l]);return o},off:function(o,l){var q=this,m=q._.callbackMap,n;o=o.toLowerCase();n=m[o];if(n){if(n[l]){a(q).unbind(j(o),n[l]);delete n[l];if(!f(n)){delete m[o]}}else{if(!l){a(q).unbind(j(o));delete m[o]}}}return q},invoke:function(r){var s=this,l=a.makeArray(arguments).slice(1),m=l.map(e),q={hub:s.hubName,method:r,args:m,state:s.state,id:b},o=a.Deferred(),n=function(u){a.extend(this.state,u.State);if(u.Error){if(u.StackTrace){s.connection.log(u.Error+"\n"+u.StackTrace)}o.rejectWith(s,[u.Error])}else{o.resolveWith(s,[u.Result])}};c[b.toString()]={scope:s,method:n};b+=1;s.connection.send(k.JSON.stringify(q));return o.promise()}};h.fn.init.prototype=h.fn;function g(n,l){var m={qs:null,logging:false,useDefaultPath:true};a.extend(m,l);if(!n||m.useDefaultPath){n=(n||"")+"/signalr"}return new g.fn.init(n,m)}g.fn=g.prototype=a.connection();g.fn.init=function(o,m){var n={qs:null,logging:false,useDefaultPath:true},l=this;a.extend(n,m);a.signalR.fn.init.call(l,o,n.qs,n.logging);l.proxies={};l.sending(function(){var q=[];a.each(this.proxies,function(r){if(this.hasSubscriptions()){q.push({name:r})}});this.data=k.JSON.stringify(q)});l.received(function(r){var w,s,q,v,u;if(!r){return}if(typeof(r.Id)!=="undefined"){s=r.Id.toString();q=c[s];if(q){c[s]=null;delete c[s];q.method.call(q.scope,r)}}else{l.log("Triggering client hub event '"+r.Method+"' on hub '"+r.Hub+"'.");v=r.Hub.toLowerCase();u=r.Method.toLowerCase();w=this.proxies[v];a.extend(w.state,r.State);a(w).triggerHandler(j(u),[r.Args])}})};g.fn.createProxy=function(l){l=l.toLowerCase();var m=this.proxies[l];if(!m){m=h(this,l);this.proxies[l]=m}return m};g.fn.init.prototype=g.fn;a.hubConnection=g}(window.jQuery,window));(function(a,b){b.fn._nodes=function(){var c=this;c.allNodes=[];function f(){c._.birdseye&&c._.birdseye.refresh(false)}c.copyNodePositions=function(j){a.each(c.allNodes,function(){var k=this;a.each(j,function(){if(this.options.id===k.options.id){k.setPosition({x:this.options.xPos,y:this.options.yPos})}})})};c.addRange=function(j){a.each(j,function(){c.add(this)});return c};c.removeRange=function(j){a.each(j,function(){c.allNodes=removeNode(c.allNodes,this)});return c};c.add=function(j,k){j.slate=c._;c.allNodes.push(j);d(j)};c.remove=function(j){c.allNodes=g(c.allNodes,j);j.slate=null;h(j)};function e(l){var k,j;a.each(c.allNodes,function(){var m=this;if(this.options.id===l.parent){k=m}else{if(this.options.id===l.child){j=m}}if(k&&j){return}});return{p:k,c:j}}c.removeRelationship=function(m){var l=e(m);var k=l.p,j=l.c;if(k&&j){k.relationships.removeChild(j);j.relationships.removeParent(k);k.relationships.removeAssociation(j);j.relationships.removeAssociation(k)}};c.addRelationship=function(l){var m=e(l);var k=m.p,j=m.c;if(k&&j){switch(l.type){case"association":k.relationships.addAssociation(j);break;case"parent":k.relationships.addParent(j);break}}};c.closeAllMenus=function(j){a.each(c.allNodes,function(){if(this.options.id===j){}else{this.menu&&this.menu.hide()}})};c.closeAllConnectors=function(){a.each(c.allNodes,function(){this.connectors&&this.connectors.remove();this.resize&&this.resize.hide()})};c.one=function(k){var j=null;a.each(c.allNodes,function(){if(this.options.id===k){j=this;return}});return j};function g(k,l){var j=new Array();a.each(k,function(){if(this.options.id!==l.options.id){j.push(this)}});return j}function h(j){j.vect.remove();j.text.remove();j.link.remove()}function d(k){var x=null,w=null,q=null,v="#000";if(k.options.borderWidth===0){v="transparent"}var y={stroke:v,"stroke-width":k.options.borderWidth,fill:(k.options.backgroundColor||"none")};var n=k.options.xPos;var o=k.options.yPos;var r=c._.paper;var u=1;var m=k.options.width;var j=k.options.height;switch(k.options.vectorPath){case"ellipse":x=r.ellipse(n*u,o*u,(m/2)*u,(j/2)*u).attr(y);break;case"rectangle":x=r.rect(n*u,o*u,m*u,j*u).attr(y);break;case"roundedrectangle":x=r.rect(n*u,o*u,m*u,j*u,10).attr(y);break;default:var l=Raphael.transformPath(k.options.vectorPath,"T"+(n*u)+","+(o*u));x=r.path(l).attr(y);break}x.node.setAttribute("rel",k.options.id);x.data({id:k.options.id});k.vect=x;tc=k.textCoords();lc=k.linkCoords();w=r.text(tc.x,tc.y,(k.options.text||"")).attr({"font-size":k.options.fontSize+"pt",fill:k.options.foregroundColor||"#000"});q=r.linkArrow().transform(["t",lc.x,",",lc.y,"s",".8",",",".8","r","180"].join());k.text=w;k.link=q;k.relationships.wireHoverEvents();k.relationships.wireDragEvents();k.links&&k.links.wireEvents();if(k.options.image&&k.options.image!==""){k.vect.attr({fill:"url("+k.options.image+")","stroke-width":k.options.borderWidth,stroke:"#000"})}if(!k.options.link||!k.options.link.show){k.link.hide()}return x}return c}})(Slatebox,Slatebox.fn.slate);(function(a,b){b.fn._message=function(){var c=this;c.show=function(k,m){var j=c._.messageBox;var h=a.getDimensions(c._.options.container);if(c._.messageBox===undefined){var l=c._.paper;j=c._.messageBox=l.set();j.push(l.rect(0,0,h.width,28,7).attr({fill:"#ffff99"}));j.push(l.text(0,0,"").standard())}j.show();j[1].attr({text:k});var e=j[1].getBBox().width;j[0].attr({width:e+12});var f=c._.options.viewPort.left+((h.width-j[0].attr("width"))/2);var g=c._.options.viewPort.top+3;j[0].attr({x:f,y:g,"fill-opacity":0});j[1].attr({x:f+(e/2)+6,y:g+13,"fill-opacity":0});j.animate({"fill-opacity":1},500,function(){setTimeout(function(){j.animate({"fill-opacity":0},500,function(){j.hide()})},m)})};return c}})(Slatebox,Slatebox.fn.slate);(function(a,b){b.fn._canvas=function(){if(Raphael===undefined){alert("You must load Raphael in order to use the Slatebox.slate.canvas.js plugin!")}var g=this,f,e,h,l,c=null;var k=function(n){var o=a.mousePos(n);difX=j.objInitPos.left+(o.x-j.objInitialMousePos.x);difY=j.objInitPos.top+(o.y-j.objInitialMousePos.y);_width=g._.options.containerStyle.width;_height=g._.options.containerStyle.height;_vpWidth=g._.options.viewPort.width;_vpHeight=g._.options.viewPort.height;if(difX>0){difX=0}else{if(Math.abs(difX)+_width>_vpWidth){difX=_width-vpWidth}}if(difY>0){difY=0}else{if(Math.abs(difY)+_height>_vpHeight){difY=_height-_vpHeight}}return{x:difX,y:difY}};var j={objInitPos:{},objInitialMousePos:{x:0,y:0},kinetic:null,isDragging:false,initDrag:function(n){g._.options.events&&g._.options.events.onCanvasClicked&&g._.options.events.onCanvasClicked();if(g._.options.viewPort.allowDrag){g._.multiselection&&g._.multiselection.end();this.isDragging=true;var o=a.mousePos(n);j.objInitPos=a.positionedOffset(e);var q=a.positionedOffset(g._.options.container);j.objInitialMousePos={x:o.x+q.left,y:o.y+q.top};var r=k(n);h.innerHTML=Math.abs(r.x)+", "+Math.abs(r.y);if(g._.options.showStatus){h.style.display="block";g._.multiselection&&g._.multiselection.hide()}e.style.cursor="url("+l+"closedhand.cur), default";if(o.allTouches){g._.options.lastTouches=o.allTouches}if(a.isFunction(g._.removeContextMenus)){g._.removeContextMenus()}a.stopEvent(n)}else{if(a.isFunction(g._.onSelectionStart)){g._.onSelectionStart.apply(this,[n])}else{a.stopEvent(n)}}},setCursor:function(m){if(this.isDragging){e.style.cursor="url("+l+"closedhand.cur), default"}else{e.style.cursor="url("+l+"openhand.cur), default"}},onDrag:function(m){if(this.isDragging&&g._.options.viewPort.allowDrag){var n=k(m);if(n.allTouches&&n.allTouches.length>1){g._.options.lastTouches=n.allTouches}h.innerHTML=Math.abs(n.x)+", "+Math.abs(n.y);e.style.left=n.x+"px";e.style.top=n.y+"px"}},endDrag:function(m){if(this.isDragging&&g._.options.viewPort.allowDrag){this.isDragging=false;e.style.cursor="url("+l+"openhand.cur), default";h.style.display="none";g._.multiselection&&g._.multiselection.show();var n=k(m);g.endDrag(n)}}};g.endDrag=function(m){g._.options.viewPort.left=Math.abs(m.x);g._.options.viewPort.top=Math.abs(m.y);e.style.left=m.x+"px";e.style.top=m.y+"px";g._.birdseye&&g._.birdseye.refresh(true);if(g._.options.collaboration.allow){g.broadcast()}};g.broadcast=function(){g._.signalr&&g._.signalr.send({type:"onCanvasMove",data:{left:g._.options.viewPort.left,top:g._.options.viewPort.top}})};g.zoom=function(m){var s={dur:500,callbacks:{after:null,during:null},easing:"easeFromTo",zoomPercent:100};a.extend(s,m);g._.nodes.closeAllConnectors();var r=a.isFunction(s.callbacks.during);var n=g._.options.viewPort.zoom.w;var o=g._.options.viewPort.originalWidth*(100/parseInt(s.zoomPercent));var q=Math.abs(o-n);s.dur=s.dur||500;emile(e,"padding:1px",{duration:s.dur,before:function(){g._.options.viewPort.allowDrag=false},after:function(){g._.options.viewPort.allowDrag=true;g._.zoomSlider.set(o);g._.birdseye&&g._.birdseye.refresh(true);s.callbacks.after&&s.callbacks.after.apply(g,[o])},during:function(v){var u=o>n?(n+(q*v)):(n-(q*v));g._.zoom(0,0,u,u,false);g._.canvas.resize(u);r&&s.callbacks.during.apply(this,[v])},easing:g.easing[s.easing]})};g.scaleToFitNodes=function(q){var v={nodes:[],dur:500,cb:null,offset:0,minWidth:600,minHeight:300};a.extend(v,q);var w=g._.getOrientation(v.nodes);var u=a.getDimensions(g._.options.container);if(u.width>v.minWidth&&u.height>v.minHeight){var n=Math.min(u.width,u.height);var m=(g._.options.viewPort.zoom.w/g._.options.viewPort.originalWidth)*100;var s=100+(100-(m*w.width/u.width));var o=100+(100-(m*w.height/u.height));var r=Math.abs(Math.min(s,o))-v.offset;g.zoom({dur:500,callbacks:{after:function(){v.cb&&v.cb()}},easing:"easeFromTo",zoomPercent:r})}};g.centerOnNodes=function(m){var w={nodes:[],dur:500,cb:null};a.extend(w,m);var x=g._.getOrientation(w.nodes);var s=a.getDimensions(g._.options.container);var r=s.width,q=s.height,v=x.width,u=x.height,y=10;var n=x.left-(r/2-v/2);var o=x.top-(q/2-u/2);g.move({x:n,y:o,isAbsolute:true,duration:w.dur,easing:"swingFromTo",callbacks:{after:function(){w.cb&&w.cb()}}})};g.center=function(m){var n={previousWindowSize:{},dur:500,cb:null};a.extend(n,m);var o=a.windowSize();g.move({x:((o.width-n.previousWindowSize.w)/2)*-1,y:((o.height-n.previousWindowSize.h)/2)*-1,duration:n.dur,isAbsolute:false,easing:"swingFromTo",callbacks:{after:function(){n.cb&&n.cb()}}});return o};g.move=function(m){var o={x:0,y:0,dur:500,callbacks:{after:null,during:null},isAbsolute:true,easing:"easeFromTo"};a.extend(o,m);g._.nodes.closeAllConnectors();var q=o.x;var r=o.y;var n=a.isFunction(o.callbacks.during);if(o.isAbsolute===false){q=g._.options.viewPort.left+q;r=g._.options.viewPort.top+r}if(o.dur>0){emile(e,"left:"+(q*-1)+"px;top:"+r*-1+"px",{duration:o.dur,before:function(){g._.options.viewPort.allowDrag=false},after:function(){g._.options.viewPort.allowDrag=true;g._.options.viewPort.left=Math.abs(parseInt(e.style.left.replace("px","")));g._.options.viewPort.top=Math.abs(parseInt(e.style.top.replace("px","")));g._.birdseye&&g._.birdseye.refresh(true);o.callbacks.after&&o.callbacks.after.apply(g)},during:function(s){n&&o.callbacks.during.apply(this,[s])},easing:g.easing[o.easing]})}else{e.style.left=(q*-1)+"px";e.style.top=(r*-1)+"px";g._.options.viewPort.left=Math.abs(q);g._.options.viewPort.top=Math.abs(r)}};g.resize=function(u){u=parseInt(u);var s=(g._.options.viewPort.width/u);var r=a.getDimensions(g._.options.container);e.style.width="50000px";e.style.height="50000px";var q=((g._.options.viewPort.top*-1)*s);var o=((g._.options.viewPort.left*-1)*s);var n=(((r.height/2*s)-(r.height/2))*-1);var m=(((r.width/2*s)-(r.width/2))*-1);q=(q+n);o=(o+m);e.style.top=q+"px";e.style.left=o+"px";g._.options.viewPort.zoom={w:u,h:u,l:parseInt(o*-1),t:parseInt(q*-1),r:g._.options.viewPort.originalWidth/u}};g.clear=function(){g._.options.container.innerHTML="";return g._};var d={init:["onmousedown","ontouchstart"],drag:["onmousemove","ontouchmove"],up:["onmouseup","ontouchend","onmouseout"],gest:["ongesturestart","ongesturechange","ongestureend"]};g.wire=function(){for(var m in d.init){e[d.init[parseInt(m)]]=j.initDrag}for(var m in d.drag){e[d.drag[parseInt(m)]]=j.onDrag}for(var m in d.up){e[d.up[parseInt(m)]]=j.endDrag}var n,o,q;e.ongesturestart=function(r){r.preventDefault();g._.options.viewPort.allowDrag=false;if(g._.options.lastTouches){var s=g._.options.lastTouches;o=s[0].x;q=s[0].y;if(s.length>1){o=(Math.max(s[0].x,s[1].x||0)-Math.min(s[0].x,s[1].x||s[0].x))/2;q=(Math.max(s[0].y,s[1].y||0)-Math.min(s[0].y,s[1].y||s[0].y))/2}n=g._.options.viewPort.zoom.w}};e.ongesturechange=function(r){var s=n/r.scale;g._.zoom(0,0,s,s,false);g._.canvas.resize(s);a.select("li.rmitem")[0].innerHTML=g._.options.lastTouches[0].x+" , "+g._.options.lastTouches[1].x};e.ongestureend=function(r){g._.options.viewPort.allowDrag=true;var u=g._.options.viewPort.zoom;var s=g._.options.viewPort;s.width=u.w;s.height=u.h;s.left=u.l;s.top=u.t}};g.unwire=function(){for(var m in d.init){e[d.init[parseInt(m)]]=null}for(var m in d.drag){e[d.drag[parseInt(m)]]=null}for(var m in d.up){e[d.up[parseInt(m)]]=null}for(var m in d.gest){e[d.gest[parseInt(m)]]=null}};g.init=function(o){var w={imageFolder:"/public/images/"};a.extend(w,o);var s=g._.options.container;g._.options.imageFolder=w.imageFolder;l=w.imageFolder;if(typeof(s)==="string"){s=a.el(s)}if(s===undefined||s===null){throw new Error("You must provide a container to initiate the canvas!")}s.innerHTML="";if(f){f.clear()}if(e){s.removeChild(e)}e=document.createElement("div");e.setAttribute("class","slateboxInternal");s.appendChild(e);var v=a.getDimensions(s);h=document.createElement("div");h.style.position="absolute";h.style.height=" 20px";h.style.left="0px";h.style.color="#000";h.style.fontSize="10pt";h.style.fontFamily="trebuchet ms";h.style.top="0px";h.style.display="none";h.style.padding="5px";h.style.filter="alpha(opacity=80)";h.style.opacity=".80";h.style.backgroundColor="#ffff99";h.style.fontWeight="bold";s.appendChild(h);var u=g._.options.containerStyle;s.style.position="relative";s.style.overflow="hidden";var r=g._.options.viewPort.width;var m=g._.options.viewPort.height;var n=g._.options.viewPort.left;var q=g._.options.viewPort.top;e.style.width=r+"px";e.style.height=m+"px";e.style.left=(n*-1)+"px";e.style.top=(q*-1)+"px";e.style.position="absolute";g.borderTop=g.borderTop+2||2;e.style.borderTop=g.borderTop+"px";e.style.cursor="url("+l+"openhand.cur), default";if(g._.options.viewPort.allowDrag){g.wire()}f=Raphael(e,r,m);g._.options.viewPort.originalHeight=m;g._.options.viewPort.originalWidth=r;g.resize(r);g._.paper=f;return g._};g.rawSVG=function(){return e.innerHTML};g.darken=function(m){if(c===null){c=document.createElement("div");var n=a.windowSize();c.style.backgroundColor="#ccc";c.style.position="absolute";c.style.left="0px";c.style.top="0px";c.style.width=n.width+"px";c.style.height=n.height+"px";c.style.zIndex=999;c.style.filter="alpha(opacity="+m+")";c.style.opacity=(m/100);document.body.appendChild(c)}return c};a.addEvent(window,"resize",function(){if(c!==null){var m=a.windowSize();c.style.width=m.width+"px";c.style.height=m.height+"px"}});g.lighten=function(){c&&document.body.removeChild(c);c=null};g.get=function(){return e};g.draggable=function(){return e};g.easing={elastic:function(m){return -1*Math.pow(4,-8*m)*Math.sin((m*6-1)*(2*Math.PI)/2)+1},swingFromTo:function(m){var n=1.70158;return((m/=0.5)<1)?0.5*(m*m*(((n*=(1.525))+1)*m-n)):0.5*((m-=2)*m*(((n*=(1.525))+1)*m+n)+2)},swingFrom:function(m){var n=1.70158;return m*m*((n+1)*m-n)},swingTo:function(m){var n=1.70158;return(m-=1)*m*((n+1)*m+n)+1},bounce:function(m){if(m<(1/2.75)){return(7.5625*m*m)}else{if(m<(2/2.75)){return(7.5625*(m-=(1.5/2.75))*m+0.75)}else{if(m<(2.5/2.75)){return(7.5625*(m-=(2.25/2.75))*m+0.9375)}else{return(7.5625*(m-=(2.625/2.75))*m+0.984375)}}}},bouncePast:function(m){if(m<(1/2.75)){return(7.5625*m*m)}else{if(m<(2/2.75)){return 2-(7.5625*(m-=(1.5/2.75))*m+0.75)}else{if(m<(2.5/2.75)){return 2-(7.5625*(m-=(2.25/2.75))*m+0.9375)}else{return 2-(7.5625*(m-=(2.625/2.75))*m+0.984375)}}}},easeFromTo:function(m){if((m/=0.5)<1){return 0.5*Math.pow(m,4)}return -0.5*((m-=2)*Math.pow(m,3)-2)},easeFrom:function(m){return Math.pow(m,4)},easeTo:function(m){return Math.pow(m,0.25)},none:function(m){return(-Math.cos(m*Math.PI)/2)+0.5}};return g}})(Slatebox,Slatebox.fn.slate);(function(a,b){b.fn._birdseye=function(){if(Raphael===undefined){alert("You must load Raphael in order to use the Slatebox.slate.birdseye.js plugin!")}var l=this,c,d,e,r,u,q,j,k,g,h,m,f;l.show=function(x){q={size:200,onHandleMove:null};a.extend(q,x);var y=l._.options.container;j=a.getDimensions(y);k=a.positionedOffset(y);c=document.createElement("div");c.setAttribute("id","slateBirdsEye_"+l._.options.id);c.style.position="absolute";c.style.height=q.size+"px";c.style.width=q.size+"px";c.style.border="2px inset #333";c.style.backgroundColor="#fff";y.appendChild(c);s();d=a.instance.slate({container:a.el("slateBirdsEye_"+l._.options.id),viewPort:{allowDrag:false},collaboration:{allow:false},showZoom:false,showBirdsEye:false,events:{onNodeDragged:function(){l._.nodes.copyNodePositions(d.nodes.allNodes)}}}).canvas.init();l.refresh();a.addEvent(window,"resize",function(){var z=l._.options.container;j=a.getDimensions(z);k=a.positionedOffset(z);s()});if(!l._.options.showBirdsEye){l.disable()}};l.enabled=function(){return d!==undefined};l.enable=function(){if(!d){l.show()}a.el("slateBirdsEye_"+l._.options.id).style.display="block"};l.disable=function(){a.el("slateBirdsEye_"+l._.options.id).style.display="none"};function s(){c.style.left=(j.width-q.size)+"px";c.style.top="-2px"}l.relationshipsChanged=function(x){if(d){switch(x.type){case"removeRelationship":d.nodes.removeRelationship(x.data);break;case"addRelationship":d.nodes.addRelationship(x.data);break}}};l.nodeChanged=function(y){if(d){var x;switch(y.type){case"onNodeShapeChanged":x=d.nodes.one(y.data.id);x.shapes.set(y.data);break;case"onNodeTextChanged":x=d.nodes.one(y.data.id);x.editor.set(y.data.text,y.data.fontSize,y.data.fontColor);break;case"onNodeColorChanged":x=d.nodes.one(y.data.id);x.colorpicker.set(y.data);break;case"onNodeImageChanged":x=d.nodes.one(y.data.id);x.images.set(y.data.img,y.data.w,y.data.h);break;case"onNodeResized":x=d.nodes.one(y.data.id);x.resize.set(y.data.width,y.data.height);break;case"onNodeToFront":x=d.nodes.one(y.data.id);x.vect.toFront();break;case"onNodeToBack":x=d.nodes.one(y.data.id);x.vect.toBack();break;case"onNodeLocked":x=d.nodes.one(y.data.id);x.options.allowDrag=false;case"onNodeUnlocked":x=d.nodes.one(y.data.id);x.options.allowDrag=true;break;case"onNodeAttached":x=d.nodes.one(y.data.id);x.relationships.attach();break}}};l.nodeDeleted=function(y){if(d){var x=d.nodes.one(y.data.id);x.del()}};l.nodeDetatched=function(y){if(d){var x=d.nodes.one(y.data.id);x.relationships.detatch()}};l.reload=function(x){if(e){e.remove()}d.loadJSON(x);l.refresh(true)};l.refresh=function(E){if(d){if(e){e.remove()}if(E===true){d.canvas.move({x:l._.options.viewPort.left,y:l._.options.viewPort.top,dur:0,isAbsolute:true});d.nodes.copyNodePositions(l._.nodes.allNodes)}else{d.loadJSON(l._.exportDifference(d),true)}r=l._.getOrientation();if(l._.options.viewPort.left<r.left){m=((l._.options.viewPort.left)-(r.left))}else{m=(l._.options.viewPort.left-r.left)+(j.width-r.width)}f=((l._.options.viewPort.top)-(r.top));var B=Math.max(Math.abs(m),(r.width<j.width?(j.width-r.width):0));var A=Math.max(Math.abs(f),(r.height<j.height?(j.height-r.height):0));var I=((r.width+B)/q.size)*l._.options.viewPort.width;var F=((r.height+A)/q.size)*l._.options.viewPort.height;u=Math.max(I,F);var C=Math.max(l._.options.viewPort.width,l._.options.viewPort.height)/u;var G=(r.left+(m<0?m:0))*C-5;var H=(r.top+(f<0?f:0))*C-5;d.zoom(0,0,u,u,true);d.options.viewPort.zoom.r=d.options.viewPort.originalWidth/u;d.canvas.move({x:G,y:H,dur:0,isAbsolute:true});d.disable();var y=l._.options.viewPort.left/l._.options.viewPort.zoom.r;var z=l._.options.viewPort.top/l._.options.viewPort.zoom.r;var D=j.width/l._.options.viewPort.zoom.r,x=j.height/l._.options.viewPort.zoom.r;e=d.paper.rect(y,z,D,x).attr({stroke:"red","stroke-width":1,fill:"#f8f8f8","fill-opacity":".6"});w()}};var n=function(){e.ox=this.attr("x");e.oy=this.attr("y")};var o=function(F,G){var D=d.options.viewPort.originalWidth/u;F=F+((F/D)-F);G=G+((G/D)-G);var B=e.ox+F;var C=e.oy+G;e.attr({x:B,y:C});var E=e.getBBox();var z=E.x*l._.options.viewPort.zoom.r;var A=E.y*l._.options.viewPort.zoom.r;if(a.isFunction(q.onHandleMove)){q.onHandleMove.apply(this,[z,A])}l._.canvas.move({x:z,y:A,dur:0,isAbsolute:true});g=E.x;h=E.y;_lastOrx=r};var v=function(x){l.refresh();l._.canvas.broadcast()};function w(){e.drag(o,n,v)}return l}})(Slatebox,Slatebox.fn.slate);(function(b,c,a){c.fn._signalr=function(){var h=this,y,j=[],w,v=[],e,g,l,m,k,d=[],f,x;h.subscribers=j;h.init=function(H){var I={key:"",un:"",up:"",ip:"",throttle:250,url:""};b.extend(I,H);l=I.un;m=I.up;k=I.ip;x=h._.options.collaboration;if(!b.localRecipients){b.localRecipients=[]}if(!x.localizedOnly){connection=a.hubConnection(I.url);y=connection.createProxy(h._.options.id)}G();if(h._.options.collaboration.callbacks.onCollaborationWired){x.callbacks.onCollaborationWired.apply(this,[f,function(){E(I)}])}else{E(I)}};function E(I){var H={};if(x.useLongPolling){H={transport:"longPolling"}}if(x.useJsonp){H={jsonp:true}}var J={type:"onRollCall",data:{name:I.un,profileImage:I.up,ip:I.ip}};if(x.localizedOnly){b.localRecipients.push(h);A(J)}else{connection.start(H).done(function(){b.localRecipients.push(h);A(J)})}}h.invoke=function(H){f[H.type](H)};function r(I){if(y&&I.id!==y.connection.id){f[I.type](I)}else{if(b.localRecipients.length>1){var H=0;for(var J in b.localRecipients){H+=100;(function(K,L){setTimeout(function(){K._["signalr"]["invoke"](I)},L)})(b.localRecipients[J],H)}}}}function G(){if(!x.localizedOnly){y.on("broadcast",function(H){r(H)})}f={onRollCall:function(H){F(H);var H={type:"onRollCallResponse",data:{name:l,profileImage:m,ip:k}};A(H);z();u(j)},onRollCallResponse:function(H){F(H);z();u(j)},onChat:function(H){o(H)},onZoom:function(H){var I=(h._.options.viewPort.originalWidth/H.data.zoomLevel)*100;h._.canvas.zoom({dur:H.data.duration||500,zoomPercent:I,callbacks:{during:function(K,J){},after:function(J){o(H,"That was me\n zooming the canvas!")}}})},onNodePositioned:function(I){var H=h._.nodes.one(I.data.id);H.position(I.data.location,function(){},I.data.easing,I.data.duration||500);o(I,"That was me\n positioning the node!")},onNodeLinkRemoved:function(H){cn=h._.nodes.one(H.data.id);cn.links&&cn.links.unset();o(H,"That was me\n removing the link!")},onNodeLinkAdded:function(H){cn=h._.nodes.one(H.data.id);cn.links&&cn.links.set(H.data.linkType,H.data.linkData);o(H,"That was me\n adding the resource link!")},onNodeUnlocked:function(H){cn=h._.nodes.one(H.data.id);cn.options.allowDrag=true;h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n unlocking the node!")},onNodeLocked:function(H){cn=h._.nodes.one(H.data.id);cn.options.allowDrag=false;h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n locking the node!")},onNodeToBack:function(H){cn=h._.nodes.one(H.data.id);cn.vect.toBack();h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n send to back!")},onNodeToFront:function(H){cn=h._.nodes.one(H.data.id);cn.vect.toFront();h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n bringing to front!")},onNodeShapeChanged:function(H){cn=h._.nodes.one(H.data.id);cn.shapes.set(H.data);h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n changing the shape!")},onNodeAdded:function(I){var H=(I.preserve!==undefined)?I.preserve:true;h._.loadJSON(I.data,H);h._.birdseye&&h._.birdseye.refresh();o(I,"That was me\n adding the node!")},onNodeImageChanged:function(H){cn=h._.nodes.one(H.data.id);cn.images.set(H.data.img,H.data.w,H.data.w);h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n changing the image!")},onNodeAttached:function(H){cn=h._.nodes.one(H.data.id);cn.relationships.attach();h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n re-attaching the node!")},onNodeDetatched:function(I){var H=h._.nodes.one(I.data.id);H.relationships.detatch();h._.birdseye&&h._.birdseye.nodeDetatched(I);o(I,"That was me\n detatching the node!")},onNodeDeleted:function(H){cn=h._.nodes.one(H.data.id);cn.del();h._.birdseye&&h._.birdseye.nodeDeleted(H);o(H,"That was me\n deleting the node!")},onNodeResized:function(H){cn=h._.nodes.one(H.data.id);cn.resize.set(H.data.width,H.data.height,500);h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n changing the size!")},onNodeColorChanged:function(H){cn=h._.nodes.one(H.data.id);cn.colorpicker.set(H.data);h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n changing the color!")},onNodeTextChanged:function(H){cn=h._.nodes.one(H.data.id);cn.editor.set(H.data.text,H.data.fontSize,H.data.fontColor);h._.birdseye&&h._.birdseye.nodeChanged(H);o(H,"That was me\n changing the text!")},addRelationship:function(H){h._.nodes.addRelationship(H.data);h._.birdseye&&h._.birdseye.relationshipsChanged(H);o(H,"That was me\n adding the relationship!")},removeRelationship:function(H){h._.nodes.removeRelationship(H.data);h._.birdseye&&h._.birdseye.relationshipsChanged(H);o(H,"That was me\n removing the relationship!")},onNodeMove:function(H){cn=h._.nodes.one(H.data.id);cn.move(H);o(H,"That was me\n moving the node!")},onCanvasMove:function(I){var H={x:I.data.left,y:I.data.top,dur:I.data.duration||500,callback:{after:function(){h._.birdseye&&h._.birdseye.refresh(true)}},isAbsolute:true};h._.canvas.move(H);o(I,"That was me\n moving the canvas!")}}}h.send=function(H){A(H)};h.hide=function(){e.style.display="none"};h.show=function(){if(h._.options.collaboration.showPanel){e.style.display="block"}};h.disconnect=function(H){H.apply(this)};h.attach=function(J){var I=b.guid();var H={id:I,eve:J};v.push(H);return I};h.detatch=function(H){v=_.filter(v,function(I){return I.id!==H})};b.addEvent(window,"resize",function(H){if(e){g=b.windowSize();D()}});function u(H){b.each(v,function(){this.eve.apply(h,[H])})}function s(I){var H=0;for(i=0;i<j.length;i++){if(j[i].ip==="127.0.0.1"){H++}if(j[i].ip===I.ip&&I.ip!==""&&H<2){return i}}return -1}function o(L,K){var J=s(L);if(J>-1){var H=j[J].id;if(K){L.msg=K}if(b.isFunction(x.callbacks.onCollaboration)){x.callbacks.onCollaboration.apply(this,[j[J].name,K,L])}var I=-1;b.each(d,function(){I++;if(this.id===H){d[I].showing=true;d[I].messages.push(L.msg);B(d[I]);return}})}}function F(I){var H=s(I);if(H===-1){j.push(I.data)}else{b.extend(j[H],{ip:I.data.ip,name:I.data.name,profileImage:I.data.profileImage})}}function z(){if(h._.options.collaboration.showPanel){if(j.length<=0){if(e){document.body.removeChild(e)}e=null;return}g=b.windowSize();if(!e){e=document.createElement("div");e.setAttribute("id","slateCollaborators_"+h._.options.id);e.style.position="absolute";e.style.height="222px";e.style.width="180px";e.style.border="1px solid #333";e.style.backgroundColor="#fff";e.style.display="block";if(h._.options.collaboration.panelContainer){var N=b.ensureEle(h._.options.collaboration.panelContainer);N.appendChild(e)}else{document.body.appendChild(e)}D()}else{e.innerHTML=""}d=[];b.each(b.select("div.chatBubble"),function(){document.body.removeChild(this)});var H="";var K="<div id='chatBubble_{id}' style='border-bottom:1px solid #000;clear:both;height:80px;padding:3px;background-color:{color}'><div style='float:left;' class='slate_collaborator' rel='{id}'><img src='{image}' style='width:80px;'/></div><div style='float:right;'>{name}</div></div>";var I=0,J=2,L=0,M="";b.each(j,function(){I++;if(I<=J){var P=this.profileImage||h._.options.imageFolder+"user.png";var O="#fff";if(this.ip===k){O="#ffff99";if(this.name.indexOf("YOU")==-1){this.name=this.name+"<br/>(YOU)"}}H+=K.replace(/{id}/gi,this.id).replace(/{name}/gi,this.name).replace(/{image}/gi,P).replace(/{color}/g,O);d.push({id:this.id,owner:"chatBubble_"+this.id,bubble:q(),showing:false,messages:[],clr:O})}else{M+=this.name+" ";L++}});H+="<div style='clear:both;'>"+L+" user(s) waiting</div>";H+="<div style='clear:both;'><input type='text' id='txtChat_"+h._.options.id+"' maxlength='26' style='height:17px;color:#333;width:174px;font-size:10pt;' value='type to chat and hit enter'/></div>";e.innerHTML=H;setTimeout(function(){var O=b.el("txtChat_"+h._.options.id);O.onblur=function(P){if(O.value===""){O.value="type to chat and hit enter";O.style.color="#333"}else{O.style.color="#000"}};O.onfocus=function(P){if(O.value==="type to chat and hit enter"){O.value="";O.style.color="#000"}};O.onkeypress=function(P){var R=O.value;if(b.getKey(P)===13&&R!==""){P.preventDefault();var Q={type:"onChat",msg:R};O.value="";A(Q);o(Q)}}},100)}}function A(H){if(h._.options.collaboration.allow){h._.setChanged(true);if(b.isFunction(h._.options.onSlateChanged)){h._.options.onSlateChanged.apply(this,[j.length])}H.ip=k;H.slateId=h._.options.id;if(x.localizedOnly){r(H)}else{H.id=y.connection.id;y.invoke("broadcast",H)}}}function D(){if(h._.options.collaboration.panelContainer){var I=b.ensureEle(h._.options.collaboration.panelContainer);var H=b.getDimensions(I);switch(h._.options.collaboration.panelLocation){case"upperright":e.style.left=(H.width-185)+"px";e.style.top="0px";break;default:e.style.left=(H.width-185)+"px";e.style.top=(H.height-227)+"px";break}}else{e.style.left=(g.width-185)+"px";e.style.top=(g.height-227)+"px"}}function q(){var H=document.createElement("div");H.setAttribute("class","chatBubble");H.style.position="absolute";H.style.display="none";document.body.appendChild(H);return H}function B(H){if(H.showing){var J=b.positionedOffset(b.el(H.owner));H.bubble.style.left=J.left-150+"px";H.bubble.style.top=J.top-40+"px";H.bubble.style.display="block";if(!H.r){H.r=new Raphael(H.bubble,180,130)}var I=H.clr||"#fff";H.rsb=n(H.r,70,30,H.messages[H.messages.length-1],I);if(H.chatWire!==null){window.clearTimeout(H.chatWire)}H.chatWire=window.setTimeout(function(){H.bubble.style.display="none";H.showing=false;H.rsb&&H.rsb.remove();window.clearTimeout(H.chatWire);H.chatWire=null},5000)}}function C(){b.each(d,function(){B(this)})}function n(J,L,M,K,I){var H=J.speechbubble(L,M,K);if(I!==undefined){H[0].attr({fill:I})}return H}return h}})(Slatebox,Slatebox.fn.slate,jQuery);(function(a,b){b.fn._zoomSlider=function(){var c=this,d;c.setValue=function(e){d&&d.setValue(e)};c.hide=function(){if(a.el("slateSlider")!==null){c._.options.container.removeChild(a.el("slateSlider"))}};c.show=function(e){c.hide();var g={height:320,width:70,offset:{left:10,top:50},slider:{height:300,min:6000,max:200000,set:5000}};a.extend(g,e);var f=c._.options.container;var h=document.createElement("div");h.setAttribute("id","slateSlider");h.style.position="absolute";h.style.height=g.height+"px";h.style.width=g.width+"px";h.style.left=g.offset.left+"px";h.style.top=g.offset.top+"px";f.appendChild(h);g.paper=Raphael("slateSlider",g.width,g.height);d=g.paper.slider(g.slider.height,g.slider.min,g.slider.max,g.slider.set,function(j){if(Raphael.svg){c._.zoom(0,0,j,j,false);c._.canvas.resize(j)}},function(j){c.set(j);c._.signalr&&c._.signalr.send({type:"onZoom",data:{zoomLevel:j}})})};c.set=function(e){c._.zoom(0,0,e,e,false);c._.canvas.resize(e);var f=c._.options.viewPort.zoom;c._.options.viewPort.width=f.w;c._.options.viewPort.height=f.h;c._.options.viewPort.left=f.l;c._.options.viewPort.top=f.t};return c}})(Slatebox,Slatebox.fn.slate);(function(a,b){b.fn._keyboard=function(){var d=this,e=null;d.start=function(f){e=f;a.addEvent(document,"keydown",c)};var c=function(g){var f=a.getKey(g);if(e){e.context&&e.context.hide();switch(f){case 39:e.connectors.addUnpinnedNode(true);break;case 40:e.connectors.addPinnedNode(true);break;case 46:e.toolbar.del();break}return a.stopEvent(g)}else{if(d._.multiselection&&d._.multiselection.isSelecting()){switch(f){case 46:d._.multiselection.del();break}}}};d.end=function(){e=null;if(!d._.multiselection.isSelecting()){a.removeEvent(document,"keydown",c)}};return d}})(Slatebox,Slatebox.fn.slate);(function(a,b){b.fn._multiselection=function(){var h=this,v=null,o,q,c,k=null,u=[],n=null,s=null,m=100;h.init=function(){var x=h._.options.container;c=document.createElement("div");c.style.position="absolute";c.style.height="18px";c.style.left="1px";c.style.color="#081272";c.style.fontSize="11pt";c.style.fontFamily="trebuchet ms";c.style.top="1px";c.style.display="block";c.style.padding="5px";c.style.backgroundColor="#f8f8f8";c.style.cursor="pointer";c.innerHTML="[multi-select]";x.appendChild(c);a.addEvent(c,"click",function(y){switch(c.innerHTML){case"[multi-select]":h.start();break;case"selecting [click to stop]...":h.end();break}})};h.hide=function(){if(c){c.style.display="none"}};h.show=function(){if(c){c.style.display="block"}};h.start=function(){h._.disable();c.innerHTML="selecting [click to stop]...";h._.onSelectionStart=function(x){var y=w(x);v=h._.paper.rect(y.x,y.y,10,10).attr({"stroke-dasharray":"-"});a.addEvent(h._.canvas.get(),"mousemove",d);a.addEvent(h._.canvas.get(),"mouseup",g);o=y.x;q=y.y}};h.isSelecting=function(){return(k!==null)};h.del=function(){if(confirm("Are you sure you want to remove the selected nodes?")){a.each(u,function(){this.toolbar.del()});h.end()}};h.end=function(){if(k!==null){s.unmouseover(f);k.remove();s.remove();k=null;h._.keyboard&&h._.keyboard.end()}if(c){c.innerHTML="[multi-select]"}};h.endSelection=function(){v&&v.remove();h._.enable();h._.onSelectionStart=null;a.removeEvent(h._.canvas.get(),"mousemove",d);a.removeEvent(h._.canvas.get(),"mouseup",g)};var w=function(A){var B=a.mousePos(A);var C=a.positionedOffset(h._.options.container);var x=B.x+h._.options.viewPort.left-C.left;var y=B.y+h._.options.viewPort.top-C.top;var D=h._.options.viewPort.zoom.r;return{x:x/D,y:y/D}};var d=function(x){p=w(x);var y=p.y-q;var z=p.x-o;if(y>0){v.attr({height:y})}else{v.attr({y:p.y,height:(q-p.y)})}if(z>0){v.attr({width:z})}else{v.attr({x:p.x,width:(o-p.x)})}};var g=function(A){var E=v.getBBox();var C=h._.options.viewPort.left;var F=h._.options.viewPort.top;var H=h._.options.viewPort.zoom.r;u=_.filter(h._.nodes.allNodes,function(z){return((z.options.xPos+z.options.width>E.x&&z.options.xPos<E.x+E.width)&&(z.options.yPos+z.options.height>E.y&&z.options.yPos<E.y+E.height))});if(u.length>1){var D=h._.getOrientation(u);var G=D.width/H;var B=D.height/H;if(G<m){G=m}if(B<m){B=m}k=h._.paper.rect(D.left/H,D.top/H,G,B).attr({"stroke-dasharray":"-",fill:"#f8f8f8"});k.toBack();n=k.getBBox();h.endSelection();var x=n.x+n.width;var y=n.y+n.height;s=h._.paper.resize(h._.options.imageFolder+"2_lines.png").transform(["t",x-5,",",y-5].join()).attr({fill:"#fff",stroke:"#000"});s.mouseover(f);k.drag(l.move,l.init,l.up);s.drag(r.move,r.init,r.up);h._.unMarkAll();a.each(u,function(){this.connectors.remove();this.resize.hide()});h._.keyboard&&h._.keyboard.start()}else{if(u.length===1){u[0].menu.show();u[0].mark();h.endSelection();h.end()}else{h.endSelection();h.end()}}};var f=function(x){s.attr({cursor:"nw-resize"})};var l={init:function(z,A){h._.options.viewPort.allowDrag=false;k.ox=k.attr("x");k.oy=k.attr("y");a.each(u,function(){this.vect.ox=this.vect.type=="rect"?this.vect.attr("x"):this.vect.attr("cx");this.vect.oy=this.vect.type=="rect"?this.vect.attr("y"):this.vect.attr("cy")})},move:function(B,C){var z=h._.options.viewPort.zoom.r;B=B+((B/z)-B);C=C+((C/z)-C);var A={x:k.ox+B,y:k.oy+C};k.attr(A);a.each(u,function(){this.setPosition({x:this.vect.ox+B,y:this.vect.oy+C})});var x=n.x+n.width+B-5;var y=n.y+n.height+C-5;s.transform(["t",x,",",y].join(""))},up:function(y){h._.options.viewPort.allowDrag=true;h._.birdseye&&h._.birdseye.refresh(true);var x=_(u).chain().pluck("options").pluck("id").value();a.each(u,function(){if(this.options.isPinnedExact){var z=_(this.relationships.parents).chain().pluck("parent").pluck("options").pluck("id").value();if(_.intersect(x,z).length===0){this.relationships.detatch(true);var A={type:"onNodeDetatched",data:{id:this.options.id}};h._.signalr&&h._.signalr.send(A);h._.birdseye&&h._.birdseye.nodeDetatched(A);this.refresh()}}j(this)});n=k.getBBox()}};function e(){var x=k.getBBox();var z=x.x+x.width/2;var B=x.y+x.height/2;var A=x.height/n.height;var y=x.width/n.width;a.each(u,function(){var E=z+(y*(this.options.xPos-z));var F=B+(A*(this.options.yPos-B));this.setPosition({x:E,y:F});var D=y*this.options.width;var C=A*this.options.height;this.resize.set(D,C,0)})}function j(x){h._.signalr&&h._.signalr.send({type:"onNodeMove",data:{id:x.options.id,x:x.options.xPos,y:x.options.yPos}})}var r={init:function(){h._.disable();a.each(u,function(){this.vect.ox=this.vect.type=="rect"?this.vect.attr("x"):this.vect.attr("cx");this.vect.oy=this.vect.type=="rect"?this.vect.attr("y"):this.vect.attr("cy")})},move:function(D,E){var B=h._.options.viewPort.zoom.r;D=D+((D/B)-D);E=E+((E/B)-E);var A=n.width+(D*2);var x=n.height+(E*2);var y=n.x+n.width+D-5;var z=n.y+n.height+E-5;var G=true,F=true;if(A<m){A=m;G=false}if(x<m){x=m;F=false}s.transform(["t",y,",",z].join(""));var C={width:A,height:x};G&&a.extend(C,{x:n.x-D});F&&a.extend(C,{y:n.y-E});k.attr(C)},up:function(){h._.enable();e();a.each(u,function(){this.resize.send();j(this)});h._.birdseye&&h._.birdseye.refresh(true);n=k.getBBox();var x=n.x+n.width;var y=n.y+n.height;s.transform(["t",x-5,",",y-5].join(""))}};return h}})(Slatebox,Slatebox.fn.slate);(function(b,a){a.fn._colorpicker=function(c){var g={colors:[{hex:"000000",to:"575757"},{hex:"FFFFFF",to:"d9d9d9"},{hex:"FF0000",to:"a31616"},{hex:"C3FF68",to:"afff68"},{hex:"0B486B",to:"3B88B5"},{hex:"FBB829",to:"cd900e"},{hex:"BFF202",to:"D1F940"},{hex:"FF0066",to:"aa1d55"},{hex:"800F25",to:"3d0812"},{hex:"A40802",to:"d70b03"},{hex:"FF5EAA",to:"cf5d93"},{hex:"740062",to:"D962C6"},{hex:"FF4242",to:"A61515"},{hex:"D15C57",to:"9D5C58"},{hex:"FCFBE3",to:"c9c56f"},{hex:"FF9900",to:"c98826"},{hex:"369001",to:"9CEE6C"},{hex:"9E906E",to:"675324"},{hex:"F3D915",to:"F9EA7C"},{hex:"031634",to:"2D579A"},{hex:"556270",to:"7b92ab"},{hex:"1693A5",to:"23aad6"},{hex:"ADD8C7",to:"59a989"},{hex:"261C21",to:"EB9605"}],useColorLovers:false};b.extend(g,c);if(g.colors!==null){b.availColors=g.colors}var d=this;function f(j){if(b.availColors===undefined){var h="http://www.colourlovers.com/api/colors/top&jsonCallback=?";b.getJSON(h,function(k){b.availColors=k;if(b.isFunction(j)){j.apply(this,[b.availColors])}})}else{if(b.isFunction(j)){j.apply(this,[b.availColors])}}}d.prepColors=function(){f()};d.show=function(n,o,h){var m=h[4].attr("width");var j=m-125;var k=n+j;var l=o+5;f(function(q){var x=-1,u=6,v=d._.slate.paper,y=15,r=15,s=4;b.each(q,function(){x++;if(x%u===0&&x!==0){l+=r+s;k=d._.options.xPos+j;if(d._.options.vectorPath==="ellipse"){k=k-d._.options.width/2}}var w=this.hex;var A=this.to;var z=v.rect(k,l,y,r,3).attr({stroke:"#000",fill:["90-#",w,"-#",A].join("")});z.mouseover(function(B){d._.slate.glow(this)});z.mouseout(function(B){d._.slate.unglow()});z.mousedown(function(F){this.loop();var B=this.attr("fill");var D="#"+B.split(/90-#/g)[1].split(/-#/g)[0];var E=Raphael.rgb2hsb(D).b<0.4?"#fff":"#000";if(d._.options.image!==""){d._.options.image=""}var C={type:"onNodeColorChanged",data:{id:d._.options.id,color:B}};e(C);d._.slate.birdseye&&d._.slate.birdseye.nodeChanged(C)});h.push(z);k+=y+s;if(x>19){return}})})};function e(h){d.set(h.data);d._.slate.signalr&&d._.slate.signalr.send(h)}d.set=function(h){d._.options.backgroundColor=h.color;d._.vect.attr({fill:h.color});d._.relationships.refresh()};return d}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._connectors=function(){var d=this;var f;var g=3;var c={options:{xPos:null,width:null,yPos:null}};d.remove=function(){_.invoke(f,"remove")};d.removeSettingsButton=function(){f.setting.remove()};d.show=function(z,A,k,q){var o=15;var u=d._.slate.paper;A=A+80;px=z;py=A;var l=z+d._.options.width;var m=A+(d._.options.height/2);var h=z+(d._.options.width/2);var j=A+d._.options.height;var s=15,w=0.75,n={fill:"#fff",stroke:"#000"};f={setting:u.setting().transform(["t",z+d._.options.width/2-17,",",A-22].join()).attr(n),unPinned:u.arrow().transform(["t",l-16,",",m-16,"s",w,w].join()).attr(n),pinned:u.arrow().transform(["t",h-13,",",j-9,"s",w,w,"r","90"].join()).attr(n)};b.each(["mousedown"],function(){f.setting[this](function(r){d._.slate.unglow();q.apply(this);this.remove();d._.slate.multiselection&&d._.slate.multiselection.end();d._.context&&d._.context.hide();d._.editor&&d._.editor.end();d._.images&&d._.images.end();d._.links&&d._.links.end()});f.unPinned[this](function(r){d._.slate.unglow();d._.connectors.addUnpinnedNode();this.loop();d._.context&&d._.context.hide()});f.pinned[this](function(r){d._.slate.unglow();d._.connectors.addPinnedNode();this.loop();d._.context&&d._.context.hide()})});b.each(f,function(){k.push(this);this.mouseover(function(r){d._.slate.glow(this)});this.mouseout(function(r){d._.slate.unglow()})});var v=d._.resize.show(l,j);k.push(v);return d};d.reset=function(){c={options:{xPos:null,width:null,yPos:null}}};function e(h){var j={type:"onNodeAdded",data:d._.slate.exportDifference(h)};d._.slate.signalr&&d._.slate.signalr.send(j)}d.addUnpinnedNode=function(l){var j=d._.slate.snapshot();var h=b.clone(d._.options);delete h.id;delete h.link;h.xPos=(c.xPos||d._.options.xPos)+(d._.options.width||c.width)+10;h.text="";h.width=d._.options.width;h.height=d._.options.height;var k=b.instance.node(h);d._.slate.nodes.add(k);c=k.options;e(j);d._.slate.birdseye&&d._.slate.birdseye.refresh(false);d._.slate.unMarkAll();if(l===undefined){k.position("center",function(){k.editor&&k.editor.start()})}return k};d.addPinnedNode=function(l){var j=d._.slate.snapshot();var h=b.clone(d._.options);delete h.id;delete h.link;h.text="";if(d._.options.image===""){h.width=50;h.height=50}h.isPinnedExact=true;h.showParentArrow=false;h.showChildArrow=false;var k=b.instance.node(h);d._.slate.nodes.add(k);d._.relationships.addChild(k);d._.pinChildNodes();e(j);d._.slate.birdseye&&d._.slate.birdseye.refresh(false);d._.slate.unMarkAll();if(l===undefined){k.position("center",function(){k.editor&&k.editor.start()})}return k};return d}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._editor=function(){var f=this,h=b.guid().replace("-",""),k=[],d,g,c,j,l,e;f.editing=false;f.start=function(){f.editing=true;f._.slate.keyboard&&f._.slate.keyboard.end();j=f._.slate.paper.rect(-99,-99,8,1).attr({fill:"#000"}).loop({pkg:[{fill:"#fff"},{fill:"#000"}],duration:500,repeat:true});f._.slate.nodes.closeAllMenus();var q="",o;function s(){var u="<select id='ddlTxtSize'>";for(ptx=10;ptx<201;ptx++){if(ptx%2===0){u+="<option>"+ptx+"</option>"}}u+="</select>";return u}function n(){var v="<div style='float:left;padding:3px;margin-right:5px;background-color:#f8f8f8;border:1px solid #ccc;cursor:pointer;' class='changeTextColor' rel='{text}'><div style='width:30px;height:30px;background-color:{color};float:left;border:1px solid #333;'></div></div>";var u=v.replace(/{color}/gi,"#000").replace(/{text}/gi,"black");u+=v.replace(/{color}/gi,"#FFF").replace(/{text}/gi,"white");return u}function r(u,w){f.set(null,null,u);var v=b.el("txtForNode");v.style.backgroundColor=w;v.style.color=u;v.focus()}if(b.select("div.embedBar").length>0){b.each(b.select("div.embedBar"),function(){document.body.removeChild(this)})}e=new Notify().message({hgt:120,duration:200,className:"embedBar",delayClose:0,spinner:null,hideClose:false,popFromBottom:true,onClose:function(){f.end()},onOpen:function(v,u){v.innerHTML="<div style='width:900px;'>แก้ไขข้อความ<br/><div style='float:left;margin-right:8px;height:60px;'><textarea id='txtForNode' style='text-align:center;width:500px;height:70px;'></textarea></div><div style='float:left;margin-right:20px;'>Size "+s()+" pt&nbsp;&nbsp;<button id='btnSubmitText' style='width:80px;font-size:14pt;'>Update</button><div id='textColorPicker' style='margin-top:4px;'></div></div></div>";q=f._.options.text;o=f._.options.fontSize;b.el("txtForNode").value=q;b.el("txtForNode").select();b.el("btnSubmitText").onclick=function(w){f.end();m()};b.el("ddlTxtSize").value=o;b.el("ddlTxtSize").onchange=function(w){var x=this.options[this.selectedIndex].value;f.set(f._.options.text,x)};b.el("textColorPicker").innerHTML=n();b.each(b.select("div.changeTextColor"),function(){var w=this;w.onclick=function(x){w.style.border="1px solid red";switch(w.getAttribute("rel")){case"black":r("#000","#fff");break;case"white":r("#fff","#000");break}};w.onmouseover=function(x){w.style.border="1px solid red"};w.onmouseout=function(x){w.style.border="1px solid #ccc"}});b.el("txtForNode").onkeyup=function(B){var z=this.value;if(z===""){z=" "}var y=f._.text;f._.options.text=z;var C=b.getKey(B||event);y.attr({text:(C===13||C===32)?z+" ":z});var D=y.getBBox();if(C===13||C===32){setTimeout(function(){y.attr({text:f._.options.text})},0)}var x=y.attr("text").split("\n");l=f._.slate.paper.text(-99,-99,x[x.length-1]).attr({"font-size":f._.options.fontSize+"pt"});var w=l.getBBox();l.remove();f.resize();f.resize();f._.mark();f._.refresh();var A=(x.length>1?(D.width/2+w.width/2):D.width);j.attr({x:D.x+A,y:D.y+D.height,"font-size":f._.options.fontSize+"pt"})}}});f._.mark()};f.set=function(q,o,n){q&&(f._.options.text=q);o&&(f._.options.fontSize=o);n&&(f._.options.foregroundColor=n);q&&(f._.text.attr({text:q}));o&&(f._.text.attr({"font-size":+o+"pt"}));n&&(f._.text.attr({fill:n}));f.resize();f.resize()};function m(){var n={type:"onNodeTextChanged",data:{id:f._.options.id,text:f._.options.text,fontSize:f._.options.fontSize,fontColor:f._.options.foregroundColor}};if(f._.slate.signalr){f._.slate.signalr.send(n)}if(f._.slate.birdseye){f._.slate.birdseye.nodeChanged(n)}}f.resize=function(){var w=f._.text;var x=20;var y=20;if(f._.options.vectorPath==="ellipse"){x=30;y=30}var v=false;if(w.attr("text")===" "){w.attr("text",".");v=true}var A=w.getBBox();if(v){w.attr("text"," ")}var r=A.width+x,q=A.height+y,s=A.x-x/2,u=A.y-y/2,n=A.x+(f._.options.width/2)-x/2,o=A.y+(f._.options.height/2)-y/2;if(r<f._.options.width){r=f._.options.width;s=f._.options.xPos;n=f._.options.xPos}if(q<f._.options.height){q=f._.options.height;u=f._.options.yPos;o=f._.options.yPos}var z=f._.vect.type=="rect"?{x:s,y:u}:{cx:n,cy:o};var B=f._.vect.type=="rect"?{width:r,height:q}:{rx:r/2,ry:q/2};b.extend(z,B);f._.vect.attr(z);f._.options.xPos=s;f._.options.width=r;f._.options.yPos=u;f._.options.height=q;f._.link.attr(f._.linkCoords())};f.end=function(){f.editing=false;f._.unmark();if(e&&e.visible()){m()}e&&e.closeMessage();if(j){j.remove();j=null}};return f}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._links=function(){var d=this,c;var g={thumbUrl:"/Thumbnail",existenceUrl:"/UrlExists"};d.start=function(j){d._.slate.nodes.closeAllMenus();b.extend(g,(j||{}));c=new Notify().message({hgt:185,duration:200,className:"embedBar",delayClose:0,spinner:null,hideClose:false,popFromBottom:true,onOpen:function(l,k){d._.slate.unglow();l.innerHTML="<div style='width:900px;'><div id='linkForm'><div id='provideUrlPlaceholder' style='height:75px;width:900px;'><span style='font-size:20pt;' id='spnEmbedAction'>Provide an external link (will always open in a new window)</span><br/><span style='font-size:20pt;color:#ccc;' id='embedUrlPrefix'>http://</span><input type='text' id='txtUrl' style='width:450px;font-size:20pt;'/>&nbsp;<button id='btnApply' style='font-size:20pt;'>go</button>&nbsp;<button id='btnRemove' style='font-size:20pt;visibility:hidden;'>remove</button></div><div id='messagePlaceholder' style='display:none;height:75px;font-size:20pt;width:900px;'></div><div style='margin-top:10px;padding:3px;width:800px;height:63px;font-size:14pt;'>WHERE do you want to link to?<div style='border-top:1px dashed #ccc;padding:5px;font-size:12pt;'><label for='radioLinkUrl' style='float:left;cursor:pointer;'><input type='radio' id='radioLinkUrl' name='linkType' checked/>an EXTERNAL website</label><label for='radioLinkSlate' style='float:left;margin-left:15px;cursor:pointer;'><input type='radio' id='radioLinkSlate' name='linkType'/>a node on THIS slate</label><label for='radioLinkExternalSlate' style='margin-left:15px;float:left;cursor:pointer;display:none;'><input type='radio' id='radioLinkExternalSlate' name='linkType' disabled/>a DIFFERENT slate<br/>(coming soon)</label></div></div></div><div id='processForm' style='font-size:20pt;'></div></div>";d._.link.hide();b.el("txtUrl").focus();d._.mark();if(d._.options.link&&d._.options.link.show){b.el("btnRemove").style.visibility="visible"}b.addEvent(b.el("btnRemove"),"click",function(m){d.unset();var n={type:"onNodeLinkRemoved",data:{id:d._.options.id}};if(d._.slate.signalr){d._.slate.signalr.send(n)}return b.stopEvent(m)});b.addEvent(b.el("txtUrl"),"keypress",function(m){if(b.getKey(m)===13){e()}});b.addEvent(b.el("txtUrl"),"focus",function(m){this.select()});b.addEvent(b.el("btnApply"),"click",function(m){e();return b.stopEvent(m)});b.addEvent(b.el("radioLinkUrl"),"click",function(m){h();b.el("provideUrlPlaceholder").style.display="block";b.el("messagePlaceholder").style.display="none"});b.addEvent(b.el("radioLinkSlate"),"click",function(m){d._.slate.options.linking={onNode:function(n){d.set("currentSlate",n.options.id,true);var o={type:"onNodeLinkAdded",data:{id:d._.options.id,linkType:"currentSlate",linkData:n.options.id}};if(d._.slate.signalr){d._.slate.signalr.send(o)}k&&k.resize(50,300,function(){k.changeMessage("You've set the link! Returning you to your original node in a moment...");setTimeout(function(){d._.position("center",function(){k.changeMessage("The connection is all set!");setTimeout(function(){k&&k.closeMessage()},1500)},"swingFromTo",1500)},2000)});h()}};b.el("provideUrlPlaceholder").style.display="none";b.el("messagePlaceholder").style.display="block";b.el("messagePlaceholder").innerHTML="Scroll the slate to the node you'd like to link to and click it."});b.addEvent(b.el("radioLinkExternalSlate"),"click",function(m){d._.slate.options.linking={onSlate:function(n){}};b.el("provideUrlPlaceholder").style.display="none";b.el("messagePlaceholder").style.display="block";b.el("messagePlaceholder").innerHTML="Select the slate that you'd like to link to using the menu above."})},onClose:function(){if(d._.options.link.show){d._.link.show()}}})};function h(){d._.slate.options.linking=null}function f(l,j){var k=JSON.stringify({Url:l});b.el("btnApply").setAttribute("disabled","disabled");b.el("btnApply").innerHTML="Checking...";b.ajax(g.existenceUrl,function(o,n){var m=JSON.parse(o);b.el("btnApply").removeAttribute("disabled","disabled");b.el("btnApply").innerHTML="go";j.apply(this,[m.exists])},k,"POST")}function e(){var j=b.el("txtUrl").value.replace(/http:\/\//gi,"");f(j,function(k){if(k!==true){alert("Sorry but "+j+" doesn't look to be a valid URL. Please check it!")}else{d.set("externalUrl",j,true);var l={type:"onNodeLinkAdded",data:{id:d._.options.id,linkType:"externalUrl",linkData:j}};if(d._.slate.signalr){d._.slate.signalr.send(l)}}})}d.end=function(){d._.unmark();d._.slate.unglow();c&&c.closeMessage()};d.set=function(m,j,k){if(!d._.options.link){d._.options.link={}}if(!d._.options.link.thumbnail){d._.options.link.thumbnail={width:175,height:175}}switch(m){case"externalUrl":b.extend(d._.options.link,{type:m,data:j,show:true});if(k===true){b.el("linkForm").style.display="none";b.el("processForm").style.display="block";b.el("processForm").innerHTML="<div style='margin-top:-3px;float:left;'><span id='spanFetchThumb'></span></div><div style='margin-left:10px;float:left;margin-top:0px;font-size:14pt;'>Fetching URL Thumbnail (it only takes this long the first time)...</div>";c&&c.resize(50,300,function(){if(b.el("spanFetchThumb")!==null){var n=new spinner("spanFetchThumb",8,16,15,1,"#fff")}});var l=JSON.stringify({Url:d._.options.link.data,Width:d._.options.link.thumbnail.width,Height:d._.options.link.thumbnail.height});b.ajax(g.thumbUrl,function(q,o){var n=JSON.parse(q);b.imageExists(n.url,function(s,u,r){d._.link.show();d.end()})},l,"POST")}else{d._.link.show()}break;case"currentSlate":b.extend(d._.options.link,{type:m,data:j,show:true});break;case"externalSlate":break}};d.unset=function(){b.extend(d._.options.link,{type:"",data:"",show:false});d._.link.hide();d.end()};d.processEvent=function(){switch(d._.options.link.type){case"externalUrl":var k=d._.options.link.data.length>20?d._.options.link.data.substring(0,20)+"...":d._.options.link.data;var j=k;d._.link.tooltip({type:"image",msg:j},d._.options.link.thumbnail.width,d._.options.link.thumbnail.height);var l=JSON.stringify({Url:d._.options.link.data,Width:d._.options.link.thumbnail.width,Height:d._.options.link.thumbnail.height});b.ajax(g.thumbUrl,function(o,n){var m=JSON.parse(o);if(m.url!==""){b.imageExists(m.url,function(r,s,q){d._.link.tt[0].attr({fill:"url("+m.url+")"})})}},l,"POST");break;case"externalSlate":break;case"currentSlate":d._.slate.addtip(d._.link.tooltip({type:"text",msg:"Jump to another node"},140,23));break}};d.wireEvents=function(){d._.link.mouseover(function(j){d._.slate.glow(d._.link);d.processEvent();b.stopEvent(j)});d._.link.mouseout(function(j){d._.slate.unglow();switch(d._.options.link.type){case"externalUrl":d._.link.untooltip();break;case"currentSlate":d._.slate.untooltip();break}b.stopEvent(j)});d._.link.click(function(k){switch(d._.options.link.type){case"externalUrl":window.open(["http://",d._.options.link.data].join(""),"sb_external");break;case"externalSlate":break;case"currentSlate":var l=d._.slate.nodes.one(d._.options.link.data),j=l.vect.getBBox(),m=d._.slate.options.viewPort.zoom.r;l.position("center",function(){l.mark()},"swingFromTo",2000);break}b.stopEvent(k)})};return d}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._menu=function(){var e=this;var d=null;var c=false;e.isOpen=function(){return c};e.show=function(l){if(e._.slate!==null){var k=e._.slate.paper;if(l===undefined){l=3000}if(d){_.invoke(d,"remove");d=null}var j=e._.offset();var g=j.x+e._.slate.options.viewPort.left;var h=j.y+e._.slate.options.viewPort.top-80;d=k.set();e._.connectors.show(g,h,d,function(){f(k,g,h)});if(e.wasOpen){e.wasOpen=false;e._.connectors.removeSettingsButton();f(k,g,h)}}};e.hide=function(){if(d){_.invoke(d,"remove");d=null}c=false};function f(l,h,j){c=true;var g=l.rect(h,j,295,80,10).attr({fill:"90-#ccc-#eee"});g.node.style.cursor="pointer";d.push(g);e._.toolbar.show(h,j,d);e._.colorpicker.show(h,j,d);e._.shapes.show(h,j,d);d.push(l.path(["M",h,j+36,"L",h+160,j+36].join(",")).attr({stroke:"#000"}));d.push(l.path(["M",h+160,j,"L",h+160,j+80].join(",")).attr({stroke:"#000"}));var k=l.deleter().attr({fill:"#ddd",stroke:"#333"}).transform(["t",(h+275),",",(j-13),"s",",",".75",".75"].join());k.mouseover(function(){e._.slate.glow(k)});k.mouseout(function(){e._.slate.unglow()});k.mousedown(function(){e._.slate.unglow();e.hide()});d.push(k)}return e}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._relationships=function(){var g=this;g.parents=[];g.children=[];g.associations=[];function h(s){g._.slate.signalr&&g._.slate.signalr.send(s)}function m(){var s=null;if(g._.slate.birdseye){s=g._.slate.birdseye.refresh(false)}return s}g.addParent=function(u,x,w){var v=g._.slate.paper;var s=v.connection({id:b.guid(),parent:u,child:g._,lineColor:g._.options.lineColor,lineWidth:g._.options.lineWidth,lineOpacity:g._.options.lineOpacity,blnStraight:x.isStraightLine||false,showParentArrow:x.showParentArrow||false,showChildArrow:x.showChildArrow||false});s.line.toBack();g.parents.push(s);u.relationships.children.push(s);if(w===undefined||w===false){r(s)}return s};g.addChild=function(u,v){var w=g._.slate.paper;v=v||{};var s=w.connection({id:b.guid(),parent:g._,child:u,lineColor:g._.options.lineColor,lineWidth:g._.options.lineWidth,lineOpacity:g._.options.lineOpacity,blnStraight:v.isStraightLine||false,showParentArrow:v.showParentArrow||false,showChildArrow:v.showChildArrow||false});s.line.toBack();g.children.push(s);u.relationships.parents.push(s);r(s);return s};g.addAssociation=function(u,v){var w=g._.slate.paper;v=v||{};var s=w.connection({id:b.guid(),parent:g._,child:u,lineColor:g._.options.lineColor,lineWidth:g._.options.lineWidth,lineOpacity:g._.options.lineOpacity,blnStraight:v.isStraightLine||false,showParentArrow:v.showParentArrow||false,showChildArrow:v.showChildArrow||false});s.line.toBack();g.associations.push(s);u.relationships.associations.push(s);r(s);return s};function r(s){if(g._.options.allowMenu){var v=200,u="#ff0";s.line.node.style.cursor="pointer";s.line.mouseover(function(){if(g._.slate.options.enabled){g._.slate.glow(this);s.showChildArrow&&(g._.slate.glow(s.childArrow));s.showParentArrow&&(g._.slate.glow(s.parentArrow))}});s.line.mouseout(function(){g._.slate.unglow()});s.line.mousedown(function(w){if(g._.slate.options.enabled){g._.slate.unglow();var x={type:"removeRelationship",data:{parent:s.parent.options.id,child:s.child.options.id}};g._.slate.nodes.removeRelationship(x.data);g._.slate.birdseye&&g._.slate.birdseye.relationshipsChanged(x);h(x);g.initiateTempNode(w,s.parent)}})}}g.initiateTempNode=function(y,s,z){var A=b.mousePos(y);var u=s.slate;var B=b.positionedOffset(u.options.container);var x=g._.slate.options.viewPort.zoom.r;var C=(u.options.viewPort.left+A.x-B.left);var D=(u.options.viewPort.top+A.y-B.top);var v=b.instance.node({id:g._.slate.tempNodeId,xPos:C+((C/x)-C),yPos:D+((D/x)-D),lineColor:"#990000",backgroundColor:"#ffffff",vectorPath:"ellipse",width:30,height:30});u.nodes.add(v,true);var w=v.relationships.addParent(s,{},true);w.hoveredOver=null;w.lastHoveredOver=null;v.vect.initDrag(y);u.options.viewPort.allowDrag=false;v.vect.mousemove(function(E){g._.slate.paper.connection(w);if(w.hoveredOver===null){w.hoveredOver=k(b.mousePos(E));if(w.hoveredOver!==null){w.hoveredOver.vect.animate({"stroke-width":5},500,function(){w.hoveredOver.vect.animate({"stroke-width":g._.options.borderWidth},500,function(){w.hoveredOver=null})})}else{}}});v.vect.mouseup(function(F){s.relationships.removeChild(v);v.slate.nodes.remove(v);var G=k(b.mousePos(F));if(G!==null){s.relationships.addAssociation(G);var E={type:"addRelationship",data:{type:"association",parent:s.options.id,child:G.options.id}};g._.slate.birdseye&&g._.slate.birdseye.relationshipsChanged(E);h(E)}if(g._.slate.options.enabled){s.slate.options.viewPort.allowDrag=true}})};g.removeAll=function(){b.each(g.children,function(){this.child.relationships.removeParent(g._);g._.slate.paper.removeConnection(this)});b.each(g.parents,function(){this.parent.relationships.removeChild(g._);g._.slate.paper.removeConnection(this)});b.each(g.associations,function(){this.child.relationships.removeAssociation(g._);g._.slate.paper.removeConnection(this)});g.parents=[];g.children=[];g.associations=[]};g.removeParent=function(s){g.parents=n(g.parents,"parent",s);return g};g.removeChild=function(s){g.children=n(g.children,"child",s);return g};g.removeAssociation=function(s){g.associations=n(g.associations,"child",s);g.associations=n(g.associations,"parent",s);return g};function k(s){var v=null;var u=b.positionedOffset(g._.slate.options.container);b.each(g._.slate.nodes.allNodes,function(){if(this.options.id!==g._.slate.tempNodeId&&this.options.id!==g._.options.id){var w=this.vect.getBBox();var x=g._.slate.options.viewPort.zoom.r;var z=(g._.slate.options.viewPort.left+s.x-u.left);var A=(g._.slate.options.viewPort.top+s.y-u.top);var y={x:z+((z/x)-z),y:A+((A/x)-A)};if(y.x>w.x&&y.x<w.x+w.width&&y.y>w.y&&y.y<w.y+w.height){v=this;return}}});return v}function n(u,w,v){var s=new Array();b.each(u,function(){if(this[w].options.id===v.options.id){g._.slate.paper.removeConnection(this)}else{s.push(this)}});return s}var j=function(s,u){if(g._.events&&b.isFunction(g._.events.onClick)){g._.events.onClick.apply(this,[function(){d(this)}])}else{d(this)}};function d(s){g._.slate.multiselection&&g._.slate.multiselection.end();if(g._.slate.options.linking){g._.slate.options.linking.onNode.apply(s,[g._])}else{if(g._.options.allowDrag){s.ox=s.type=="rect"?s.attr("x"):s.attr("cx");s.oy=s.type=="rect"?s.attr("y"):s.attr("cy");g._.setStartDrag()}}}var l=function(v,w){if(g._.options.allowDrag){if(g._.options.isPinnedExact){g.detatch();var u={type:"onNodeDetatched",data:{id:g._.options.id}};g._.slate.signalr&&g._.slate.signalr.send(u);g._.slate.birdseye&&g._.slate.birdseye.nodeDetatched(u)}var s=g._.slate.options.viewPort.zoom.r;v=v+((v/s)-v);w=w+((w/s)-w);g._.setPosition({x:g._.vect.ox+v,y:g._.vect.oy+w})}};var o=function(s){g._.setEndDrag();g._.slate.birdseye&&g._.slate.birdseye.refresh(true);if(g._.slate.options.events&&b.isFunction(g._.slate.options.events.onNodeDragged)){g._.slate.options.events.onNodeDragged.apply(this)}if(g._.context&&!g._.context.isVisible()&&g._.options.allowDrag){g._.slate.signalr&&g._.slate.signalr.send({type:"onNodeMove",data:{id:g._.options.id,x:g._.options.xPos,y:g._.options.yPos}})}};g.reattachable=function(){return _(g._.relationships.parents).chain().pluck("child").pluck("options").pluck("id").any(function(s){return s===g._.options.id}).value()};g.attach=function(){g._.options.isPinnedExact=true;b.each(g._.relationships.parents,function(){if(this.child.options.id===g._.options.id){this.blnStraight=false;this.showChildArrow=false;g._.options.reattachable=false;g._.connectors&&g._.connectors.remove();g._.resize&&g._.resize.hide();this.parent.pinChildNodes();return}})};g.detatch=function(s){g._.options.isPinnedExact=false;g._.options.lineOpacity=1;b.each(g._.relationships.parents,function(){if(this.child.options.id===g._.options.id){this.blnStraight=true;this.showChildArrow=true;this.lineOpacity=1;g._.options.reattachable=true;if(s===undefined){this.parent.pinChildNodes()}return}})};g.refresh=function(){var u=g._.slate.paper;for(var s=g.children.length;s--;){u.connection(g.children[s])}for(var s=g.parents.length;s--;){u.connection(g.parents[s])}for(var s=g.associations.length;s--;){u.connection(g.associations[s])}u.safari()};var f=function(s){g._.slate.options.viewPort.allowDrag=false;g._.slate.keyboard&&g._.slate.keyboard.start(g._);g._.slate.nodes.closeAllMenus(g._.options.id);if(g._.menu&&b.isFunction(g._.menu.show)&&g._.options.allowMenu&&!g._.menu.isOpen()){g._.menu.show()}b.stopEvent(s)};var e=function(s){if(g._.slate.options.enabled){g._.slate.options.viewPort.allowDrag=true}g._.slate.unglow();g._.slate.keyboard&&g._.slate.keyboard.end();b.stopEvent(s)};var c=function(s){if(g._.slate.options.enabled){g._.position("center",function(){g._.editor&&g._.editor.start()})}b.stopEvent(s)};var q=[];g.wireHoverEvents=function(){q=[];q.push({o:g._.vect,over:f,out:e,dbl:c});q.push({o:g._.text,over:f,out:e,dbl:c});if(g._.options.id!==g._.slate.tempNodeId){b.each(q,function(){this.o.mouseover(this.over);this.o.mouseout(this.out);this.o.dblclick(this.dbl)})}};g.unwireHoverEvents=function(){b.each(q,function(){b.each(q,function(){this.o.events&&this.o.unmouseover(this.over);this.o.events&&this.o.unmouseout(this.out);this.o.events&&this.o.undblclick(this.dbl)})})};g.wireDragEvents=function(){g._.vect.drag(l,j,o);g._.text.mousedown(function(s){g._.vect.initDrag(s)})};return g}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._images=function(){var e=this,c,l,d="image";e.imagesearching=false;e.start=function(r){e.imagesearching=true;e._.slate.nodes.closeAllMenus();l={searchPatterns:true,searchImages:true,imageUrl:"/Images?query={query}&size={size}&rpp={rpp}&page={page}",patternUrl:"http://www.colourlovers.com/api/patterns?keywords={query}&orderCol=score&sortBy=DESC&numResults={rpp}&resultOffset={page}&jsonCallback=?",size:"Small",isColor:true,paging:{rpp:4,page:0,total:0}};b.extend(l,r||{});var s;c=new Notify().message({hgt:185,duration:200,className:"embedBar",delayClose:0,spinner:null,hideClose:false,popFromBottom:true,onOpen:function(v,u){v.innerHTML="<div style='width:900px;'><div id='embedDivAction' style='float:left;width:260px;'><span style='font-size:20pt;' id='spnEmbedAction'>Search</span> (to embed in node)<br/><span style='display:none;font-size:20pt;color:#ccc;' id='embedUrlPrefix'>http://</span><input type='text' id='txtSearch' style='width:170px;font-size:20pt;'/>&nbsp;<button id='btnImageSearch' style='font-size:20pt;'>go</button><div id='imgShowSize' style='padding-top:10px'><span id='lblImageSize' style='font-size:12pt;'>Size</span> <select id='ddlImageSize'><option>Icon</option><option selected>Small</option><option>Medium</option><option>Large</option><option>All</option></select><label for='chkAsUrl' style='cursor:pointer'><input type='checkbox' id='chkAsUrl' />Provide URL</label></div><div style='padding-top:10px;font-size:12pt;'><label for='radioImage' style='cursor:pointer;'><input type='radio' id='radioImage' name='imageSearchType' checked/>images</label><label for='radioPattern' style='cursor:pointer;display:none;'><input type='radio' id='radioPattern' name='imageSearchType'/>patterns</label>&nbsp;[<a href='javascript:' id='lnkClearImage'>clear</a>]</div></div><div style='float:left;width:30px;visibility:hidden;margin-right:-10px;margin-left:-10px;font-size:40pt;cursor:pointer;' id='lnkSearchBack' class='imgChanger'> < </div><div style='float:left;width:470px;' id='imgResults'></div><div style='float:left;width:30px;visibility:hidden;margin-right:-10px;margin-left:-10px;font-size:40pt;cursor:pointer;' id='lnkSearchForward' class='imgChanger'> > </div></div>";s=e._.options.image;b.el("ddlImageSize").value=l.size;b.el("txtSearch").focus();e._.mark();b.addEvent(b.el("txtSearch"),"keypress",function(w){if(b.getKey(w)===13){if(b.el("chkAsUrl").checked){h()}else{g();l.paging.page=0;l.paging.total=0}}});b.addEvent(b.el("txtSearch"),"focus",function(w){this.select()});b.addEvent(b.el("btnImageSearch"),"click",function(w){if(b.el("chkAsUrl").checked){h()}else{g();l.paging.page=0;l.paging.total=0}return b.stopEvent(w)});b.addEvent(b.el("lnkSearchForward"),"click",function(w){l.paging.page++;g();return b.stopEvent(w)});b.addEvent(b.el("lnkSearchBack"),"click",function(w){l.paging.page--;g();return b.stopEvent(w)});b.addEvent(b.el("lnkClearImage"),"click",function(w){f("",50,50)});b.addEvent(b.el("radioPattern"),"click",function(w){if(b.el("chkAsUrl").checked){b.el("chkAsUrl").checked=false;q(function(){b.el("imgShowSize").style.visibility="hidden"})}else{b.el("imgShowSize").style.visibility="hidden"}});b.addEvent(b.el("radioImage"),"click",function(w){b.el("imgShowSize").style.visibility="visible"});b.addEvent(b.el("chkAsUrl"),"click",function(w){if(this.checked){b.el("ddlImageSize").style.visibility="hidden";b.el("lblImageSize").style.visibility="hidden";b.el("embedUrlPrefix").style.display="inline";b.el("spnEmbedAction").innerHTML="Provide URL";b.each(b.select("div.imgChanger"),function(){this.style.display="none"});b.el("imgResults").style.display="none";b.el("embedDivAction").style.width="850px";emile(b.el("txtSearch"),"width:600px",{duration:500,after:function(){b.el("txtSearch").setAttribute("placeholder","provide the url to your image")}})}else{q()}});b.each(b.select("div.imgChanger"),function(){b.addEvent(this,"mouseover",function(w){this.style.color="#fff"});b.addEvent(this,"mouseout",function(w){this.style.color="#000"})})}})};var k=function(){return b.el("radioPattern").checked};function q(r){emile(b.el("txtSearch"),"width:170px",{duration:500,after:function(){b.el("ddlImageSize").style.visibility="visible";b.el("lblImageSize").style.visibility="visible";b.el("embedUrlPrefix").style.display="none";b.el("spnEmbedAction").innerHTML="Search";b.each(b.select("div.imgChanger"),function(){this.style.display="block"});b.el("imgResults").style.display="block";b.el("embedDivAction").style.width="260px";b.el("txtSearch").removeAttribute("placeholder");if(b.isFunction(r)){r.apply(this)}}})}function h(){var r=["http://",b.el("txtSearch").value.replace("http://","")].join("");b.imageExists(r,function(u,s){f(r,u,s)});setTimeout(function(){if(e._.options.image!==r){alert("Sorry, that image could not be loaded.")}},2000)}function g(){j();var s="Size:"+b.el("ddlImageSize").value;if(b.el("ddlImageSize").value==="Icon"){s="Size:Width:64&Image.Filters=Style:Graphics&Image.Filters=Face:Other"}else{if(b.el("ddlImageSize").value==="All"){s=""}}var v=l.imageUrl.replace(/{query}/gi,b.el("txtSearch").value).replace(/{size}/gi,s).replace(/{rpp}/gi,l.paging.rpp).replace(/{page}/gi,(l.paging.page*l.paging.rpp));if(k()){v=l.patternUrl.replace(/{query}/gi,b.el("txtSearch").value).replace(/{rpp}/gi,l.paging.rpp).replace(/{page}/gi,l.paging.page)}var u="<div style='float:left;cursor:pointer;border:1px solid transparent;padding:5px;height:150px;overflow:hidden;' class='searchImage' rel='{url}|{width}|{height}'><div style='width:100px;height:125px;text-align:center;'><img src='{thumb}' title='{title}' alt='{title}' style='width:{imgWidth}px;height:{imgHeight}px;'/></div><div style='text-align:center;'>{width} x {height}</div></div>";var r="";var w=[];if(k()){b.getJSON(v,function(x,y){w=x;if(!w){w=[]}l.paging.total=((l.paging.page*l.paging.rpp)+x.length+1);b.each(w,function(){var B=this.title;var A=this.imageUrl;var C=this.imageUrl;var D=75;var z=75;if(b.el("ddlImageSize").value==="Icon"){_imgSize=64}r+=u.replace(/{url}/gi,C).replace(/{thumb}/gi,A).replace(/{imgSize}/gi,_imgSize).replace(/{title}/gi,B).replace(/{width}/gi,D).replace(/{height}/gi,z)});o(w,r)})}else{b.ajax(v,function(z,y){var x=JSON.parse(z);w=x.results;if(x.__next!==""){l.paging.total=(l.paging.page+2)*l.paging.rpp}b.each(w,function(){var C=this.Title;var B=this.Thumbnail.MediaUrl;var D=this.MediaUrl;var E=parseInt(this.Width);var A=parseInt(this.Height);r+=u.replace(/{url}/gi,D).replace(/{thumb}/gi,B).replace(/{imgWidth}/gi,this.Thumbnail.Width).replace(/{imgHeight}/gi,this.Thumbnail.Height).replace(/{title}/gi,C).replace(/{width}/gi,E).replace(/{height}/gi,A)});o(w,r)})}}function o(s,r){if(s.length===0){b.el("imgResults").innerHTML="<div style='font-size:20pt;color:#fff;margin-top:20px;'>There are no results!</div>"}else{b.el("imgResults").innerHTML=r;n();m()}}function m(){b.each(b.select("div.searchImage"),function(){b.addEvent(this,"click",function(s){var r=this.getAttribute("rel").split("|");var v=r[0],x=parseInt(r[1]),u=parseInt(r[2]);f(v,x,u)});b.addEvent(this,"mouseover",function(r){this.style.border="1px solid #ccc";this.style.backgroundColor="#333";this.style.color="#fff"});b.addEvent(this,"mouseout",function(r){this.style.border="1px solid transparent";this.style.backgroundColor="transparent";this.style.color="#000"})})}function f(u,v,s){e.set(u,v,s);e._.mark();var r={type:"onNodeImageChanged",data:{id:e._.options.id,img:e._.options.image,w:e._.options.width,h:e._.options.height}};e._.slate.birdseye&&e._.slate.birdseye.nodeChanged(r);e._.slate.signalr&&e._.slate.signalr.send(r)}function j(){b.el("lnkSearchForward").style.visibility="hidden";b.el("lnkSearchBack").style.visibility="hidden"}function n(){if(((l.paging.page+1)*l.paging.rpp)<l.paging.total){b.el("lnkSearchForward").style.visibility="visible"}if(l.paging.page>0){b.el("lnkSearchBack").style.visibility="visible"}}e.end=function(){e.imagesearching=false;e._.unmark();c&&c.closeMessage()};e.set=function(u,v,s){e._.options.image=u;sz={fill:"url("+e._.options.image+")","stroke-width":e._.options.borderWidth,stroke:"#000"};if(e._.options.width<v||!e._.options.text){e._.options.width=v;var r=e._.vect.type=="rect"?{width:v}:{rx:v/2};b.extend(sz,r)}if(e._.options.height<s||!e._.options.text){e._.options.height=s;var r=e._.vect.type=="rect"?{height:s}:{ry:s/2};b.extend(sz,r)}e._.vect.attr(sz);e._.refresh();e._.connectors&&e._.connectors.remove();e._.resize&&e._.resize.hide()};return e}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._shapes=function(){var c=this,e="",d;c.show=function(k,l,f){k=k+10;var g=c._.slate.paper;var h={fill:"#fff",stroke:"#000","stroke-width":1};var j=[g.rect(k+16,l+43,30,30).attr(h),g.rect(k+56,l+43,30,30,5).attr(h),g.ellipse(k+110,l+58,16,16).attr(h)];b.each(j,function(){this.mouseover(function(m){c._.slate.glow(this)});this.mouseout(function(m){c._.slate.unglow()});this.mousedown(function(m){if(this.type!==c._.options.vectorPath){var n={type:"onNodeShapeChanged",data:{id:c._.options.id,shape:this.type,rx:this.attr("rx")}};c.set(n.data);c._.slate.signalr&&c._.slate.signalr.send(n);c._.slate.birdseye&&c._.slate.birdseye.nodeChanged(n)}});f.push(this)})};c.set=function(l){c._.vect.remove();var g=c._.slate.paper;var m={fill:c._.options.backgroundColor,"stroke-width":c._.options.borderWidth,stroke:"#000"};if(c._.options.image&&c._.options.image!==""){m.fill="url("+c._.options.image+")"}var j=c._.options.xPos,k=c._.options.yPos,h=c._.options.width,f=c._.options.height;switch(l.shape){case"ellipse":if(c._.options.vectorPath!=="ellipse"){c._.options.vectorPath="ellipse";c._.vect=g.ellipse(j+h/2,k+f/2,(h/2),(f/2)).attr(m);c._.options.xPos+=h/2;c._.options.yPos+=f/2}break;case"rect":if(c._.options.vectorPath==="ellipse"){c._.options.xPos-=h/2;c._.options.yPos-=f/2;j=c._.options.xPos;k=c._.options.yPos}c._.options.vectorPath=l.rx>0?"roundedrectangle":"rectangle";c._.vect=g.rect(j,k,h,f,l.rx>0?10:0).attr(m);break}c._.text.toFront();c._.link.toFront();c._.relationships.wireHoverEvents();c._.relationships.wireDragEvents();c._.vect.data({id:c._.options.id});c._.context.init()};return c}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._template=new function(){var c=this;c.hello=function(){alert(parent.options.name)};return c}})(Slatebox,Slatebox.fn.node);(function(b,a){a.fn._toolbar=function(){var c=this;c.show=function(j,k,d){var k=k+1;var e=c._.slate.paper;var g={fill:"#eee",stroke:"#333"};var h=14,f=16;

toolbar=
[
	e.handle().data({msg:"คลิกค้างแล้วลากเพื่อโยงเส้น",width:160}).attr({fill:"90-#999-#ccc",stroke:"#333","stroke-width":2}).transform(["t",j,",",k,"s",".85",".85"].join()),
	e.deleter().data({msg:"ลบ",width:30}).attr({fill:"90-#999-#ccc",stroke:"#333","stroke-width":2}).transform(["t",(j+30),",",k,"s",".85",".85"].join()),
	e.editor().data({msg:"แก้ไขข้อความ",width:85}).attr({fill:"90-#999-#ccc",stroke:"#333","stroke-width":2}).transform(["t",(j+60),",",k,"s",".85",".85"].join()),
	e.searcher().data({msg:"",width:0}).attr({fill:"90-#999-#ccc",stroke:"#333","stroke-width":2}).transform(["t",(j+90),",",k,"s",".85",".85"].join()),
	e.link().data({msg:"",width:0}).attr({fill:"90-#999-#ccc",stroke:"#333","stroke-width":2}).transform(["t",(j+120),",",k,"s",".85",".85"].join())
];

b.each(toolbar,function(){
	this.mouseover(function(m){
		c._.slate.glow(this);
		var l=this.data("msg");
		c._.slate.addtip(
			this.tooltip(
				{type:"text",msg:l},
				this.data("width"),
				this.data("height")
			)
		);
		b.stopEvent(m)
	});
	
	this.mouseout(function(l){
		c._.slate.unglow();
		this.untooltip();
		b.stopEvent(l)}
	)
});


for(t=0;t<3;t++){(function(l){b.each(["mousedown"],function(){toolbar[l][this](function(m){m.stopPropagation();c._.slate.unglow();c._.slate.untooltip();if(c._.events&&b.isFunction(c._.events.onToolbarClick)){c._.events.onToolbarClick.apply(this,[l])}else{if(l===0){c._.relationships.initiateTempNode(m,c._,true);c._.menu.hide()}else{if(l===1){c.del()}else{if(l===2){c._.slate.stopEditing();c._.position("center",function(){c._.editor.start()})}else{if(l===3){c._.slate.unMarkAll();c._.slate.stopEditing();c._.position("center",function(){c._.images.start()})}else{if(l===4){c._.slate.unMarkAll();c._.slate.stopEditing();c._.position("center",function(){c._.links.start()})}}}}}}})})})(t)}b.each(toolbar,function(){d.push(this)});return c};c.del=function(){if(c._.slate.nodes.allNodes.length<=1){alert("Sorry, this is the last node on the slate, you cannot delete this one!")}else{var e=c._.slate;c._.del();var d={type:"onNodeDeleted",data:{id:c._.options.id}};e.signalr&&e.signalr.send(d);e.birdseye&&e.birdseye.nodeDeleted(d)}};return c}})(Slatebox,Slatebox.fn.node);(function(b,a,c){a.fn._context=function(){var g=this,d,f=true,e=150;var h=window.setInterval(function(){if(g._){g.init();window.clearInterval(h)}},500);g.init=function(){if(g._.text.node&&g._.options.allowContext){g._.text.node.oncontextmenu=g._.vect.node.oncontextmenu=function(n){f=g._.options.allowDrag;g._.options.allowDrag=false;g.hide();k(n);setTimeout(function(o){g._.options.allowDrag=f},2);return b.stopEvent(n)}}};function k(n){d=document.createElement("div");d.setAttribute("id","contextMenu_"+g._.options.id);d.setAttribute("class","sb_cm");document.body.appendChild(d);m(n)}function l(){var o="<div style='padding:5px;' class='sb_contextMenuItem' rel='{func}'>{text}</div>";var n=o.replace(/{func}/g,"tofront").replace(/{text}/g,"to front");n+=o.replace(/{func}/g,"toback").replace(/{text}/g,"to back");if(f){n+=o.replace(/{func}/g,"lock").replace(/{text}/g,"lock")}else{n+=o.replace(/{func}/g,"unlock").replace(/{text}/g,"unlock")}if(g._.relationships.reattachable()){n+=o.replace(/{func}/g,"pin").replace(/{text}/g,"pin to parent");e=183}n+=o.replace(/{func}/g,"close").replace(/{text}/g,"close");return n}function m(q){d.innerHTML=l();b.each(b.select("div.contextMenuItem"),function(s){this.onclick=function(x){var w=this.getAttribute("rel"),v=false;var z={type:"",data:{id:g._.options.id}};switch(w){case"tofront":g._.toFront();v=true;z.type="onNodeToFront";break;case"toback":g._.toBack();v=true;z.type="onNodeToBack";break;case"lock":g._.disable();z.type="onNodeLocked";break;case"unlock":g._.enable();z.type="onNodeUnlocked";break;case"pin":g._.relationships.attach();z.type="onNodeAttached";break;case"close":break}if(v){var B=0;for(var y=g._.slate.paper.bottom;y!=null;y=y.next){if(y.type==="ellipse"||y.type==="rect"){B++;var u=y.data("id");if(u){var A=_.detect(g._.slate.nodes.allNodes,function(C){return C.options.id===u});A.sortorder=B}}}g._.slate.nodes.allNodes.sort(function(C,D){return C.sortorder<D.sortorder?-1:1})}if(z.type!==""){j(z)}g.hide()}});var r=b.mousePos(q);var n=r.x;var o=r.y;d.style.left=n+"px";d.style.top=o+"px";d.style.height=e+"px"}function j(n){if(g._.slate.signalr){g._.slate.signalr.send(n)}if(g._.slate.birdseye){g._.slate.birdseye.nodeChanged(n)}}g.hide=function(){g._.slate.removeContextMenus();d=null};g.isVisible=function(){return(d!==null)};return g};c.fn.removeContextMenus=function(){var d=b.select("div.sb_cm");b.each(d,function(){document.body.removeChild(this)})}})(Slatebox,Slatebox.fn.node,Slatebox.fn.slate);(function(b,a){a.fn._resize=function(){var h=this,k;h.show=function(o,q){var n=h._.slate.paper;k=n.resize(h._.slate.options.imageFolder+"2_lines.png").transform(["t",o-5,",",q-5].join()).attr({fill:"#fff",stroke:"#000"});k.mouseover(function(r){k.attr({cursor:"nw-resize"})});k.drag(j,l,m);return k};h.hide=function(n){k&&k.remove()};var e=10,d=10,c=false,g,f;var l=function(){h._.slate.multiselection&&h._.slate.multiselection.end();this.ox=this.attr("x");this.oy=this.attr("y");h._.setStartDrag();h._.connectors.remove();c=h._.slate.options.viewPort.allowDrag;h._.slate.disable();if(h._.options.text!==" "){var n=h._.text.getBBox();e=n.width+10;d=n.height+10}g=h._.options.width;f=h._.options.height},j=function(r,s){var q=h._.slate.options.viewPort.zoom.r;r=r+((r/q)-r);s=s+((s/q)-s);var o=g+r;var n=f+s;if(o>e){this.attr({x:this.ox+r})}if(n>d){this.attr({y:this.oy+s})}if(h._.events&&b.isFunction(h._.events.onResizing)){h._.events.onResizing.apply(this,[o,n])}h.set(o,n)},m=function(){h._.slate.enable();k.remove();h._.setEndDrag();if(h._.events&&b.isFunction(h._.events.onResized)){h._.events.onResized.apply(this,[h.send])}else{h.send()}};h.send=function(){var n={type:"onNodeResized",data:{id:h._.options.id,height:h._.options.height,width:h._.options.width}};h._.slate.birdseye&&h._.slate.birdseye.nodeChanged(n);h._.slate.signalr&&h._.slate.signalr.send(n)};h.set=function(E,u,q,r,o){var y={},A={},v={},n=h._.vect.getBBox();if(!q){q=0}if(E>e){var D=h._.vect.type=="rect"?{width:E}:{rx:E/2};if(q===0){h._.vect.attr(D)}else{y=D}var B=n.x+(E/2),x=n.x-5;if(h._.options.vectorPath==="ellipse"){B=h._.vect.attr("cx");x=h._.vect.attr("cx")+(E/2)}if(q===0){h._.text.attr({x:B})}else{A={x:B};v={x:x}}h._.options.width=E}if(u>d){var s=h._.vect.type=="rect"?{height:u}:{ry:u/2};if(q===0){h._.vect.attr(s)}else{y=b.extend(y,s)}var C=n.y+(u/2);if(h._.options.vectorPath==="ellipse"){C=h._.vect.attr("cy")}if(q===0){h._.text.attr({y:C})}else{b.extend(A,{y:C});b.extend(v,{y:C})}h._.options.height=u}if(q>0){h._.text.animate(A,q);h._.link.hide();var z=function(){if(h._.slate){h._.refresh()}};eve.on("raphael.anim.frame.*",z);h._.vect.animate(y,q,r,function(){var F=h._.linkCoords();h._.link.transform(["t",F.x,",",F.y,"s",".8",",",".8","r","180"].join());if(h._.options.link.show){h._.link.show()}h._.refresh();eve.unbind("raphael.anim.frame.*",z);o&&o.apply(this,[h._])})}else{var w=h._.linkCoords();h._.link.transform(["t",w.x,",",w.y,"s",".8",",",".8","r","180"].join());h._.refresh()}};return h}})(Slatebox,Slatebox.fn.node);(function(e){var k="0.3.4",f="hasOwnProperty",h=/[\.\/]/,l="*",d=function(){},g=function(m,n){return m-n},a,j,c={n:{}},b=function(y,D){var o=c,A=j,m=Array.prototype.slice.call(arguments,2),x=b.listeners(y),E=0,r=false,w,v=[],C={},B=[],n=a,q=[];a=y;j=0;for(var s=0,u=x.length;s<u;s++){if("zIndex" in x[s]){v.push(x[s].zIndex);if(x[s].zIndex<0){C[x[s].zIndex]=x[s]}}}v.sort(g);while(v[E]<0){w=C[v[E++]];B.push(w.apply(D,m));if(j){j=A;return B}}for(s=0;s<u;s++){w=x[s];if("zIndex" in w){if(w.zIndex==v[E]){B.push(w.apply(D,m));if(j){break}do{E++;w=C[v[E]];w&&B.push(w.apply(D,m));if(j){break}}while(w)}else{C[w.zIndex]=w}}else{B.push(w.apply(D,m));if(j){break}}}j=A;a=n;return B.length?B:null};b.listeners=function(x){var y=x.split(h),m=c,r,s,w,o,q,u,v,z,n=[m],A=[];for(o=0,q=y.length;o<q;o++){z=[];for(u=0,v=n.length;u<v;u++){m=n[u].n;s=[m[y[o]],m[l]];w=2;while(w--){r=s[w];if(r){z.push(r);A=A.concat(r.f||[])}}}n=z}return A};b.on=function(r,n){var s=r.split(h),m=c;for(var o=0,q=s.length;o<q;o++){m=m.n;!m[s[o]]&&(m[s[o]]={n:{}});m=m[s[o]]}m.f=m.f||[];for(o=0,q=m.f.length;o<q;o++){if(m.f[o]==n){return d}}m.f.push(n);return function(u){if(+u==+u){n.zIndex=+u}}};b.stop=function(){j=1};b.nt=function(m){if(m){return new RegExp("(?:\\.|\\/|^)"+m+"(?:\\.|\\/|$)").test(a)}return a};b.off=b.unbind=function(x,o){var y=x.split(h),n,w,z,r,s,u,v,m=[c];for(r=0,s=y.length;r<s;r++){for(u=0;u<m.length;u+=z.length-2){z=[u,1];n=m[u].n;if(y[r]!=l){if(n[y[r]]){z.push(n[y[r]])}}else{for(w in n){if(n[f](w)){z.push(n[w])}}}m.splice.apply(m,z)}}for(r=0,s=m.length;r<s;r++){n=m[r];while(n.n){if(o){if(n.f){for(u=0,v=n.f.length;u<v;u++){if(n.f[u]==o){n.f.splice(u,1);break}}!n.f.length&&delete n.f}for(w in n.n){if(n.n[f](w)&&n.n[w].f){var q=n.n[w].f;for(u=0,v=q.length;u<v;u++){if(q[u]==o){q.splice(u,1);break}}!q.length&&delete n.n[w].f}}}else{delete n.f;for(w in n.n){if(n.n[f](w)&&n.n[w].f){delete n.n[w].f}}}n=n.n}}};b.once=function(o,m){var n=function(){var q=m.apply(this,arguments);b.unbind(o,n);return q};return b.on(o,n)};b.version=k;b.toString=function(){return"You are running Eve "+k};(typeof module!="undefined"&&module.exports)?(module.exports=b):(typeof define!="undefined"?(define("eve",[],function(){return b})):(e.eve=b))})(this);(function(){function ba(g){if(ba.is(g,"function")){return aB?g():eve.on("raphael.DOMload",g)}else{if(ba.is(g,m)){return ba._engine.create[l](ba,g.splice(0,3+ba.is(g[0],aJ))).add(g)}else{var b=Array.prototype.slice.call(arguments,0);if(ba.is(b[b.length-1],"function")){var d=b.pop();return aB?d.call(ba._engine.create[l](ba,b)):eve.on("raphael.DOMload",function(){d.call(ba._engine.create[l](ba,b))})}else{return ba._engine.create[l](ba,arguments)}}}}ba.version="2.1.0";ba.eve=eve;var aB,bj=/[, ]+/,P={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},Z=/\{(\d+)\}/g,a7="prototype",al="hasOwnProperty",ab={doc:document,win:window},aL={was:Object.prototype[al].call(ab.win,"Raphael"),is:ab.win.Raphael},aP=function(){this.ca=this.customAttributes={}},aQ,k="appendChild",l="apply",B="concat",bv="createTouch" in ab.doc,M="",bi=" ",bt=String,bp="split",V="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[bp](bi),bF={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},aC=bt.prototype.toLowerCase,aE=Math,aH=aE.max,aI=aE.min,c=aE.abs,a2=aE.pow,a0=aE.PI,aJ="number",bu="string",m="array",bE="toString",X="fill",aK=Object.prototype.toString,aO={},a8="push",az=ba._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,z=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,ay={"NaN":1,"Infinity":1,"-Infinity":1},s=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,bg=aE.round,bl="setAttribute",bz=parseFloat,bC=parseInt,bH=bt.prototype.toUpperCase,o=ba._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},n=ba._availableAnimAttrs={blur:aJ,"clip-rect":"csv",cx:aJ,cy:aJ,fill:"colour","fill-opacity":aJ,"font-size":aJ,height:aJ,opacity:aJ,path:"path",r:aJ,rx:aJ,ry:aJ,stroke:"colour","stroke-opacity":aJ,"stroke-width":aJ,transform:"transform",width:aJ,x:aJ,y:aJ},bK=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,A=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,ao={hs:1,rg:1},aM=/,?([achlmqrstvxz]),?/gi,aU=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,bw=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,aZ=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,bb=ba._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,O={},bn=function(d,g){return d.key-g.key},bo=function(d,g){return bz(d)-bz(g)},aa=function(){},a1=function(b){return b},bc=ba._rectPath=function(E,R,g,b,d){if(d){return[["M",E+d,R],["l",g-d*2,0],["a",d,d,0,0,1,d,d],["l",0,b-d*2],["a",d,d,0,0,1,-d,d],["l",d*2-g,0],["a",d,d,0,0,1,-d,-d],["l",0,d*2-b],["a",d,d,0,0,1,d,-d],["z"]]}return[["M",E,R],["l",g,0],["l",0,b],["l",-g,0],["z"]]},Q=function(g,E,b,d){if(d==null){d=b}return[["M",g,E],["m",0,-d],["a",b,d,0,1,1,0,2*d],["a",b,d,0,1,1,0,-2*d],["z"]]},af=ba._getPath={path:function(b){return b.attr("path")},circle:function(d){var b=d.attrs;return Q(b.cx,b.cy,b.r)},ellipse:function(d){var b=d.attrs;return Q(b.cx,b.cy,b.rx,b.ry)},rect:function(d){var b=d.attrs;return bc(b.x,b.y,b.width,b.height,b.r)},image:function(d){var b=d.attrs;return bc(b.x,b.y,b.width,b.height)},text:function(d){var b=d._getBBox();return bc(b.x,b.y,b.width,b.height)}},aD=ba.mapPath=function(S,R){if(!R){return S}var bO,bP,b,g,d,E,bN;S=aS(S);for(b=0,d=S.length;b<d;b++){bN=S[b];for(g=1,E=bN.length;g<E;g+=2){bO=R.x(bN[g],bN[g+1]);bP=R.y(bN[g],bN[g+1]);bN[g]=bO;bN[g+1]=bP}}return S};ba._g=ab;ba.type=(ab.win.SVGAngle||ab.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(ba.type=="VML"){var H=ab.doc.createElement("div"),q;H.innerHTML='<v:shape adj="1"/>';q=H.firstChild;q.style.behavior="url(#default#VML)";if(!(q&&typeof q.adj=="object")){return(ba.type=M)}H=null}ba.svg=!(ba.vml=ba.type=="VML");ba._Paper=aP;ba.fn=aQ=aP.prototype=ba.prototype;ba._id=0;ba._oid=0;ba.is=function(b,d){d=aC.call(d);if(d=="finite"){return !ay[al](+b)}if(d=="array"){return b instanceof Array}return(d=="null"&&b===null)||(d==typeof b&&b!==null)||(d=="object"&&b===Object(b))||(d=="array"&&Array.isArray&&Array.isArray(b))||aK.call(b).slice(8,-1).toLowerCase()==d};function x(d){if(Object(d)!==d){return d}var g=new d.constructor;for(var b in d){if(d[al](b)){g[b]=x(d[b])}}return g}ba.angle=function(d,S,g,bN,E,bO){if(E==null){var b=d-g,R=S-bN;if(!b&&!R){return 0}return(180+aE.atan2(-R,-b)*180/a0+360)%360}else{return ba.angle(d,S,E,bO)-ba.angle(g,bN,E,bO)}};ba.rad=function(b){return b%360*a0/180};ba.deg=function(b){return b*180/a0%360};ba.snapTo=function(R,E,g){g=ba.is(g,"finite")?g:10;if(ba.is(R,m)){var b=R.length;while(b--){if(c(R[b]-E)<=g){return R[b]}}}else{R=+R;var d=E%R;if(d<g){return E-d}if(d>R-g){return E-d+R}}return E};var C=ba.createUUID=(function(b,d){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(b,d).toUpperCase()}})(/[xy]/g,function(b){var d=aE.random()*16|0,g=b=="x"?d:(d&3|8);return g.toString(16)});ba.setWindow=function(b){eve("raphael.setWindow",ba,ab.win,b);ab.win=b;ab.doc=ab.win.document;if(ba._engine.initWin){ba._engine.initWin(ab.win)}};var bB=function(d){if(ba.vml){var bN=/^\s+|\s+$/g;var b;try{var g=new ActiveXObject("htmlfile");g.write("<body>");g.close();b=g.body}catch(E){b=createPopup().document.body}var S=b.createTextRange();bB=v(function(bO){try{b.style.color=bt(bO).replace(bN,M);var bQ=S.queryCommandValue("ForeColor");bQ=((bQ&255)<<16)|(bQ&65280)|((bQ&16711680)>>>16);return"#"+("000000"+bQ.toString(16)).slice(-6)}catch(bP){return"none"}})}else{var R=ab.doc.createElement("i");R.title="Rapha\xebl Colour Picker";R.style.display="none";ab.doc.body.appendChild(R);bB=v(function(bO){R.style.color=bO;return ab.doc.defaultView.getComputedStyle(R,M).getPropertyValue("color")})}return bB(d)},am=function(){return"hsb("+[this.h,this.s,this.b]+")"},an=function(){return"hsl("+[this.h,this.s,this.l]+")"},bf=function(){return this.hex},a4=function(S,R,d){if(R==null&&ba.is(S,"object")&&"r" in S&&"g" in S&&"b" in S){d=S.b;R=S.g;S=S.r}if(R==null&&ba.is(S,bu)){var E=ba.getRGB(S);S=E.r;R=E.g;d=E.b}if(S>1||R>1||d>1){S/=255;R/=255;d/=255}return[S,R,d]},aN=function(S,E,d,R){S*=255;E*=255;d*=255;var bN={r:S,g:E,b:d,hex:ba.rgb(S,E,d),toString:bf};ba.is(R,"finite")&&(bN.opacity=R);return bN};ba.color=function(b){var d;if(ba.is(b,"object")&&"h" in b&&"s" in b&&"b" in b){d=ba.hsb2rgb(b);b.r=d.r;b.g=d.g;b.b=d.b;b.hex=d.hex}else{if(ba.is(b,"object")&&"h" in b&&"s" in b&&"l" in b){d=ba.hsl2rgb(b);b.r=d.r;b.g=d.g;b.b=d.b;b.hex=d.hex}else{if(ba.is(b,"string")){b=ba.getRGB(b)}if(ba.is(b,"object")&&"r" in b&&"g" in b&&"b" in b){d=ba.rgb2hsl(b);b.h=d.h;b.s=d.s;b.l=d.l;d=ba.rgb2hsb(b);b.v=d.b}else{b={hex:"none"};b.r=b.g=b.b=b.h=b.s=b.v=b.l=-1}}}b.toString=bf;return b};ba.hsb2rgb=function(E,bO,bP,S){if(this.is(E,"object")&&"h" in E&&"s" in E&&"b" in E){bP=E.b;bO=E.s;E=E.h;S=E.o}E*=360;var bN,g,b,bQ,d;E=(E%360)/60;d=bP*bO;bQ=d*(1-c(E%2-1));bN=g=b=bP-d;E=~~E;bN+=[d,bQ,0,0,bQ,d][E];g+=[bQ,d,d,bQ,0,0][E];b+=[0,0,bQ,d,d,bQ][E];return aN(bN,g,b,S)};ba.hsl2rgb=function(E,bP,S,bN){if(this.is(E,"object")&&"h" in E&&"s" in E&&"l" in E){S=E.l;bP=E.s;E=E.h}if(E>1||bP>1||S>1){E/=360;bP/=100;S/=100}E*=360;var bO,g,b,bQ,d;E=(E%360)/60;d=2*bP*(S<0.5?S:1-S);bQ=d*(1-c(E%2-1));bO=g=b=S-d/2;E=~~E;bO+=[d,bQ,0,0,bQ,d][E];g+=[bQ,d,d,bQ,0,0][E];b+=[0,0,bQ,d,d,bQ][E];return aN(bO,g,b,bN)};ba.rgb2hsb=function(bO,R,d){d=a4(bO,R,d);bO=d[0];R=d[1];d=d[2];var bN,bP,bQ,E;bQ=aH(bO,R,d);E=bQ-aI(bO,R,d);bN=(E==0?null:bQ==bO?(R-d)/E:bQ==R?(d-bO)/E+2:(bO-R)/E+4);bN=((bN+360)%6)*60/360;bP=E==0?0:E/bQ;return{h:bN,s:bP,b:bQ,toString:am}};ba.rgb2hsl=function(bR,R,d){d=a4(bR,R,d);bR=d[0];R=d[1];d=d[2];var bN,bS,bO,bQ,bP,E;bQ=aH(bR,R,d);bP=aI(bR,R,d);E=bQ-bP;bN=(E==0?null:bQ==bR?(R-d)/E:bQ==R?(d-bR)/E+2:(bR-R)/E+4);bN=((bN+360)%6)*60/360;bO=(bQ+bP)/2;bS=(E==0?0:bO<0.5?E/(2*bO):E/(2-2*bO));return{h:bN,s:bS,l:bO,toString:an}};ba._path2string=function(){return this.join(",").replace(aM,"$1")};function bd(b,E){for(var d=0,g=b.length;d<g;d++){if(b[d]===E){return b.push(b.splice(d,1)[0])}}}function v(b,E,g){function d(){var R=Array.prototype.slice.call(arguments,0),S=R.join("\u2400"),bN=d.cache=d.cache||{},bO=d.count=d.count||[];if(bN[al](S)){bd(bO,S);return g?g(bN[S]):bN[S]}bO.length>=1000&&delete bN[bO.shift()];bO.push(S);bN[S]=b[l](E,R);return g?g(bN[S]):bN[S]}return d}var a3=ba._preload=function(g,b){var d=ab.doc.createElement("img");d.style.cssText="position:absolute;left:-9999em;top:-9999em";d.onload=function(){b.call(this);this.onload=null;ab.doc.body.removeChild(this)};d.onerror=function(){ab.doc.body.removeChild(this)};ab.doc.body.appendChild(d);d.src=g};function y(){return this.hex}ba.getRGB=v(function(d){if(!d||!!((d=bt(d)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:y}}if(d=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:y}}!(ao[al](d.toLowerCase().substring(0,2))||d.charAt()=="#")&&(d=bB(d));var S,R,g,b,E,bO,bP,bN=d.match(z);if(bN){if(bN[2]){b=bC(bN[2].substring(5),16);g=bC(bN[2].substring(3,5),16);R=bC(bN[2].substring(1,3),16)}if(bN[3]){b=bC((bO=bN[3].charAt(3))+bO,16);g=bC((bO=bN[3].charAt(2))+bO,16);R=bC((bO=bN[3].charAt(1))+bO,16)}if(bN[4]){bP=bN[4][bp](A);R=bz(bP[0]);bP[0].slice(-1)=="%"&&(R*=2.55);g=bz(bP[1]);bP[1].slice(-1)=="%"&&(g*=2.55);b=bz(bP[2]);bP[2].slice(-1)=="%"&&(b*=2.55);bN[1].toLowerCase().slice(0,4)=="rgba"&&(E=bz(bP[3]));bP[3]&&bP[3].slice(-1)=="%"&&(E/=100)}if(bN[5]){bP=bN[5][bp](A);R=bz(bP[0]);bP[0].slice(-1)=="%"&&(R*=2.55);g=bz(bP[1]);bP[1].slice(-1)=="%"&&(g*=2.55);b=bz(bP[2]);bP[2].slice(-1)=="%"&&(b*=2.55);(bP[0].slice(-3)=="deg"||bP[0].slice(-1)=="\xb0")&&(R/=360);bN[1].toLowerCase().slice(0,4)=="hsba"&&(E=bz(bP[3]));bP[3]&&bP[3].slice(-1)=="%"&&(E/=100);return ba.hsb2rgb(R,g,b,E)}if(bN[6]){bP=bN[6][bp](A);R=bz(bP[0]);bP[0].slice(-1)=="%"&&(R*=2.55);g=bz(bP[1]);bP[1].slice(-1)=="%"&&(g*=2.55);b=bz(bP[2]);bP[2].slice(-1)=="%"&&(b*=2.55);(bP[0].slice(-3)=="deg"||bP[0].slice(-1)=="\xb0")&&(R/=360);bN[1].toLowerCase().slice(0,4)=="hsla"&&(E=bz(bP[3]));bP[3]&&bP[3].slice(-1)=="%"&&(E/=100);return ba.hsl2rgb(R,g,b,E)}bN={r:R,g:g,b:b,toString:y};bN.hex="#"+(16777216|b|(g<<8)|(R<<16)).toString(16).slice(1);ba.is(E,"finite")&&(bN.opacity=E);return bN}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:y}},ba);ba.hsb=v(function(g,E,d){return ba.hsb2rgb(g,E,d).hex});ba.hsl=v(function(b,g,d){return ba.hsl2rgb(b,g,d).hex});ba.rgb=v(function(R,E,d){return"#"+(16777216|d|(E<<8)|(R<<16)).toString(16).slice(1)});ba.getColor=function(g){var d=this.getColor.start=this.getColor.start||{h:0,s:1,b:g||0.75},b=this.hsb2rgb(d.h,d.s,d.b);d.h+=0.075;if(d.h>1){d.h=0;d.s-=0.2;d.s<=0&&(this.getColor.start={h:0,s:1,b:d.b})}return b.hex};ba.getColor.reset=function(){delete this.start};function w(b,bN){var g=[];for(var E=0,R=b.length;R-2*!bN>E;E+=2){var S=[{x:+b[E-2],y:+b[E-1]},{x:+b[E],y:+b[E+1]},{x:+b[E+2],y:+b[E+3]},{x:+b[E+4],y:+b[E+5]}];if(bN){if(!E){S[0]={x:+b[R-2],y:+b[R-1]}}else{if(R-4==E){S[3]={x:+b[0],y:+b[1]}}else{if(R-2==E){S[2]={x:+b[0],y:+b[1]};S[3]={x:+b[2],y:+b[3]}}}}}else{if(R-4==E){S[3]=S[2]}else{if(!E){S[0]={x:+b[E],y:+b[E+1]}}}}g.push(["C",(-S[0].x+6*S[1].x+S[2].x)/6,(-S[0].y+6*S[1].y+S[2].y)/6,(S[1].x+6*S[2].x-S[3].x)/6,(S[1].y+6*S[2].y-S[3].y)/6,S[2].x,S[2].y])}return g}ba.parsePathString=function(g){if(!g){return null}var E=aW(g);if(E.arr){return aT(E.arr)}var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},b=[];if(ba.is(g,m)&&ba.is(g[0],m)){b=aT(g)}if(!b.length){bt(g).replace(aU,function(R,S,bN){var bP=[],bO=S.toLowerCase();bN.replace(aZ,function(bQ,bR){bR&&bP.push(+bR)});if(bO=="m"&&bP.length>2){b.push([S][B](bP.splice(0,2)));bO="l";S=S=="m"?"l":"L"}if(bO=="r"){b.push([S][B](bP))}else{while(bP.length>=d[bO]){b.push([S][B](bP.splice(0,d[bO])));if(!d[bO]){break}}}})}b.toString=ba._path2string;E.arr=aT(b);return b};ba.parseTransformString=v(function(g){if(!g){return null}var d={r:3,s:4,t:2,m:6},b=[];if(ba.is(g,m)&&ba.is(g[0],m)){b=aT(g)}if(!b.length){bt(g).replace(bw,function(E,R,S){var bO=[],bN=aC.call(R);S.replace(aZ,function(bP,bQ){bQ&&bO.push(+bQ)});b.push([R][B](bO))})}b.toString=ba._path2string;return b});var aW=function(d){var b=aW.ps=aW.ps||{};if(b[d]){b[d].sleep=100}else{b[d]={sleep:100}}setTimeout(function(){for(var g in b){if(b[al](g)&&g!=d){b[g].sleep--;!b[g].sleep&&delete b[g]}}});return b[d]};ba.findDotsAtSegment=function(bU,bV,E,R,S,bN,bW,bX,bY){var bZ=1-bY,b1=a2(bZ,3),b0=a2(bZ,2),b2=bY*bY,b3=b2*bY,b4=b1*bU+b0*3*bY*E+bZ*3*bY*bY*S+b3*bW,b5=b1*bV+b0*3*bY*R+bZ*3*bY*bY*bN+b3*bX,bQ=bU+2*bY*(E-bU)+b2*(S-2*E+bU),bR=bV+2*bY*(R-bV)+b2*(bN-2*R+bV),bS=E+2*bY*(S-E)+b2*(bW-2*S+E),bT=R+2*bY*(bN-R)+b2*(bX-2*bN+R),d=bZ*bU+bY*E,g=bZ*bV+bY*R,bO=bZ*S+bY*bW,bP=bZ*bN+bY*bX,b=(90-aE.atan2(bQ-bS,bR-bT)*180/a0);(bQ>bS||bR<bT)&&(b+=180);return{x:b4,y:b5,m:{x:bQ,y:bR},n:{x:bS,y:bT},start:{x:d,y:g},end:{x:bO,y:bP},alpha:b}};ba.bezierBBox=function(S,bN,d,g,E,R,bO,bP){if(!ba.is(S,"array")){S=[S,bN,d,g,E,R,bO,bP]}var b=F.apply(null,S);return{x:b.min.x,y:b.min.y,x2:b.max.x,y2:b.max.y,width:b.max.x-b.min.x,height:b.max.y-b.min.y}};ba.isPointInsideBBox=function(b,d,g){return d>=b.x&&d<=b.x2&&g>=b.y&&g<=b.y2};ba.isBBoxIntersect=function(b,d){var g=ba.isPointInsideBBox;return g(d,b.x,b.y)||g(d,b.x2,b.y)||g(d,b.x,b.y2)||g(d,b.x2,b.y2)||g(b,d.x,d.y)||g(b,d.x2,d.y)||g(b,d.x,d.y2)||g(b,d.x2,d.y2)||(b.x<d.x2&&b.x>d.x||d.x<b.x2&&d.x>b.x)&&(b.y<d.y2&&b.y>d.y||d.y<b.y2&&d.y>b.y)};function r(R,b,d,g,E){var S=-3*b+9*d-9*g+3*E,bN=R*S+6*b-12*d+6*g;return R*bN-3*b+3*d}function u(bO,bT,bP,bU,bQ,bV,bR,bW,bY){if(bY==null){bY=1}bY=bY>1?1:bY<0?0:bY;var bZ=bY/2,R=12,bN=[-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,-0.9041,0.9041,-0.9816,0.9816],g=[0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],S=0;for(var E=0;E<R;E++){var d=bZ*bN[E]+bZ,bS=r(d,bO,bP,bQ,bR),bX=r(d,bT,bU,bV,bW),b=bS*bS+bX*bX;S+=g[E]*aE.sqrt(b)}return bZ*S}function aj(bN,bR,bO,bS,bP,bT,bQ,bU,g){if(g<0||u(bN,bR,bO,bS,bP,bT,bQ,bU)<g){return}var R=1,E=R/2,S=R-E,d,b=0.01;d=u(bN,bR,bO,bS,bP,bT,bQ,bU,S);while(c(d-g)>b){E/=2;S+=(d<g?1:-1)*E;d=u(bN,bR,bO,bS,bP,bT,bQ,bU,S)}return S}function ax(bO,bS,bP,bT,bQ,bU,bR,bV){if(aH(bO,bP)<aI(bQ,bR)||aI(bO,bP)>aH(bQ,bR)||aH(bS,bT)<aI(bU,bV)||aI(bS,bT)>aH(bU,bV)){return}var d=(bO*bT-bS*bP)*(bQ-bR)-(bO-bP)*(bQ*bV-bU*bR),g=(bO*bT-bS*bP)*(bU-bV)-(bS-bT)*(bQ*bV-bU*bR),b=(bO-bP)*(bU-bV)-(bS-bT)*(bQ-bR);if(!b){return}var E=d/b,S=g/b,R=+E.toFixed(2),bN=+S.toFixed(2);if(R<+aI(bO,bP).toFixed(2)||R>+aH(bO,bP).toFixed(2)||R<+aI(bQ,bR).toFixed(2)||R>+aH(bQ,bR).toFixed(2)||bN<+aI(bS,bT).toFixed(2)||bN>+aH(bS,bT).toFixed(2)||bN<+aI(bU,bV).toFixed(2)||bN>+aH(bU,bV).toFixed(2)){return}return{x:E,y:S}}function at(b,d){return av(b,d)}function au(b,d){return av(b,d,1)}function av(g,E,bW){var b=ba.bezierBBox(g),d=ba.bezierBBox(E);if(!ba.isBBoxIntersect(b,d)){return bW?0:[]}var bX=u.apply(0,g),bY=u.apply(0,E),bZ=~~(bX/5),b0=~~(bY/5),bR=[],bS=[],b5={},b2=bW?0:[];for(var bT=0;bT<bZ+1;bT++){var b1=ba.findDotsAtSegment.apply(ba,g.concat(bT/bZ));bR.push({x:b1.x,y:b1.y,t:bT/bZ})}for(bT=0;bT<b0+1;bT++){b1=ba.findDotsAtSegment.apply(ba,E.concat(bT/b0));bS.push({x:b1.x,y:b1.y,t:bT/b0})}for(bT=0;bT<bZ;bT++){for(var bV=0;bV<b0;bV++){var bN=bR[bT],bO=bR[bT+1],bP=bS[bV],bQ=bS[bV+1],R=c(bO.x-bN.x)<0.001?"y":"x",S=c(bQ.x-bP.x)<0.001?"y":"x",bU=ax(bN.x,bN.y,bO.x,bO.y,bP.x,bP.y,bQ.x,bQ.y);if(bU){if(b5[bU.x.toFixed(4)]==bU.y.toFixed(4)){continue}b5[bU.x.toFixed(4)]=bU.y.toFixed(4);var b3=bN.t+c((bU[R]-bN[R])/(bO[R]-bN[R]))*(bO.t-bN.t),b4=bP.t+c((bU[S]-bP[S])/(bQ[S]-bP[S]))*(bQ.t-bP.t);if(b3>=0&&b3<=1&&b4>=0&&b4<=1){if(bW){b2++}else{b2.push({x:bU.x,y:bU.y,t1:b3,t2:b4})}}}}}return b2}ba.pathIntersection=function(b,d){return aw(b,d)};ba.pathIntersectionNumber=function(b,d){return aw(b,d,1)};function aw(bR,bS,bO){bR=ba._path2curve(bR);bS=ba._path2curve(bS);var bW,b0,bY,b2,bX,b1,bZ,b3,b,d,bV=bO?0:[];for(var g=0,E=bR.length;g<E;g++){var bT=bR[g];if(bT[0]=="M"){bW=bX=bT[1];b0=b1=bT[2]}else{if(bT[0]=="C"){b=[bW,b0].concat(bT.slice(1));bW=b[6];b0=b[7]}else{b=[bW,b0,bW,b0,bX,b1,bX,b1];bW=bX;b0=b1}for(var S=0,bN=bS.length;S<bN;S++){var bU=bS[S];if(bU[0]=="M"){bY=bZ=bU[1];b2=b3=bU[2]}else{if(bU[0]=="C"){d=[bY,b2].concat(bU.slice(1));bY=d[6];b2=d[7]}else{d=[bY,b2,bY,b2,bZ,b3,bZ,b3];bY=bZ;b2=b3}var R=av(b,d,bO);if(bO){bV+=R}else{for(var bP=0,bQ=R.length;bP<bQ;bP++){R[bP].segment1=g;R[bP].segment2=S;R[bP].bez1=b;R[bP].bez2=d}bV=bV.concat(R)}}}}}return bV}ba.isPointInsidePath=function(d,g,E){var b=ba.pathBBox(d);return ba.isPointInsideBBox(b,g,E)&&aw(d,[["M",g,E],["H",b.x2+10]],1)%2==1};ba._removedFactory=function(b){return function(){eve("raphael.log",null,"Rapha\xebl: you are calling to method \u201c"+b+"\u201d of removed object",b)}};var aV=ba.pathBBox=function(S){var bN=aW(S);if(bN.bbox){return bN.bbox}if(!S){return{x:0,y:0,width:0,height:0,x2:0,y2:0}}S=aS(S);var bO=0,bS=0,bP=[],bT=[],R;for(var g=0,E=S.length;g<E;g++){R=S[g];if(R[0]=="M"){bO=R[1];bS=R[2];bP.push(bO);bT.push(bS)}else{var d=F(bO,bS,R[1],R[2],R[3],R[4],R[5],R[6]);bP=bP[B](d.min.x,d.max.x);bT=bT[B](d.min.y,d.max.y);bO=R[5];bS=R[6]}}var bR=aI[l](0,bP),bV=aI[l](0,bT),bQ=aH[l](0,bP),bU=aH[l](0,bT),b={x:bR,y:bV,x2:bQ,y2:bU,width:bQ-bR,height:bU-bV};bN.bbox=x(b);return b},aT=function(b){var d=x(b);d.toString=ba._path2string;return d},aY=ba._pathToRelative=function(bR){var bS=aW(bR);if(bS.rel){return aT(bS.rel)}if(!ba.is(bR,m)||!ba.is(bR&&bR[0],m)){bR=ba.parsePathString(bR)}var bU=[],bW=0,bX=0,bO=0,bP=0,bV=0;if(bR[0][0]=="M"){bW=bR[0][1];bX=bR[0][2];bO=bW;bP=bX;bV++;bU.push(["M",bW,bX])}for(var b=bV,d=bR.length;b<d;b++){var bT=bU[b]=[],bQ=bR[b];if(bQ[0]!=aC.call(bQ[0])){bT[0]=aC.call(bQ[0]);switch(bT[0]){case"a":bT[1]=bQ[1];bT[2]=bQ[2];bT[3]=bQ[3];bT[4]=bQ[4];bT[5]=bQ[5];bT[6]=+(bQ[6]-bW).toFixed(3);bT[7]=+(bQ[7]-bX).toFixed(3);break;case"v":bT[1]=+(bQ[1]-bX).toFixed(3);break;case"m":bO=bQ[1];bP=bQ[2];default:for(var g=1,E=bQ.length;g<E;g++){bT[g]=+(bQ[g]-((g%2)?bW:bX)).toFixed(3)}}}else{bT=bU[b]=[];if(bQ[0]=="m"){bO=bQ[1]+bW;bP=bQ[2]+bX}for(var R=0,S=bQ.length;R<S;R++){bU[b][R]=bQ[R]}}var bN=bU[b].length;switch(bU[b][0]){case"z":bW=bO;bX=bP;break;case"h":bW+=+bU[b][bN-1];break;case"v":bX+=+bU[b][bN-1];break;default:bW+=+bU[b][bN-2];bX+=+bU[b][bN-1]}}bU.toString=ba._path2string;bS.rel=aT(bU);return bU},aX=ba._pathToAbsolute=function(bS){var bT=aW(bS);if(bT.abs){return aT(bT.abs)}if(!ba.is(bS,m)||!ba.is(bS&&bS[0],m)){bS=ba.parsePathString(bS)}if(!bS||!bS.length){return[["M",0,0]]}var bV=[],bX=0,bY=0,bP=0,bQ=0,bW=0;if(bS[0][0]=="M"){bX=+bS[0][1];bY=+bS[0][2];bP=bX;bQ=bY;bW++;bV[0]=["M",bX,bY]}var b=bS.length==3&&bS[0][0]=="M"&&bS[1][0].toUpperCase()=="R"&&bS[2][0].toUpperCase()=="Z";for(var bU,bR,g=bW,E=bS.length;g<E;g++){bV.push(bU=[]);bR=bS[g];if(bR[0]!=bH.call(bR[0])){bU[0]=bH.call(bR[0]);switch(bU[0]){case"A":bU[1]=bR[1];bU[2]=bR[2];bU[3]=bR[3];bU[4]=bR[4];bU[5]=bR[5];bU[6]=+(bR[6]+bX);bU[7]=+(bR[7]+bY);break;case"V":bU[1]=+bR[1]+bY;break;case"H":bU[1]=+bR[1]+bX;break;case"R":var d=[bX,bY][B](bR.slice(1));for(var R=2,S=d.length;R<S;R++){d[R]=+d[R]+bX;d[++R]=+d[R]+bY}bV.pop();bV=bV[B](w(d,b));break;case"M":bP=+bR[1]+bX;bQ=+bR[2]+bY;default:for(R=1,S=bR.length;R<S;R++){bU[R]=+bR[R]+((R%2)?bX:bY)}}}else{if(bR[0]=="R"){d=[bX,bY][B](bR.slice(1));bV.pop();bV=bV[B](w(d,b));bU=["R"][B](bR.slice(-2))}else{for(var bN=0,bO=bR.length;bN<bO;bN++){bU[bN]=bR[bN]}}}switch(bU[0]){case"Z":bX=bP;bY=bQ;break;case"H":bX=bU[1];break;case"V":bY=bU[1];break;case"M":bP=bU[bU.length-2];bQ=bU[bU.length-1];default:bX=bU[bU.length-2];bY=bU[bU.length-1]}}bV.toString=ba._path2string;bT.abs=aT(bV);return bV},aA=function(b,g,d,E){return[b,g,d,E,d,E]},a9=function(R,bN,g,E,S,bO){var b=1/3,d=2/3;return[b*R+d*g,b*bN+d*E,b*S+d*g,b*bO+d*E,S,bO]},a=function(ci,co,b8,ca,d,bY,cf,cj,cp,b5){var b=a0*120/180,b4=a0/180*(+d||0),b6=[],cl,b7=v(function(cs,cu,cr){var ct=cs*aE.cos(cr)-cu*aE.sin(cr),cv=cs*aE.sin(cr)+cu*aE.cos(cr);return{x:ct,y:cv}});if(!b5){cl=b7(ci,co,-b4);ci=cl.x;co=cl.y;cl=b7(cj,cp,-b4);cj=cl.x;cp=cl.y;var R=aE.cos(a0/180*d),ce=aE.sin(a0/180*d),ch=(ci-cj)/2,cm=(co-cp)/2;var bS=(ch*ch)/(b8*b8)+(cm*cm)/(ca*ca);if(bS>1){bS=aE.sqrt(bS);b8=bS*b8;ca=bS*ca}var b9=b8*b8,cb=ca*ca,bX=(bY==cf?-1:1)*aE.sqrt(c((b9*cb-b9*cm*cm-cb*ch*ch)/(b9*cm*cm+cb*ch*ch))),S=bX*b8*cm/ca+(ci+cj)/2,bN=bX*-ca*ch/b8+(co+cp)/2,bP=aE.asin(((co-bN)/ca).toFixed(9)),bQ=aE.asin(((cp-bN)/ca).toFixed(9));bP=ci<S?a0-bP:bP;bQ=cj<S?a0-bQ:bQ;bP<0&&(bP=a0*2+bP);bQ<0&&(bQ=a0*2+bQ);if(cf&&bP>bQ){bP=bP-a0*2}if(!cf&&bQ>bP){bQ=bQ-a0*2}}else{bP=b5[0];bQ=b5[1];S=b5[2];bN=b5[3]}var bO=bQ-bP;if(c(bO)>b){var bR=bQ,ck=cj,cq=cp;bQ=bP+b*(cf&&bQ>bP?1:-1);cj=S+b8*aE.cos(bQ);cp=bN+ca*aE.sin(bQ);b6=a(cj,cp,b8,ca,d,0,cf,ck,cq,[bQ,bR,S,bN])}bO=bQ-bP;var g=aE.cos(bP),cc=aE.sin(bP),E=aE.cos(bQ),cd=aE.sin(bQ),cg=aE.tan(bO/4),bT=4/3*b8*cg,bU=4/3*ca*cg,bZ=[ci,co],b0=[ci+bT*cc,co-bU*g],b1=[cj+bT*cd,cp-bU*E],b2=[cj,cp];b0[0]=2*bZ[0]-b0[0];b0[1]=2*bZ[1]-b0[1];if(b5){return[b0,b1,b2][B](b6)}else{b6=[b0,b1,b2][B](b6).join()[bp](",");var b3=[];for(var bV=0,bW=b6.length;bV<bW;bV++){b3[bV]=bV%2?b7(b6[bV-1],b6[bV],b4).y:b7(b6[bV],b6[bV+1],b4).x}return b3}},Y=function(R,S,b,d,g,E,bN,bO,bP){var bQ=1-bP;return{x:a2(bQ,3)*R+a2(bQ,2)*3*bP*b+bQ*3*bP*bP*g+a2(bP,3)*bN,y:a2(bQ,3)*S+a2(bQ,2)*3*bP*d+bQ*3*bP*bP*E+a2(bP,3)*bO}},F=v(function(bQ,bR,R,S,bN,bO,bS,bT){var d=(bN-2*R+bQ)-(bS-2*bN+R),g=2*(R-bQ)-2*(bN-R),E=bQ-R,bU=(-g+aE.sqrt(g*g-4*d*E))/2/d,bV=(-g-aE.sqrt(g*g-4*d*E))/2/d,bX=[bR,bT],bW=[bQ,bS],bP;c(bU)>"1e12"&&(bU=0.5);c(bV)>"1e12"&&(bV=0.5);if(bU>0&&bU<1){bP=Y(bQ,bR,R,S,bN,bO,bS,bT,bU);bW.push(bP.x);bX.push(bP.y)}if(bV>0&&bV<1){bP=Y(bQ,bR,R,S,bN,bO,bS,bT,bV);bW.push(bP.x);bX.push(bP.y)}d=(bO-2*S+bR)-(bT-2*bO+S);g=2*(S-bR)-2*(bO-S);E=bR-S;bU=(-g+aE.sqrt(g*g-4*d*E))/2/d;bV=(-g-aE.sqrt(g*g-4*d*E))/2/d;c(bU)>"1e12"&&(bU=0.5);c(bV)>"1e12"&&(bV=0.5);if(bU>0&&bU<1){bP=Y(bQ,bR,R,S,bN,bO,bS,bT,bU);bW.push(bP.x);bX.push(bP.y)}if(bV>0&&bV<1){bP=Y(bQ,bR,R,S,bN,bO,bS,bT,bV);bW.push(bP.x);bX.push(bP.y)}return{min:{x:aI[l](0,bW),y:aI[l](0,bX)},max:{x:aH[l](0,bW),y:aH[l](0,bX)}}}),aS=ba._path2curve=v(function(bP,bQ){var bS=!bQ&&aW(bP);if(!bQ&&bS.curve){return aT(bS.curve)}var bN=aX(bP),bO=bQ&&aX(bQ),b={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},d={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},bR=function(b0,bX){var bY,bZ;if(!b0){return["C",bX.x,bX.y,bX.x,bX.y,bX.x,bX.y]}!(b0[0] in {T:1,Q:1})&&(bX.qx=bX.qy=null);switch(b0[0]){case"M":bX.X=b0[1];bX.Y=b0[2];break;case"A":b0=["C"][B](a[l](0,[bX.x,bX.y][B](b0.slice(1))));break;case"S":bY=bX.x+(bX.x-(bX.bx||bX.x));bZ=bX.y+(bX.y-(bX.by||bX.y));b0=["C",bY,bZ][B](b0.slice(1));break;case"T":bX.qx=bX.x+(bX.x-(bX.qx||bX.x));bX.qy=bX.y+(bX.y-(bX.qy||bX.y));b0=["C"][B](a9(bX.x,bX.y,bX.qx,bX.qy,b0[1],b0[2]));break;case"Q":bX.qx=b0[1];bX.qy=b0[2];b0=["C"][B](a9(bX.x,bX.y,b0[1],b0[2],b0[3],b0[4]));break;case"L":b0=["C"][B](aA(bX.x,bX.y,b0[1],b0[2]));break;case"H":b0=["C"][B](aA(bX.x,bX.y,b0[1],bX.y));break;case"V":b0=["C"][B](aA(bX.x,bX.y,bX.x,b0[1]));break;case"Z":b0=["C"][B](aA(bX.x,bX.y,bX.X,bX.Y));break}return b0},g=function(bZ,bX){if(bZ[bX].length>7){bZ[bX].shift();var bY=bZ[bX];while(bY.length){bZ.splice(bX++,0,["C"][B](bY.splice(0,6)))}bZ.splice(bX,1);S=aH(bN.length,bO&&bO.length||0)}},E=function(b0,b1,bX,bY,bZ){if(b0&&b1&&b0[bZ][0]=="M"&&b1[bZ][0]!="M"){b1.splice(bZ,0,["M",bY.x,bY.y]);bX.bx=0;bX.by=0;bX.x=b0[bZ][1];bX.y=b0[bZ][2];S=aH(bN.length,bO&&bO.length||0)}};for(var R=0,S=aH(bN.length,bO&&bO.length||0);R<S;R++){bN[R]=bR(bN[R],b);g(bN,R);bO&&(bO[R]=bR(bO[R],d));bO&&g(bO,R);E(bN,bO,b,d,R);E(bO,bN,d,b,R);var bT=bN[R],bU=bO&&bO[R],bW=bT.length,bV=bO&&bU.length;b.x=bT[bW-2];b.y=bT[bW-1];b.bx=bz(bT[bW-4])||b.x;b.by=bz(bT[bW-3])||b.y;d.bx=bO&&(bz(bU[bV-4])||d.x);d.by=bO&&(bz(bU[bV-3])||d.y);d.x=bO&&bU[bV-2];d.y=bO&&bU[bV-1]}if(!bO){bS.curve=aT(bN)}return bO?[bN,bO]:bN},null,aT),aR=ba._parseDots=v(function(S){var E=[];for(var bN=0,bO=S.length;bN<bO;bN++){var g={},bQ=S[bN].match(/^([^:]*):?([\d\.]*)/);g.color=ba.getRGB(bQ[1]);if(g.color.error){return null}g.color=g.color.hex;bQ[2]&&(g.offset=bQ[2]+"%");E.push(g)}for(bN=1,bO=E.length-1;bN<bO;bN++){if(!E[bN].offset){var bR=bz(E[bN-1].offset||0),R=0;for(var bP=bN+1;bP<bO;bP++){if(E[bP].offset){R=E[bP].offset;break}}if(!R){R=100;bP=bO}R=bz(R);var b=(R-bR)/(bP-bN+1);for(;bN<bP;bN++){bR+=b;E[bN].offset=bR+"%"}}}return E}),bx=ba._tear=function(b,d){b==d.top&&(d.top=b.prev);b==d.bottom&&(d.bottom=b.next);b.next&&(b.next.prev=b.prev);b.prev&&(b.prev.next=b.next)},bA=ba._tofront=function(b,d){if(d.top===b){return}bx(b,d);b.next=null;b.prev=d.top;d.top.next=b;d.top=b},by=ba._toback=function(b,d){if(d.bottom===b){return}bx(b,d);b.next=d.bottom;b.prev=null;d.bottom.prev=b;d.bottom=b},aq=ba._insertafter=function(b,d,g){bx(b,g);d==g.top&&(g.top=b);d.next&&(d.next.prev=b);b.next=d.next;b.prev=d;d.next=b},ar=ba._insertbefore=function(b,d,g){bx(b,g);d==g.bottom&&(g.bottom=b);d.prev&&(d.prev.next=b);b.prev=d.prev;d.prev=b;b.next=d},bD=ba.toMatrix=function(g,E){var b=aV(g),d={_:{transform:M},getBBox:function(){return b}};W(d,E);return d.matrix},bG=ba.transformPath=function(b,d){return aD(b,bD(b,d))},W=ba._extractTransform=function(bO,bY){if(bY==null){return bO._.transform}bY=bt(bY).replace(/\.{3}|\u2026/g,bO._.transform||M);var bW=ba.parseTransformString(bY),R=0,S=0,bN=0,bT=1,bU=1,b=bO._,bS=new aF;b.transform=bW||[];if(bW){for(var bP=0,bQ=bW.length;bP<bQ;bP++){var bV=bW[bP],bX=bV.length,E=bt(bV[0]).toLowerCase(),d=bV[0]!=E,bR=d?bS.invert():0,bZ,b1,b0,b2,g;if(E=="t"&&bX==3){if(d){bZ=bR.x(0,0);b1=bR.y(0,0);b0=bR.x(bV[1],bV[2]);b2=bR.y(bV[1],bV[2]);bS.translate(b0-bZ,b2-b1)}else{bS.translate(bV[1],bV[2])}}else{if(E=="r"){if(bX==2){g=g||bO.getBBox(1);bS.rotate(bV[1],g.x+g.width/2,g.y+g.height/2);R+=bV[1]}else{if(bX==4){if(d){b0=bR.x(bV[2],bV[3]);b2=bR.y(bV[2],bV[3]);bS.rotate(bV[1],b0,b2)}else{bS.rotate(bV[1],bV[2],bV[3])}R+=bV[1]}}}else{if(E=="s"){if(bX==2||bX==3){g=g||bO.getBBox(1);bS.scale(bV[1],bV[bX-1],g.x+g.width/2,g.y+g.height/2);bT*=bV[1];bU*=bV[bX-1]}else{if(bX==5){if(d){b0=bR.x(bV[3],bV[4]);b2=bR.y(bV[3],bV[4]);bS.scale(bV[1],bV[2],b0,b2)}else{bS.scale(bV[1],bV[2],bV[3],bV[4])}bT*=bV[1];bU*=bV[2]}}}else{if(E=="m"&&bX==7){bS.add(bV[1],bV[2],bV[3],bV[4],bV[5],bV[6])}}}}b.dirtyT=1;bO.matrix=bS}}bO.matrix=bS;b.sx=bT;b.sy=bU;b.deg=R;b.dx=S=bS.e;b.dy=bN=bS.f;if(bT==1&&bU==1&&!R&&b.bbox){b.bbox.x+=+S;b.bbox.y+=+bN}else{b.dirtyT=1}},ac=function(b){var d=b[0];switch(d.toLowerCase()){case"t":return[d,0,0];case"m":return[d,1,0,0,1,0,0];case"r":if(b.length==4){return[d,0,b[2],b[3]]}else{return[d,0]}case"s":if(b.length==5){return[d,1,1,b[3],b[4]]}else{if(b.length==3){return[d,1,1]}else{return[d,1]}}}},U=ba._equaliseTransform=function(S,bN){bN=bt(bN).replace(/\.{3}|\u2026/g,S);S=ba.parseTransformString(S)||[];bN=ba.parseTransformString(bN)||[];var R=aH(S.length,bN.length),b=[],bO=[],d=0,g,E,bP,bQ;for(;d<R;d++){bP=S[d]||ac(bN[d]);bQ=bN[d]||ac(bP);if((bP[0]!=bQ[0])||(bP[0].toLowerCase()=="r"&&(bP[2]!=bQ[2]||bP[3]!=bQ[3]))||(bP[0].toLowerCase()=="s"&&(bP[3]!=bQ[3]||bP[4]!=bQ[4]))){return}b[d]=[];bO[d]=[];for(g=0,E=aH(bP.length,bQ.length);g<E;g++){g in bP&&(b[d][g]=bP[g]);g in bQ&&(bO[d][g]=bQ[g])}}return{from:b,to:bO}};ba._getContainer=function(E,R,g,d){var b;b=d==null&&!ba.is(E,"object")?ab.doc.getElementById(E):E;if(b==null){return}if(b.tagName){if(R==null){return{container:b,width:b.style.pixelWidth||b.offsetWidth,height:b.style.pixelHeight||b.offsetHeight}}else{return{container:b,width:R,height:g}}}return{container:1,x:E,y:R,width:g,height:d}};ba.pathToRelative=aY;ba._engine={};ba.path2curve=aS;ba.matrix=function(g,E,R,S,bN,bO){return new aF(g,E,R,S,bN,bO)};function aF(g,E,R,S,bN,bO){if(g!=null){this.a=+g;this.b=+E;this.c=+R;this.d=+S;this.e=+bN;this.f=+bO}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0}}(function(b){b.add=function(E,R,S,bN,bO,bP){var bS=[[],[],[]],bQ=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],bR=[[E,S,bO],[R,bN,bP],[0,0,1]],bU,bV,bW,bT;if(E&&E instanceof aF){bR=[[E.a,E.c,E.e],[E.b,E.d,E.f],[0,0,1]]}for(bU=0;bU<3;bU++){for(bV=0;bV<3;bV++){bT=0;for(bW=0;bW<3;bW++){bT+=bQ[bU][bW]*bR[bW][bV]}bS[bU][bV]=bT}}this.a=bS[0][0];this.b=bS[1][0];this.c=bS[0][1];this.d=bS[1][1];this.e=bS[0][2];this.f=bS[1][2]};b.invert=function(){var E=this,R=E.a*E.d-E.b*E.c;return new aF(E.d/R,-E.b/R,-E.c/R,E.a/R,(E.c*E.f-E.d*E.e)/R,(E.b*E.e-E.a*E.f)/R)};b.clone=function(){return new aF(this.a,this.b,this.c,this.d,this.e,this.f)};b.translate=function(E,R){this.add(1,0,0,1,E,R)};b.scale=function(S,bN,E,R){bN==null&&(bN=S);(E||R)&&this.add(1,0,0,1,E,R);this.add(S,0,0,bN,0,0);(E||R)&&this.add(1,0,0,1,-E,-R)};b.rotate=function(E,bN,bO){E=ba.rad(E);bN=bN||0;bO=bO||0;var R=+aE.cos(E).toFixed(9),S=+aE.sin(E).toFixed(9);this.add(R,S,-S,R,bN,bO);this.add(1,0,0,1,-bN,-bO)};b.x=function(E,R){return E*this.a+R*this.c+this.e};b.y=function(E,R){return E*this.b+R*this.d+this.f};b.get=function(E){return +this[bt.fromCharCode(97+E)].toFixed(4)};b.toString=function(){return ba.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};b.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};b.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};function d(E){return E[0]*E[0]+E[1]*E[1]}function g(E){var R=aE.sqrt(d(E));E[0]&&(E[0]/=R);E[1]&&(E[1]/=R)}b.split=function(){var R={};R.dx=this.e;R.dy=this.f;var S=[[this.a,this.c],[this.b,this.d]];R.scalex=aE.sqrt(d(S[0]));g(S[0]);R.shear=S[0][0]*S[1][0]+S[0][1]*S[1][1];S[1]=[S[1][0]-S[0][0]*R.shear,S[1][1]-S[0][1]*R.shear];R.scaley=aE.sqrt(d(S[1]));g(S[1]);R.shear/=R.scaley;var bN=-S[0][1],E=S[1][1];if(E<0){R.rotate=ba.deg(aE.acos(E));if(bN<0){R.rotate=360-R.rotate}}else{R.rotate=ba.deg(aE.asin(bN))}R.isSimple=!+R.shear.toFixed(9)&&(R.scalex.toFixed(9)==R.scaley.toFixed(9)||!R.rotate);R.isSuperSimple=!+R.shear.toFixed(9)&&R.scalex.toFixed(9)==R.scaley.toFixed(9)&&!R.rotate;R.noRotation=!+R.shear.toFixed(9)&&!R.rotate;return R};b.toTransformString=function(R){var E=R||this[bp]();if(E.isSimple){E.scalex=+E.scalex.toFixed(4);E.scaley=+E.scaley.toFixed(4);E.rotate=+E.rotate.toFixed(4);return(E.dx||E.dy?"t"+[E.dx,E.dy]:M)+(E.scalex!=1||E.scaley!=1?"s"+[E.scalex,E.scaley,0,0]:M)+(E.rotate?"r"+[E.rotate,0,0]:M)}else{return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}})(aF.prototype);var bJ=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);if((navigator.vendor=="Apple Computer, Inc.")&&(bJ&&bJ[1]<4||navigator.platform.slice(0,2)=="iP")||(navigator.vendor=="Google Inc."&&bJ&&bJ[1]<8)){aQ.safari=function(){var b=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){b.remove()})}}else{aQ.safari=aa}var a5=function(){this.returnValue=false},a6=function(){return this.originalEvent.preventDefault()},br=function(){this.cancelBubble=true},bs=function(){return this.originalEvent.stopPropagation()},e=(function(){if(ab.doc.addEventListener){return function(E,S,g,b){var R=bv&&bF[S]?bF[S]:S,d=function(bN){var bS=ab.doc.documentElement.scrollTop||ab.doc.body.scrollTop,bR=ab.doc.documentElement.scrollLeft||ab.doc.body.scrollLeft,bT=bN.clientX+bR,bU=bN.clientY+bS;if(bv&&bF[al](S)){for(var bO=0,bP=bN.targetTouches&&bN.targetTouches.length;bO<bP;bO++){if(bN.targetTouches[bO].target==E){var bQ=bN;bN=bN.targetTouches[bO];bN.originalEvent=bQ;bN.preventDefault=a6;bN.stopPropagation=bs;break}}}return g.call(b,bN,bT,bU)};E.addEventListener(R,d,false);return function(){E.removeEventListener(R,d,false);return true}}}else{if(ab.doc.attachEvent){return function(R,S,E,d){var g=function(bN){bN=bN||ab.win.event;var bP=ab.doc.documentElement.scrollTop||ab.doc.body.scrollTop,bO=ab.doc.documentElement.scrollLeft||ab.doc.body.scrollLeft,bQ=bN.clientX+bO,bR=bN.clientY+bP;bN.preventDefault=bN.preventDefault||a5;bN.stopPropagation=bN.stopPropagation||br;return E.call(d,bN,bQ,bR)};R.attachEvent("on"+S,g);var b=function(){R.detachEvent("on"+S,g);return true};return b}}}})(),I=[],K=function(g){var bT=g.clientX,bU=g.clientY,bR=ab.doc.documentElement.scrollTop||ab.doc.body.scrollTop,bQ=ab.doc.documentElement.scrollLeft||ab.doc.body.scrollLeft,d,R=I.length;while(R--){d=I[R];if(bv){var E=g.touches.length,bS;while(E--){bS=g.touches[E];if(bS.identifier==d.el._drag.id){bT=bS.clientX;bU=bS.clientY;(g.originalEvent?g.originalEvent:g).preventDefault();break}}}else{g.preventDefault()}var bN=d.el.node,bO,S=bN.nextSibling,bP=bN.parentNode,b=bN.style.display;ab.win.opera&&bP.removeChild(bN);bN.style.display="none";bO=d.el.paper.getElementByPoint(bT,bU);bN.style.display=b;ab.win.opera&&(S?bP.insertBefore(bN,S):bP.appendChild(bN));bO&&eve("raphael.drag.over."+d.el.id,d.el,bO);bT+=bQ;bU+=bR;eve("raphael.drag.move."+d.el.id,d.move_scope||d.el,bT-d.el._drag.x,bU-d.el._drag.y,bT,bU,g)}},L=function(d){ba.unmousemove(K).unmouseup(L);var g=I.length,b;while(g--){b=I[g];b.el._drag={};eve("raphael.drag.end."+b.el.id,b.end_scope||b.start_scope||b.move_scope||b.el,d)}I=[]},T=ba.el={};for(var ap=V.length;ap--;){(function(b){ba[b]=T[b]=function(d,g){if(ba.is(d,"function")){this.events=this.events||[];this.events.push({name:b,f:d,unbind:e(this.shape||this.node||ab.doc,b,d,g||this)})}return this};ba["un"+b]=T["un"+b]=function(g){var d=this.events||[],E=d.length;while(E--){if(d[E].name==b&&d[E].f==g){d[E].unbind();d.splice(E,1);!d.length&&delete this.events;return this}}return this}})(V[ap])}T.data=function(g,E){var b=O[this.id]=O[this.id]||{};if(arguments.length==1){if(ba.is(g,"object")){for(var d in g){if(g[al](d)){this.data(d,g[d])}}return this}eve("raphael.data.get."+this.id,this,b[g],g);return b[g]}b[g]=E;eve("raphael.data.set."+this.id,this,E,g);return this};T.removeData=function(b){if(b==null){O[this.id]={}}else{O[this.id]&&delete O[this.id][b]}return this};T.hover=function(b,d,g,E){return this.mouseover(b,g).mouseout(d,E||g)};T.unhover=function(b,d){return this.unmouseover(b).unmouseout(d)};var J=[];T.drag=function(E,R,g,d,S,b){this.initDrag=function(bN){(bN.originalEvent||bN).preventDefault();var bP=ab.doc.documentElement.scrollTop||ab.doc.body.scrollTop,bO=ab.doc.documentElement.scrollLeft||ab.doc.body.scrollLeft;this._drag.x=bN.clientX+bO;this._drag.y=bN.clientY+bP;this._drag.id=bN.identifier;!I.length&&ba.mousemove(K).mouseup(L);I.push({el:this,move_scope:d,start_scope:S,end_scope:b});R&&eve.on("raphael.drag.start."+this.id,R);E&&eve.on("raphael.drag.move."+this.id,E);g&&eve.on("raphael.drag.end."+this.id,g);eve("raphael.drag.start."+this.id,S||d||this,bN.clientX+bO,bN.clientY+bP,bN)};this._drag={};J.push({el:this,start:this.initDrag});this.mousedown(this.initDrag);return this};T.onDragOver=function(b){b?eve.on("raphael.drag.over."+this.id,b):eve.unbind("raphael.drag.over."+this.id)};T.undrag=function(){var b=J.length;while(b--){if(J[b].el==this){this.unmousedown(J[b].start);J.splice(b,1);eve.unbind("raphael.drag.*."+this.id)}}!J.length&&ba.unmousemove(K).unmouseup(L)};aQ.circle=function(g,E,d){var b=ba._engine.circle(this,g||0,E||0,d||0);this.__set__&&this.__set__.push(b);return b};aQ.rect=function(R,S,E,b,g){var d=ba._engine.rect(this,R||0,S||0,E||0,b||0,g||0);this.__set__&&this.__set__.push(d);return d};aQ.ellipse=function(E,R,d,g){var b=ba._engine.ellipse(this,E||0,R||0,d||0,g||0);this.__set__&&this.__set__.push(b);return b};aQ.path=function(d){d&&!ba.is(d,bu)&&!ba.is(d[0],m)&&(d+=M);var b=ba._engine.path(ba.format[l](ba,arguments),this);this.__set__&&this.__set__.push(b);return b};aQ.image=function(g,R,S,E,b){var d=ba._engine.image(this,g||"about:blank",R||0,S||0,E||0,b||0);this.__set__&&this.__set__.push(d);return d};aQ.text=function(g,E,d){var b=ba._engine.text(this,g||0,E||0,bt(d));this.__set__&&this.__set__.push(b);return b};aQ.set=function(b){!ba.is(b,"array")&&(b=Array.prototype.splice.call(arguments,0,arguments.length));var d=new bk(b);this.__set__&&this.__set__.push(d);return d};aQ.setStart=function(b){this.__set__=b||this.set()};aQ.setFinish=function(d){var b=this.__set__;delete this.__set__;return b};aQ.setSize=function(d,b){return ba._engine.setSize.call(this,d,b)};aQ.setViewBox=function(E,R,g,d,b){return ba._engine.setViewBox.call(this,E,R,g,d,b)};aQ.top=aQ.bottom=null;aQ.raphael=ba;var ae=function(bN){var d=bN.getBoundingClientRect(),R=bN.ownerDocument,b=R.body,S=R.documentElement,E=S.clientTop||b.clientTop||0,g=S.clientLeft||b.clientLeft||0,bP=d.top+(ab.win.pageYOffset||S.scrollTop||b.scrollTop)-E,bO=d.left+(ab.win.pageXOffset||S.scrollLeft||b.scrollLeft)-g;return{y:bP,x:bO}};aQ.getElementByPoint=function(bN,bO){var d=this,R=d.canvas,S=ab.doc.elementFromPoint(bN,bO);if(ab.win.opera&&S.tagName=="svg"){var g=ae(R),E=R.createSVGRect();E.x=bN-g.x;E.y=bO-g.y;E.width=E.height=1;var b=R.getIntersectionList(E,null);if(b.length){S=b[b.length-1]}}if(!S){return null}while(S.parentNode&&S!=R.parentNode&&!S.raphael){S=S.parentNode}S==d.canvas.parentNode&&(S=R);S=S&&S.raphael?d.getById(S.raphaelid):null;return S};aQ.getById=function(d){var b=this.bottom;while(b){if(b.id==d){return b}b=b.next}return null};aQ.forEach=function(d,g){var b=this.bottom;while(b){if(d.call(g,b)===false){return this}b=b.next}return this};aQ.getElementsByPoint=function(d,g){var b=this.set();this.forEach(function(E){if(E.isPointInside(d,g)){b.push(E)}});return b};function bL(){return this.x+bi+this.y}function bM(){return this.x+bi+this.y+bi+this.width+" \xd7 "+this.height}T.isPointInside=function(d,g){var b=this.realPath=this.realPath||af[this.type](this);return ba.isPointInsidePath(b,d,g)};T.getBBox=function(d){if(this.removed){return{}}var b=this._;if(d){if(b.dirty||!b.bboxwt){this.realPath=af[this.type](this);b.bboxwt=aV(this.realPath);b.bboxwt.toString=bM;b.dirty=0}return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath){b.bboxwt=0;this.realPath=af[this.type](this)}b.bbox=aV(aD(this.realPath,this.matrix));b.bbox.toString=bM;b.dirty=b.dirtyT=0}return b.bbox};T.clone=function(){if(this.removed){return null}var b=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(b);return b};T.glow=function(d){if(this.type=="text"){return null}d=d||{};var bN={width:(d.width||10)+(+this.attr("stroke-width")||1),fill:d.fill||false,opacity:d.opacity||0.5,offsetx:d.offsetx||0,offsety:d.offsety||0,color:d.color||"#000"},b=bN.width/2,S=this.paper,E=S.set(),R=this.realPath||af[this.type](this);R=this.matrix?aD(R,this.matrix):R;for(var g=1;g<b+1;g++){E.push(S.path(R).attr({stroke:bN.color,fill:bN.fill?bN.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(bN.width/b*g).toFixed(3),opacity:+(bN.opacity/b).toFixed(3)}))}return E.insertBefore(this).translate(bN.offsetx,bN.offsety)};var G={},ah=function(S,bN,b,d,g,E,bO,bP,R){if(R==null){return u(S,bN,b,d,g,E,bO,bP)}else{return ba.findDotsAtSegment(S,bN,b,d,g,E,bO,bP,aj(S,bN,b,d,g,E,bO,bP,R))}},ad=function(b,d){return function(bQ,bN,bO){bQ=aS(bQ);var bU,bV,bP,R,bS="",bT={},bR,S=0;for(var g=0,E=bQ.length;g<E;g++){bP=bQ[g];if(bP[0]=="M"){bU=+bP[1];bV=+bP[2]}else{R=ah(bU,bV,bP[1],bP[2],bP[3],bP[4],bP[5],bP[6]);if(S+R>bN){if(d&&!bT.start){bR=ah(bU,bV,bP[1],bP[2],bP[3],bP[4],bP[5],bP[6],bN-S);bS+=["C"+bR.start.x,bR.start.y,bR.m.x,bR.m.y,bR.x,bR.y];if(bO){return bS}bT.start=bS;bS=["M"+bR.x,bR.y+"C"+bR.n.x,bR.n.y,bR.end.x,bR.end.y,bP[5],bP[6]].join();S+=R;bU=+bP[5];bV=+bP[6];continue}if(!b&&!d){bR=ah(bU,bV,bP[1],bP[2],bP[3],bP[4],bP[5],bP[6],bN-S);return{x:bR.x,y:bR.y,alpha:bR.alpha}}}S+=R;bU=+bP[5];bV=+bP[6]}bS+=bP.shift()+bP}bT.end=bS;bR=b?S:d?bT:ba.findDotsAtSegment(bU,bV,bP[0],bP[1],bP[2],bP[3],bP[4],bP[5],1);bR.alpha&&(bR={x:bR.x,y:bR.y,alpha:bR.alpha});return bR}};var ak=ad(1),ag=ad(),ai=ad(0,1);ba.getTotalLength=ak;ba.getPointAtLength=ag;ba.getSubpath=function(g,d,E){if(this.getTotalLength(g)-E<1e-06){return ai(g,d).end}var b=ai(g,E,1);return d?ai(b,d).end:b};T.getTotalLength=function(){if(this.type!="path"){return}if(this.node.getTotalLength){return this.node.getTotalLength()}return ak(this.attrs.path)};T.getPointAtLength=function(b){if(this.type!="path"){return}return ag(this.attrs.path,b)};T.getSubpath=function(b,d){if(this.type!="path"){return}return ba.getSubpath(this.attrs.path,b,d)};var N=ba.easing_formulas={linear:function(b){return b},"<":function(b){return a2(b,1.7)},">":function(b){return a2(b,0.48)},"<>":function(b){var d=0.48-b/1.04,g=aE.sqrt(0.1734+d*d),R=g-d,S=a2(c(R),1/3)*(R<0?-1:1),bN=-g-d,bO=a2(c(bN),1/3)*(bN<0?-1:1),E=S+bO+0.5;return(1-E)*3*E*E+E*E*E},backIn:function(b){var d=1.70158;return b*b*((d+1)*b-d)},backOut:function(b){b=b-1;var d=1.70158;return b*b*((d+1)*b+d)+1},elastic:function(b){if(b==!!b){return b}return a2(2,-10*b)*aE.sin((b-0.075)*(2*a0)/0.3)+1},bounce:function(d){var E=7.5625,g=2.75,b;if(d<(1/g)){b=E*d*d}else{if(d<(2/g)){d-=(1.5/g);b=E*d*d+0.75}else{if(d<(2.5/g)){d-=(2.25/g);b=E*d*d+0.9375}else{d-=(2.625/g);b=E*d*d+0.984375}}}return b}};N.easeIn=N["ease-in"]=N["<"];N.easeOut=N["ease-out"]=N[">"];N.easeInOut=N["ease-in-out"]=N["<>"];N["back-in"]=N.backIn;N["back-out"]=N.backOut;var j=[],be=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(b,16)},f=function(){var bX=+new Date,bU=0;for(;bU<j.length;bU++){var g=j[bU];if(g.el.removed||g.paused){continue}var b2=bX-g.start,bV=g.ms,E=g.easing,R=g.from,d=g.diff,b3=g.to,b0=g.t,b1=g.el,bZ={},bW,bQ={},bT;if(g.initstatus){b2=(g.initstatus*g.anim.top-g.prev)/(g.percent-g.prev)*bV;g.status=g.initstatus;delete g.initstatus;g.stop&&j.splice(bU--,1)}else{g.status=(g.prev+(g.percent-g.prev)*(b2/bV))/g.anim.top}if(b2<0){continue}if(b2<bV){var bY=E(b2/bV);for(var b in R){if(R[al](b)){switch(n[b]){case aJ:bW=+R[b]+bY*bV*d[b];break;case"colour":bW="rgb("+[bI(bg(R[b].r+bY*bV*d[b].r)),bI(bg(R[b].g+bY*bV*d[b].g)),bI(bg(R[b].b+bY*bV*d[b].b))].join(",")+")";break;case"path":bW=[];for(var bO=0,bP=R[b].length;bO<bP;bO++){bW[bO]=[R[b][bO][0]];for(var bR=1,bS=R[b][bO].length;bR<bS;bR++){bW[bO][bR]=+R[b][bO][bR]+bY*bV*d[b][bO][bR]}bW[bO]=bW[bO].join(bi)}bW=bW.join(bi);break;case"transform":if(d[b].real){bW=[];for(bO=0,bP=R[b].length;bO<bP;bO++){bW[bO]=[R[b][bO][0]];for(bR=1,bS=R[b][bO].length;bR<bS;bR++){bW[bO][bR]=R[b][bO][bR]+bY*bV*d[b][bO][bR]}}}else{var bN=function(b4){return +R[b][b4]+bY*bV*d[b][b4]};bW=[["m",bN(0),bN(1),bN(2),bN(3),bN(4),bN(5)]]}break;case"csv":if(b=="clip-rect"){bW=[];bO=4;while(bO--){bW[bO]=+R[b][bO]+bY*bV*d[b][bO]}}break;default:var S=[][B](R[b]);bW=[];bO=b1.paper.customAttributes[b].length;while(bO--){bW[bO]=+S[bO]+bY*bV*d[b][bO]}break}bZ[b]=bW}}b1.attr(bZ);(function(b5,b6,b4){setTimeout(function(){eve("raphael.anim.frame."+b5,b6,b4)})})(b1.id,b1,g.anim)}else{(function(b6,b5,b4){setTimeout(function(){eve("raphael.anim.frame."+b5.id,b5,b4);eve("raphael.anim.finish."+b5.id,b5,b4);ba.is(b6,"function")&&b6.call(b5)})})(g.callback,b1,g.anim);b1.attr(b3);j.splice(bU--,1);if(g.repeat>1&&!g.next){for(bT in b3){if(b3[al](bT)){bQ[bT]=g.totalOrigin[bT]}}g.el.attr(bQ);bh(g.anim,g.el,g.anim.percents[0],null,g.totalOrigin,g.repeat-1)}if(g.next&&!g.stop){bh(g.anim,g.el,g.next,null,g.totalOrigin,g.repeat)}}}ba.svg&&b1&&b1.paper&&b1.paper.safari();j.length&&be(f)},bI=function(b){return b>255?255:b<0?0:b};T.animateWith=function(R,d,bQ,bP,E,g){var S=this;if(S.removed){g&&g.call(S);return S}var b=bQ instanceof h?bQ:ba.animation(bQ,bP,E,g),bR,bS;bh(b,S,b.percents[0],null,S.attr());for(var bN=0,bO=j.length;bN<bO;bN++){if(j[bN].anim==d&&j[bN].el==R){j[bO-1].start=j[bN].start;break}}return S};function D(bV,bO,bP,bQ,bR,bN){var R=3*bO,g=3*(bQ-bO)-R,b=1-R-g,S=3*bP,E=3*(bR-bP)-S,d=1-S-E;function bS(bW){return((b*bW+g)*bW+R)*bW}function bT(bY,bW){var bX=bU(bY,bW);return((d*bX+E)*bX+S)*bX}function bU(b2,bX){var bZ,b0,b1,b3,bW,bY;for(b1=b2,bY=0;bY<8;bY++){b3=bS(b1)-b2;if(c(b3)<bX){return b1}bW=(3*b*b1+2*g)*b1+R;if(c(bW)<1e-06){break}b1=b1-b3/bW}bZ=0;b0=1;b1=b2;if(b1<bZ){return bZ}if(b1>b0){return b0}while(bZ<b0){b3=bS(b1);if(c(b3-b2)<bX){return b1}if(b2>b3){bZ=b1}else{b0=b1}b1=(b0-bZ)/2+bZ}return b1}return bT(bV,1/(200*bN))}T.onAnimation=function(b){b?eve.on("raphael.anim.frame."+this.id,b):eve.unbind("raphael.anim.frame."+this.id);return this};function h(b,g){var R=[],E={};this.ms=g;this.times=1;if(b){for(var d in b){if(b[al](d)){E[bz(d)]=b[d];R.push(bz(d))}}R.sort(bo)}this.anim=E;this.top=R[R.length-1];this.percents=R}h.prototype.delay=function(d){var b=new h(this.anim,this.ms);b.times=this.times;b.del=+d||0;return b};h.prototype.repeat=function(d){var b=new h(this.anim,this.ms);b.del=this.del;b.times=aE.floor(aH(d,0))||1;return b};function bh(d,bP,b4,b7,ce,b8){b4=bz(b4);var b2,bV,bW,b5=[],b1,b6,b9,b0=d.ms,bR={},ca={},R={};if(b7){for(bT=0,bU=j.length;bT<bU;bT++){var S=j[bT];if(S.el.id==bP.id&&S.anim==d){if(S.percent!=b4){j.splice(bT,1);bW=1}else{bV=S}bP.attr(S.totalOrigin);break}}}else{b7=+ca}for(var bT=0,bU=d.percents.length;bT<bU;bT++){if(d.percents[bT]==b4||d.percents[bT]>b7*d.top){b4=d.percents[bT];b6=d.percents[bT-1]||0;b0=b0/d.top*(b4-b6);b1=d.percents[bT+1];b2=d.anim[b4];break}else{if(b7){bP.attr(d.anim[d.percents[bT]])}}}if(!b2){return}if(!bV){for(var g in b2){if(b2[al](g)){if(n[al](g)||bP.paper.customAttributes[al](g)){bR[g]=bP.attr(g);(bR[g]==null)&&(bR[g]=o[g]);ca[g]=b2[g];switch(n[g]){case aJ:R[g]=(ca[g]-bR[g])/b0;break;case"colour":bR[g]=ba.getRGB(bR[g]);var cc=ba.getRGB(ca[g]);R[g]={r:(cc.r-bR[g].r)/b0,g:(cc.g-bR[g].g)/b0,b:(cc.b-bR[g].b)/b0};break;case"path":var b3=aS(bR[g],ca[g]),cd=b3[1];bR[g]=b3[0];R[g]=[];for(bT=0,bU=bR[g].length;bT<bU;bT++){R[g][bT]=[0];for(var bX=1,bY=bR[g][bT].length;bX<bY;bX++){R[g][bT][bX]=(cd[bT][bX]-bR[g][bT][bX])/b0}}break;case"transform":var b=bP._,bQ=U(b[g],ca[g]);if(bQ){bR[g]=bQ.from;ca[g]=bQ.to;R[g]=[];R[g].real=true;for(bT=0,bU=bR[g].length;bT<bU;bT++){R[g][bT]=[bR[g][bT][0]];for(bX=1,bY=bR[g][bT].length;bX<bY;bX++){R[g][bT][bX]=(ca[g][bT][bX]-bR[g][bT][bX])/b0}}}else{var bZ=(bP.matrix||new aF),cb={_:{transform:b.transform},getBBox:function(){return bP.getBBox(1)}};bR[g]=[bZ.a,bZ.b,bZ.c,bZ.d,bZ.e,bZ.f];W(cb,ca[g]);ca[g]=cb._.transform;R[g]=[(cb.matrix.a-bZ.a)/b0,(cb.matrix.b-bZ.b)/b0,(cb.matrix.c-bZ.c)/b0,(cb.matrix.d-bZ.d)/b0,(cb.matrix.e-bZ.e)/b0,(cb.matrix.f-bZ.f)/b0]}break;case"csv":var cf=bt(b2[g])[bp](bj),bS=bt(bR[g])[bp](bj);if(g=="clip-rect"){bR[g]=bS;R[g]=[];bT=bS.length;while(bT--){R[g][bT]=(cf[bT]-bR[g][bT])/b0}}ca[g]=cf;break;default:cf=[][B](b2[g]);bS=[][B](bR[g]);R[g]=[];bT=bP.paper.customAttributes[g].length;while(bT--){R[g][bT]=((cf[bT]||0)-(bS[bT]||0))/b0}break}}}}var bN=b2.easing,bO=ba.easing_formulas[bN];if(!bO){bO=bt(bN).match(s);if(bO&&bO.length==5){var E=bO;bO=function(cg){return D(cg,+E[1],+E[2],+E[3],+E[4],b0)}}else{bO=a1}}b9=b2.start||d.start||+new Date;S={anim:d,percent:b4,timestamp:b9,start:b9+(d.del||0),status:0,initstatus:b7||0,stop:false,ms:b0,easing:bO,from:bR,diff:R,to:ca,el:bP,callback:b2.callback,prev:b6,next:b1,repeat:b8||d.times,origin:bP.attr(),totalOrigin:ce};j.push(S);if(b7&&!bV&&!bW){S.stop=true;S.start=new Date-b0*b7;if(j.length==1){return f()}}if(bW){S.start=new Date-S.ms*b7}j.length==1&&be(f)}else{bV.initstatus=b7;bV.start=new Date-bV.ms*b7}eve("raphael.anim.start."+bP.id,bP,d)}ba.animation=function(bN,R,g,d){if(bN instanceof h){return bN}if(ba.is(g,"function")||!g){d=d||g||null;g=null}bN=Object(bN);R=+R||0;var S={},E,b;for(b in bN){if(bN[al](b)&&bz(b)!=b&&bz(b)+"%"!=b){E=true;S[b]=bN[b]}}if(!E){return new h(bN,R)}else{g&&(S.easing=g);d&&(S.callback=d);return new h({100:S},R)}};T.animate=function(S,R,g,d){var E=this;if(E.removed){d&&d.call(E);return E}var b=S instanceof h?S:ba.animation(S,R,g,d);bh(b,E,b.percents[0],null,E.attr());return E};T.setTime=function(b,d){if(b&&d!=null){this.status(b,aI(d,b.ms)/b.ms)}return this};T.status=function(b,S){var R=[],g=0,E,d;if(S!=null){bh(b,this,-1,aI(S,1));return this}else{E=j.length;for(;g<E;g++){d=j[g];if(d.el.id==this.id&&(!b||d.anim==b)){if(b){return d.status}R.push({anim:d.anim,status:d.status})}}if(b){return 0}return R}};T.pause=function(b){for(var d=0;d<j.length;d++){if(j[d].el.id==this.id&&(!b||j[d].anim==b)){if(eve("raphael.anim.pause."+this.id,this,j[d].anim)!==false){j[d].paused=true}}}return this};T.resume=function(b){for(var g=0;g<j.length;g++){if(j[g].el.id==this.id&&(!b||j[g].anim==b)){var d=j[g];if(eve("raphael.anim.resume."+this.id,this,d.anim)!==false){delete d.paused;this.status(d.anim,d.status)}}}return this};T.stop=function(b){for(var d=0;d<j.length;d++){if(j[d].el.id==this.id&&(!b||j[d].anim==b)){if(eve("raphael.anim.stop."+this.id,this,j[d].anim)!==false){j.splice(d--,1)}}}return this};function bq(d){for(var b=0;b<j.length;b++){if(j[b].el.paper==d){j.splice(b--,1)}}}eve.on("raphael.remove",bq);eve.on("raphael.clear",bq);T.toString=function(){return"Rapha\xebl\u2019s object"};var bk=function(g){this.items=[];this.length=0;this.type="set";if(g){for(var b=0,d=g.length;b<d;b++){if(g[b]&&(g[b].constructor==T.constructor||g[b].constructor==bk)){this[this.items.length]=this.items[this.items.length]=g[b];this.length++}}}},bm=bk.prototype;bm.push=function(){var g,E;for(var b=0,d=arguments.length;b<d;b++){g=arguments[b];if(g&&(g.constructor==T.constructor||g.constructor==bk)){E=this.items.length;this[E]=this.items[E]=g;this.length++}}return this};bm.pop=function(){this.length&&delete this[this.length--];return this.items.pop()};bm.forEach=function(b,E){for(var d=0,g=this.items.length;d<g;d++){if(b.call(E,this.items[d],d)===false){return this}}return this};for(var aG in T){if(T[al](aG)){bm[aG]=(function(b){return function(){var d=arguments;return this.forEach(function(g){g[b][l](g,d)})}})(aG)}}bm.attr=function(R,S){if(R&&ba.is(R,m)&&ba.is(R[0],"object")){for(var g=0,E=R.length;g<E;g++){this.items[g].attr(R[g])}}else{for(var b=0,d=this.items.length;b<d;b++){this.items[b].attr(R,S)}}return this};bm.clear=function(){while(this.length){this.pop()}};bm.splice=function(R,g,S){R=R<0?aH(this.length+R,0):R;g=aH(0,aI(this.length-R,g));var bN=[],bO=[],d=[],E;for(E=2;E<arguments.length;E++){d.push(arguments[E])}for(E=0;E<g;E++){bO.push(this[R+E])}for(;E<this.length-R;E++){bN.push(this[R+E])}var b=d.length;for(E=0;E<b+bN.length;E++){this.items[R+E]=this[R+E]=E<b?d[E]:bN[E-b]}E=this.items.length=this.length-=g-b;while(this[E]){delete this[E++]}return new bk(bO)};bm.exclude=function(b){for(var d=0,g=this.length;d<g;d++){if(this[d]==b){this.splice(d,1);return true}}};bm.animate=function(bP,bO,E,d){(ba.is(E,"function")||!E)&&(d=E||null);var bN=this.items.length,R=bN,S,bQ=this,g;if(!bN){return this}d&&(g=function(){!--bN&&d.call(bQ)});E=ba.is(E,bu)?E:g;var b=ba.animation(bP,bO,E,g);S=this.items[--R].animate(b);while(R--){this.items[R]&&!this.items[R].removed&&this.items[R].animateWith(S,b,b)}return this};bm.insertAfter=function(b){var d=this.items.length;while(d--){this.items[d].insertAfter(b)}return this};bm.getBBox=function(){var g=[],R=[],E=[],S=[];for(var d=this.items.length;d--;){if(!this.items[d].removed){var b=this.items[d].getBBox();g.push(b.x);R.push(b.y);E.push(b.x+b.width);S.push(b.y+b.height)}}g=aI[l](0,g);R=aI[l](0,R);E=aH[l](0,E);S=aH[l](0,S);return{x:g,y:R,x2:E,y2:S,width:E-g,height:S-R}};bm.clone=function(g){g=new bk;for(var b=0,d=this.items.length;b<d;b++){g.push(this.items[b].clone())}return g};bm.toString=function(){return"Rapha\xebl\u2018s set"};ba.registerFont=function(d){if(!d.face){return d}this.fonts=this.fonts||{};var g={w:d.w,face:{},glyphs:{}},b=d.face["font-family"];for(var bN in d.face){if(d.face[al](bN)){g.face[bN]=d.face[bN]}}if(this.fonts[b]){this.fonts[b].push(g)}else{this.fonts[b]=[g]}if(!d.svg){g.face["units-per-em"]=bC(d.face["units-per-em"],10);for(var E in d.glyphs){if(d.glyphs[al](E)){var S=d.glyphs[E];g.glyphs[E]={w:S.w,k:{},d:S.d&&"M"+S.d.replace(/[mlcxtrv]/g,function(bO){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[bO]||"M"})+"z"};if(S.k){for(var R in S.k){if(S[al](R)){g.glyphs[E].k[R]=S.k[R]}}}}}}return d};aQ.getFont=function(b,bQ,bO,bN){bN=bN||"normal";bO=bO||"normal";bQ=+bQ||{normal:400,bold:700,lighter:300,bolder:800}[bQ]||400;if(!ba.fonts){return}var d=ba.fonts[b];if(!d){var S=new RegExp("(^|\\s)"+b.replace(/[^\w\d\s+!~.:_-]/g,M)+"(\\s|$)","i");for(var g in ba.fonts){if(ba.fonts[al](g)){if(S.test(g)){d=ba.fonts[g];break}}}}var bP;if(d){for(var E=0,R=d.length;E<R;E++){bP=d[E];if(bP.face["font-weight"]==bQ&&(bP.face["font-style"]==bO||!bP.face["font-style"])&&bP.face["font-stretch"]==bN){break}}}return bP};aQ.print=function(b0,b1,bY,g,bX,bR,bN){bR=bR||"middle";bN=aH(aI(bN||0,1),-1);var bO=bt(bY)[bp](M),bV=0,bQ=0,bS=M,bU;ba.is(g,bY)&&(g=this.getFont(g));if(g){bU=(bX||16)/g.face["units-per-em"];var b=g.face.bbox[bp](bj),bZ=+b[0],bP=b[3]-b[1],bW=0,E=+b[1]+(bR=="baseline"?bP+(+g.face.descent):bP/2);for(var R=0,S=bO.length;R<S;R++){if(bO[R]=="\n"){bV=0;d=0;bQ=0;bW+=bP}else{var bT=bQ&&g.glyphs[bO[R-1]]||{},d=g.glyphs[bO[R]];bV+=bQ?(bT.w||g.w)+(bT.k&&bT.k[bO[R]]||0)+(g.w*bN):0;bQ=1}if(d&&d.d){bS+=ba.transformPath(d.d,["t",bV*bU,bW*bU,"s",bU,bU,bZ,E,"t",(b0-bZ)/bU,(b1-E)/bU])}}}return this.path(bS).attr({fill:"#000",stroke:"none"})};aQ.add=function(E){if(ba.is(E,"array")){var R=this.set(),b=0,d=E.length,g;for(;b<d;b++){g=E[b]||{};P[al](g.type)&&R.push(this[g.type]().attr(g))}}return R};ba.format=function(g,d){var b=ba.is(d,m)?[0][B](d):arguments;g&&ba.is(g,bu)&&b.length-1&&(g=g.replace(Z,function(R,E){return b[++E]==null?M:b[E]}));return g||M};ba.fullfill=(function(){var g=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,d=function(E,R,S){var bN=S;R.replace(b,function(bO,bQ,bR,bS,bP){bQ=bQ||bS;if(bN){if(bQ in bN){bN=bN[bQ]}typeof bN=="function"&&bP&&(bN=bN())}});bN=(bN==null||bN==S?E:bN)+"";return bN};return function(R,E){return String(R).replace(g,function(S,bN){return d(S,bN,E)})}})();ba.ninja=function(){aL.was?(ab.win.Raphael=aL.is):delete Raphael;return ba};ba.st=bm;(function(b,E,d){if(b.readyState==null&&b.addEventListener){b.addEventListener(E,d=function(){b.removeEventListener(E,d,false);b.readyState="complete"},false);b.readyState="loading"}function g(){(/in/).test(b.readyState)?setTimeout(g,9):ba.eve("raphael.DOMload")}g()})(document,"DOMContentLoaded");aL.was?(ab.win.Raphael=ba):(Raphael=ba);eve.on("raphael.DOMload",function(){aB=true})})();window.Raphael.svg&&function(v){var l="hasOwnProperty",A=String,B=parseFloat,C=parseInt,q=Math,s=q.max,b=q.abs,u=q.pow,x=/[, ]+/,k=v.eve,g="",w=" ";var G="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},n={};v.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var a=function(H,E){if(E){if(typeof H=="string"){H=a(H)}for(var I in E){if(E[l](I)){if(I.substring(0,6)=="xlink:"){H.setAttributeNS(G,I.substring(6),A(E[I]))}else{H.setAttribute(I,A(E[I]))}}}}else{H=v._g.doc.createElementNS("http://www.w3.org/2000/svg",H);H.style&&(H.style.webkitTapHighlightColor="rgba(0,0,0,0)")}return H},e=function(J,M){var U="linear",O=J.id+M,K=0.5,L=0.5,R=J.node,T=J.paper,S=R.style,I=v._g.doc.getElementById(O);if(!I){M=A(M).replace(v._radial_gradient,function(Y,W,X){U="radial";if(W&&X){K=B(W);L=B(X);var Z=((L>0.5)*2-1);u(K-0.5,2)+u(L-0.5,2)>0.25&&(L=q.sqrt(0.25-u(K-0.5,2))*Z+0.5)&&L!=0.5&&(L=L.toFixed(5)-1e-05*Z)}return g});M=M.split(/\s*\-\s*/);if(U=="linear"){var E=M.shift();E=-B(E);if(isNaN(E)){return null}var V=[0,0,q.cos(v.rad(E)),q.sin(v.rad(E))],Q=1/(s(b(V[2]),b(V[3]))||1);V[2]*=Q;V[3]*=Q;if(V[2]<0){V[0]=-V[2];V[2]=0}if(V[3]<0){V[1]=-V[3];V[3]=0}}var H=v._parseDots(M);if(!H){return null}O=O.replace(/[\(\)\s,\xb0#]/g,"_");if(J.gradient&&O!=J.gradient.id){T.defs.removeChild(J.gradient);delete J.gradient}if(!J.gradient){I=a(U+"Gradient",{id:O});J.gradient=I;a(I,U=="radial"?{fx:K,fy:L}:{x1:V[0],y1:V[1],x2:V[2],y2:V[3],gradientTransform:J.matrix.invert()});T.defs.appendChild(I);for(var N=0,P=H.length;N<P;N++){I.appendChild(a("stop",{offset:H[N].offset?H[N].offset:N?"100%":"0%","stop-color":H[N].color||"#fff"}))}}}a(R,{fill:"url(#"+O+")",opacity:1,"fill-opacity":1});S.fill=g;S.opacity=1;S.fillOpacity=1;return 1},F=function(H){var E=H.getBBox(1);a(H.pattern,{patternTransform:H.matrix.invert()+" translate("+E.x+","+E.y+")"})},c=function(S,ac,N){if(S.type=="path"){var ad=A(ac).toLowerCase().split("-"),T=S.paper,W=N?"end":"start",R=S.node,H=S.attrs,X=H["stroke-width"],M=ad.length,aa="classic",K,Z,J,V,E,ae=3,L=3,Y=5;while(M--){switch(ad[M]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":aa=ad[M];break;case"wide":L=5;break;case"narrow":L=2;break;case"long":ae=5;break;case"short":ae=2;break}}if(aa=="open"){ae+=2;L+=2;Y+=2;J=1;V=N?4:1;E={fill:"none",stroke:H.stroke}}else{V=J=ae/2;E={fill:H.stroke,stroke:"none"}}if(S._.arrows){if(N){S._.arrows.endPath&&n[S._.arrows.endPath]--;S._.arrows.endMarker&&n[S._.arrows.endMarker]--}else{S._.arrows.startPath&&n[S._.arrows.startPath]--;S._.arrows.startMarker&&n[S._.arrows.startMarker]--}}else{S._.arrows={}}if(aa!="none"){var U="raphael-marker-"+aa,Q="raphael-marker-"+W+aa+ae+L;if(!v._g.doc.getElementById(U)){T.defs.appendChild(a(a("path"),{"stroke-linecap":"round",d:o[aa],id:U}));n[U]=1}else{n[U]++}var P=v._g.doc.getElementById(Q),ab;if(!P){P=a(a("marker"),{id:Q,markerHeight:L,markerWidth:ae,orient:"auto",refX:V,refY:L/2});ab=a(a("use"),{"xlink:href":"#"+U,transform:(N?"rotate(180 "+ae/2+" "+L/2+") ":g)+"scale("+ae/Y+","+L/Y+")","stroke-width":(1/((ae/Y+L/Y)/2)).toFixed(4)});P.appendChild(ab);T.defs.appendChild(P);n[Q]=1}else{n[Q]++;ab=P.getElementsByTagName("use")[0]}a(ab,E);var I=J*(aa!="diamond"&&aa!="oval");if(N){K=S._.arrows.startdx*X||0;Z=v.getTotalLength(H.path)-I*X}else{K=I*X;Z=v.getTotalLength(H.path)-(S._.arrows.enddx*X||0)}E={};E["marker-"+W]="url(#"+Q+")";if(Z||K){E.d=Raphael.getSubpath(H.path,K,Z)}a(R,E);S._.arrows[W+"Path"]=U;S._.arrows[W+"Marker"]=Q;S._.arrows[W+"dx"]=I;S._.arrows[W+"Type"]=aa;S._.arrows[W+"String"]=ac}else{if(N){K=S._.arrows.startdx*X||0;Z=v.getTotalLength(H.path)-K}else{K=0;Z=v.getTotalLength(H.path)-(S._.arrows.enddx*X||0)}S._.arrows[W+"Path"]&&a(R,{d:Raphael.getSubpath(H.path,K,Z)});delete S._.arrows[W+"Path"];delete S._.arrows[W+"Marker"];delete S._.arrows[W+"dx"];delete S._.arrows[W+"Type"];delete S._.arrows[W+"String"]}for(E in n){if(n[l](E)&&!n[E]){var O=v._g.doc.getElementById(E);O&&O.parentNode.removeChild(O)}}}},f={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},d=function(J,L,K){L=f[A(L).toLowerCase()];if(L){var M=J.attrs["stroke-width"]||"1",E={round:M,square:M,butt:0}[J.attrs["stroke-linecap"]||K["stroke-linecap"]]||0,H=[],I=L.length;while(I--){H[I]=L[I]*M+((I%2)?1:-1)*E}a(J.node,{"stroke-dasharray":H.join(",")})}},y=function(R,S){var Q=R.node,H=R.attrs,Z=Q.style.visibility;Q.style.visibility="hidden";for(var E in S){if(S[l](E)){if(!v._availableAttrs[l](E)){continue}var Y=S[E];H[E]=Y;switch(E){case"blur":R.blur(Y);break;case"href":case"title":case"target":var U=Q.parentNode;if(U.tagName.toLowerCase()!="a"){var N=a("a");U.insertBefore(N,Q);N.appendChild(Q);U=N}if(E=="target"){U.setAttributeNS(G,"show",Y=="blank"?"new":Y)}else{U.setAttributeNS(G,E,Y)}break;case"cursor":Q.style.cursor=Y;break;case"transform":R.transform(Y);break;case"arrow-start":c(R,Y);break;case"arrow-end":c(R,Y,1);break;case"clip-rect":var W=A(Y).split(x);if(W.length==4){R.clip&&R.clip.parentNode.parentNode.removeChild(R.clip.parentNode);var L=a("clipPath"),V=a("rect");L.id=v.createUUID();a(V,{x:W[0],y:W[1],width:W[2],height:W[3]});L.appendChild(V);R.paper.defs.appendChild(L);a(Q,{"clip-path":"url(#"+L.id+")"});R.clip=V}if(!Y){var T=Q.getAttribute("clip-path");if(T){var I=v._g.doc.getElementById(T.replace(/(^url\(#|\)$)/g,g));I&&I.parentNode.removeChild(I);a(Q,{"clip-path":g});delete R.clip}}break;case"path":if(R.type=="path"){a(Q,{d:Y?H.path=v._pathToAbsolute(Y):"M0,0"});R._.dirty=1;if(R._.arrows){"startString" in R._.arrows&&c(R,R._.arrows.startString);"endString" in R._.arrows&&c(R,R._.arrows.endString,1)}}break;case"width":Q.setAttribute(E,Y);R._.dirty=1;if(H.fx){E="x";Y=H.x}else{break}case"x":if(H.fx){Y=-H.x-(H.width||0)}case"rx":if(E=="rx"&&R.type=="rect"){break}case"cx":Q.setAttribute(E,Y);R.pattern&&F(R);R._.dirty=1;break;case"height":Q.setAttribute(E,Y);R._.dirty=1;if(H.fy){E="y";Y=H.y}else{break}case"y":if(H.fy){Y=-H.y-(H.height||0)}case"ry":if(E=="ry"&&R.type=="rect"){break}case"cy":Q.setAttribute(E,Y);R.pattern&&F(R);R._.dirty=1;break;case"r":if(R.type=="rect"){a(Q,{rx:Y,ry:Y})}else{Q.setAttribute(E,Y)}R._.dirty=1;break;case"src":if(R.type=="image"){Q.setAttributeNS(G,"href",Y)}break;case"stroke-width":if(R._.sx!=1||R._.sy!=1){Y/=s(b(R._.sx),b(R._.sy))||1}if(R.paper._vbSize){Y*=R.paper._vbSize}Q.setAttribute(E,Y);if(H["stroke-dasharray"]){d(R,H["stroke-dasharray"],S)}if(R._.arrows){"startString" in R._.arrows&&c(R,R._.arrows.startString);"endString" in R._.arrows&&c(R,R._.arrows.endString,1)}break;case"stroke-dasharray":d(R,Y,S);break;case"fill":var P=A(Y).match(v._ISURL);if(P){L=a("pattern");var O=a("image");L.id=v.createUUID();a(L,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});a(O,{x:0,y:0,"xlink:href":P[1]});L.appendChild(O);(function(aa){v._preload(P[1],function(){var ac=this.offsetWidth,ab=this.offsetHeight;a(aa,{width:ac,height:ab});a(O,{width:ac,height:ab});R.paper.safari()})})(L);R.paper.defs.appendChild(L);a(Q,{fill:"url(#"+L.id+")"});R.pattern=L;R.pattern&&F(R);break}var J=v.getRGB(Y);if(!J.error){delete S.gradient;delete H.gradient;!v.is(H.opacity,"undefined")&&v.is(S.opacity,"undefined")&&a(Q,{opacity:H.opacity});!v.is(H["fill-opacity"],"undefined")&&v.is(S["fill-opacity"],"undefined")&&a(Q,{"fill-opacity":H["fill-opacity"]})}else{if((R.type=="circle"||R.type=="ellipse"||A(Y).charAt()!="r")&&e(R,Y)){if("opacity" in H||"fill-opacity" in H){var M=v._g.doc.getElementById(Q.getAttribute("fill").replace(/^url\(#|\)$/g,g));if(M){var X=M.getElementsByTagName("stop");a(X[X.length-1],{"stop-opacity":("opacity" in H?H.opacity:1)*("fill-opacity" in H?H["fill-opacity"]:1)})}}H.gradient=Y;H.fill="none";break}}J[l]("opacity")&&a(Q,{"fill-opacity":J.opacity>1?J.opacity/100:J.opacity});case"stroke":J=v.getRGB(Y);Q.setAttribute(E,J.hex);E=="stroke"&&J[l]("opacity")&&a(Q,{"stroke-opacity":J.opacity>1?J.opacity/100:J.opacity});if(E=="stroke"&&R._.arrows){"startString" in R._.arrows&&c(R,R._.arrows.startString);"endString" in R._.arrows&&c(R,R._.arrows.endString,1)}break;case"gradient":(R.type=="circle"||R.type=="ellipse"||A(Y).charAt()!="r")&&e(R,Y);break;case"opacity":if(H.gradient&&!H[l]("stroke-opacity")){a(Q,{"stroke-opacity":Y>1?Y/100:Y})}case"fill-opacity":if(H.gradient){M=v._g.doc.getElementById(Q.getAttribute("fill").replace(/^url\(#|\)$/g,g));if(M){X=M.getElementsByTagName("stop");a(X[X.length-1],{"stop-opacity":Y})}break}default:E=="font-size"&&(Y=C(Y,10)+"px");var K=E.replace(/(\-.)/g,function(aa){return aa.substring(1).toUpperCase()});Q.style[K]=Y;R._.dirty=1;Q.setAttribute(E,Y);break}}}D(R,S);Q.style.visibility=Z},m=1.2,D=function(J,O){if(J.type!="text"||!(O[l]("text")||O[l]("font")||O[l]("font-size")||O[l]("x")||O[l]("y"))){return}var E=J.attrs,N=J.node,K=N.firstChild?C(v._g.doc.defaultView.getComputedStyle(N.firstChild,g).getPropertyValue("font-size"),10):10;if(O[l]("text")){E.text=O.text;while(N.firstChild){N.removeChild(N.firstChild)}var P=A(O.text).split("\n"),R=[],Q;for(var L=0,M=P.length;L<M;L++){Q=a("tspan");L&&a(Q,{dy:K*m,x:E.x});Q.appendChild(v._g.doc.createTextNode(P[L]));N.appendChild(Q);R[L]=Q}}else{R=N.getElementsByTagName("tspan");for(L=0,M=R.length;L<M;L++){if(L){a(R[L],{dy:K*m,x:E.x})}else{a(R[0],{dy:0})}}}a(N,{x:E.x,y:E.y});J._.dirty=1;var H=J._getBBox(),I=E.y-(H.y+H.height/2);I&&v.is(I,"finite")&&a(R[0],{dy:I})},h=function(E,H){var I=0,J=0;this[0]=this.node=E;E.raphael=true;this.id=v._oid++;E.raphaelid=this.id;this.matrix=v.matrix();this.realPath=null;this.paper=H;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!H.bottom&&(H.bottom=this);this.prev=H.top;H.top&&(H.top.next=this);H.top=this;this.next=null},j=v.el;h.prototype=j;j.constructor=h;v._engine.path=function(I,J){var E=a("path");J.canvas&&J.canvas.appendChild(E);var H=new h(E,J);H.type="path";y(H,{fill:"none",stroke:"#000",path:I});return H};j.rotate=function(J,H,I){if(this.removed){return this}J=A(J).split(x);if(J.length-1){H=B(J[1]);I=B(J[2])}J=B(J[0]);(I==null)&&(H=I);if(H==null||I==null){var E=this.getBBox(1);H=E.x+E.width/2;I=E.y+E.height/2}this.transform(this._.transform.concat([["r",J,H,I]]));return this};j.scale=function(J,K,H,I){if(this.removed){return this}J=A(J).split(x);if(J.length-1){K=B(J[1]);H=B(J[2]);I=B(J[3])}J=B(J[0]);(K==null)&&(K=J);(I==null)&&(H=I);if(H==null||I==null){var E=this.getBBox(1)}H=H==null?E.x+E.width/2:H;I=I==null?E.y+E.height/2:I;this.transform(this._.transform.concat([["s",J,K,H,I]]));return this};j.translate=function(E,H){if(this.removed){return this}E=A(E).split(x);if(E.length-1){H=B(E[1])}E=B(E[0])||0;H=+H||0;this.transform(this._.transform.concat([["t",E,H]]));return this};j.transform=function(I){var E=this._;if(I==null){return E.transform}v._extractTransform(this,I);this.clip&&a(this.clip,{transform:this.matrix.invert()});this.pattern&&F(this);this.node&&a(this.node,{transform:this.matrix});if(E.sx!=1||E.sy!=1){var H=this.attrs[l]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":H})}return this};j.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this};j.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};j.remove=function(){if(this.removed||!this.node.parentNode){return}var H=this.paper;H.__set__&&H.__set__.exclude(this);k.unbind("raphael.*.*."+this.id);if(this.gradient){H.defs.removeChild(this.gradient)}v._tear(this,H);if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.removeChild(this.node.parentNode)}else{this.node.parentNode.removeChild(this.node)}for(var E in this){this[E]=typeof this[E]=="function"?v._removedFactory(E):null}this.removed=true};j._getBBox=function(){if(this.node.style.display=="none"){this.show();var I=true}var E={};try{E=this.node.getBBox()}catch(H){}finally{E=E||{}}I&&this.hide();return E};j.attr=function(K,R){if(this.removed){return this}if(K==null){var P={};for(var E in this.attrs){if(this.attrs[l](E)){P[E]=this.attrs[E]}}P.gradient&&P.fill=="none"&&(P.fill=P.gradient)&&delete P.gradient;P.transform=this._.transform;return P}if(R==null&&v.is(K,"string")){if(K=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}if(K=="transform"){return this._.transform}var L=K.split(x),M={};for(var H=0,I=L.length;H<I;H++){K=L[H];if(K in this.attrs){M[K]=this.attrs[K]}else{if(v.is(this.paper.customAttributes[K],"function")){M[K]=this.paper.customAttributes[K].def}else{M[K]=v._availableAttrs[K]}}}return I-1?M:M[L[0]]}if(R==null&&v.is(K,"array")){M={};for(H=0,I=K.length;H<I;H++){M[K[H]]=this.attr(K[H])}return M}if(R!=null){var O={};O[K]=R}else{if(K!=null&&v.is(K,"object")){O=K}}for(var J in O){k("raphael.attr."+J+"."+this.id,this,O[J])}for(J in this.paper.customAttributes){if(this.paper.customAttributes[l](J)&&O[l](J)&&v.is(this.paper.customAttributes[J],"function")){var N=this.paper.customAttributes[J].apply(this,[].concat(O[J]));this.attrs[J]=O[J];for(var Q in N){if(N[l](Q)){O[Q]=N[Q]}}}}y(this,O);return this};j.toFront=function(){if(this.removed){return this}if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.appendChild(this.node.parentNode)}else{this.node.parentNode.appendChild(this.node)}var E=this.paper;E.top!=this&&v._tofront(this,E);return this};j.toBack=function(){if(this.removed){return this}var E=this.node.parentNode;if(E.tagName.toLowerCase()=="a"){E.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild)}else{if(E.firstChild!=this.node){E.insertBefore(this.node,this.node.parentNode.firstChild)}}v._toback(this,this.paper);var H=this.paper;return this};j.insertAfter=function(E){if(this.removed){return this}var H=E.node||E[E.length-1].node;if(H.nextSibling){H.parentNode.insertBefore(this.node,H.nextSibling)}else{H.parentNode.appendChild(this.node)}v._insertafter(this,E,this.paper);return this};j.insertBefore=function(E){if(this.removed){return this}var H=E.node||E[0].node;H.parentNode.insertBefore(this.node,H);v._insertbefore(this,E,this.paper);return this};j.blur=function(I){var J=this;if(+I!==0){var H=a("filter"),E=a("feGaussianBlur");J.attrs.blur=I;H.id=v.createUUID();a(E,{stdDeviation:+I||1.5});H.appendChild(E);J.paper.defs.appendChild(H);J._blur=H;a(J.node,{filter:"url(#"+H.id+")"})}else{if(J._blur){J._blur.parentNode.removeChild(J._blur);delete J._blur;delete J.attrs.blur}J.node.removeAttribute("filter")}};v._engine.circle=function(J,K,L,H){var E=a("circle");J.canvas&&J.canvas.appendChild(E);var I=new h(E,J);I.attrs={cx:K,cy:L,r:H,fill:"none",stroke:"#000"};I.type="circle";a(E,I.attrs);return I};v._engine.rect=function(K,M,N,L,H,I){var E=a("rect");K.canvas&&K.canvas.appendChild(E);var J=new h(E,K);J.attrs={x:M,y:N,width:L,height:H,r:I||0,rx:I||0,ry:I||0,fill:"none",stroke:"#000"};J.type="rect";a(E,J.attrs);return J};v._engine.ellipse=function(K,L,M,I,J){var E=a("ellipse");K.canvas&&K.canvas.appendChild(E);var H=new h(E,K);H.attrs={cx:L,cy:M,rx:I,ry:J,fill:"none",stroke:"#000"};H.type="ellipse";a(E,H.attrs);return H};v._engine.image=function(K,J,M,N,L,H){var E=a("image");a(E,{x:M,y:N,width:L,height:H,preserveAspectRatio:"none"});E.setAttributeNS(G,"href",J);K.canvas&&K.canvas.appendChild(E);var I=new h(E,K);I.attrs={x:M,y:N,width:L,height:H,src:J};I.type="image";return I};v._engine.text=function(I,K,L,J){var E=a("text");I.canvas&&I.canvas.appendChild(E);var H=new h(E,I);H.attrs={x:K,y:L,"text-anchor":"middle",text:J,font:v._availableAttrs.font,stroke:"none",fill:"#000"};H.type="text";y(H,H.attrs);return H};v._engine.setSize=function(H,E){this.width=H||this.width;this.height=E||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);if(this._viewBox){this.setViewBox.apply(this,this._viewBox)}return this};v._engine.create=function(){var H=v._getContainer.apply(0,arguments),I=H&&H.container,N=H.x,O=H.y,M=H.width,K=H.height;if(!I){throw new Error("SVG container not found.")}var E=a("svg"),J="overflow:hidden;",L;N=N||0;O=O||0;M=M||512;K=K||342;a(E,{height:K,version:1.1,width:M,xmlns:"http://www.w3.org/2000/svg"});if(I==1){E.style.cssText=J+"position:absolute;left:"+N+"px;top:"+O+"px";v._g.doc.body.appendChild(E);L=1}else{E.style.cssText=J+"position:relative";if(I.firstChild){I.insertBefore(E,I.firstChild)}else{I.appendChild(E)}}I=new v._Paper;I.width=M;I.height=K;I.canvas=E;I.clear();I._left=I._top=0;L&&(I.renderfix=function(){});I.renderfix();return I};v._engine.setViewBox=function(O,P,N,I,H){k("raphael.setViewBox",this,this._viewBox,[O,P,N,I,H]);var J=s(N/this.width,I/this.height),L=this.top,E=H?"meet":"xMinYMin",M,K;if(O==null){if(this._vbSize){J=1}delete this._vbSize;M="0 0 "+this.width+w+this.height}else{this._vbSize=J;M=O+w+P+w+N+w+I}a(this.canvas,{viewBox:M,preserveAspectRatio:E});while(J&&L){K="stroke-width" in L.attrs?L.attrs["stroke-width"]:1;L.attr({"stroke-width":K});L._.dirty=1;L._.dirtyT=1;L=L.prev}this._viewBox=[O,P,N,I,!!H];return this};v.prototype.renderfix=function(){var E=this.canvas,K=E.style,J;try{J=E.getScreenCTM()||E.createSVGMatrix()}catch(H){J=E.createSVGMatrix()}var I=-J.e%1,L=-J.f%1;if(I||L){if(I){this._left=(this._left+I)%1;K.left=this._left+"px"}if(L){this._top=(this._top+L)%1;K.top=this._top+"px"}}};v.prototype.clear=function(){v.eve("raphael.clear",this);var E=this.canvas;while(E.firstChild){E.removeChild(E.firstChild)}this.bottom=this.top=null;(this.desc=a("desc")).appendChild(v._g.doc.createTextNode("Created with Rapha\xebl "+v.version));E.appendChild(this.desc);E.appendChild(this.defs=a("defs"))};v.prototype.remove=function(){k("raphael.remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var E in this){this[E]=typeof this[E]=="function"?v._removedFactory(E):null}};var z=v.st;for(var r in j){if(j[l](r)&&!z[l](r)){z[r]=(function(E){return function(){var H=arguments;return this.forEach(function(I){I[E].apply(I,H)})}})(r)}}}(window.Raphael);(function(a){Raphael.el.loop=function(b){var e={pkg:[{"stroke-width":3},{"stroke-width":1}],duration:200,repeat:false};a.extend(e,b);var c=this;function d(){c.animate(e.pkg[0],e.duration,function(){c.animate(e.pkg[1],e.duration,function(){if(e.repeat){d()}})})}d();return this}})(Slatebox);Raphael.el.button=function(){return this.attr({fill:"90-#000-#eee"})};Raphael.el.redbutton=function(){return this.attr({fill:"90-#990000-#eee"})};Raphael.el.buttonText=function(){return this.standard().attr({fill:"#fff"})};Raphael.el.activeColor="#fffc51";Raphael.el.active=function(a,b){var c={"stroke-width":2,stroke:this.activeColor};if(a){if(b===undefined){return this.animate(c,200)}else{return this.animate(c,100,b)}}else{return this.attr(c)}};Raphael.el.isDisabled=function(){if(this.type==="text"){return this.attr("fill")==="#eee"}else{return this.attr("fill")==="#ccc"}};Raphael.el.disabled=function(a,b){var c={fill:"#ccc",stroke:"eee"};var d={fill:"#eee"};if(this.type==="text"){return this.attr(d)}else{return this.attr(c)}};Raphael.el.enabled=function(a,b){if(this.type==="text"){return this.buttonText()}else{return this.button()}};Raphael.el.inactive=function(a,b){var c={"stroke-width":1,stroke:"#000"};if(a){if(b===undefined){return this.animate(c,200)}else{return this.animate(c,100,b)}}else{return this.attr(c)}};Raphael.el.standard=function(){return this.attr({"font-family":"Trebuchet MS","font-size":"13pt"})};

Raphael.el.tooltip=function(c,f,b){
	if(f===undefined){f=80}
	if(b===undefined){b=20}
	var a=this.paper.set();
	var d=this.getBBox();
	if(c.type==="text"){
		a.push(this.paper.rect(d.x,d.y+(b*-1)-10,f,b,5).attr({fill:"#fff"}));
		a.push(this.paper.text(d.x+5,d.y-20,"").attr({"stroke-width":1,"text-anchor":"start","font-size":13,fill:"#fff"}))
	}else{
		var g=(f*-1)-5;
		a.push(this.paper.rect(d.x+g,d.y+(b/2*-1),f,b,15).attr({"stroke-width":2,stroke:"#fff"}));
		a.push(this.paper.rect(d.x+g,d.y+(b/2-45),f,47,15)).attr({"stroke-width":2,fill:"90-#333-#000"});
		a.push(this.paper.text(d.x+g+(f/2),d.y+(b/2-20),"").attr({"text-anchor":"middle",stroke:"#fff","font-weight":"normal","font-family":"Verdana","font-size":11}))
	}
	var e=this;
	if(!e.removed){
		e.tt=a;
		if(c.type==="text"){
			e.tt[0].animate({stroke:"#000",fill:"#f00"},200,function(){
				e.tt[1].attr({text:c.msg}
				)}
			)
		}else{
			e.tt[0].animate({stroke:"#000",fill:"#f00"},200,function(){e.tt[2].attr({text:c.msg})})
		}
	}
	return e.tt
};

Raphael.el.untooltip=function(){this.tt.remove();return this};Raphael.fn.connection=function(a){var d={sb:Slatebox,parent:null,child:null,lineColor:"#fff",lineOpacity:1,lineWidth:10,blnStraight:false,showParentArrow:false,showChildArrow:false};d.sb.extend(d,a);function b(){var u=d.parent.vect.getBBox();var v=d.child.vect.getBBox();var m=(!isNaN(parseFloat(u.x))&&isFinite(u.x))&&u.x;var k=(!isNaN(parseFloat(u.cx))&&isFinite(u.cx))&&u.cx;var n=(!isNaN(parseFloat(u.y))&&isFinite(u.y))&&u.y;var l=(!isNaN(parseFloat(u.cy))&&isFinite(u.cy))&&u.cy;var g=(!isNaN(parseFloat(v.x))&&isFinite(v.x))&&v.x;var e=(!isNaN(parseFloat(v.cx))&&isFinite(v.cx))&&v.cx;var h=(!isNaN(parseFloat(v.y))&&isFinite(v.y))&&v.y;var f=(!isNaN(parseFloat(v.cy))&&isFinite(v.cy))&&v.cy;var C=[{x:(m||k)+u.width/2,y:(n||l)-1},{x:m+u.width/2,y:n+u.height+1},{x:m-1,y:n+u.height/2},{x:m+u.width+1,y:n+u.height/2},{x:g+v.width/2,y:h-1},{x:g+v.width/2,y:h+v.height+1},{x:g-1,y:h+v.height/2},{x:g+v.width+1,y:h+v.height/2}],w={},x=[];for(var A=0;A<4;A++){for(var B=4;B<8;B++){var y=Math.abs(C[A].x-C[B].x),z=Math.abs(C[A].y-C[B].y);if((A==B-4)||(((A!=3&&B!=6)||C[A].x<C[B].x)&&((A!=2&&B!=7)||C[A].x>C[B].x)&&((A!=0&&B!=5)||C[A].y>C[B].y)&&((A!=1&&B!=4)||C[A].y<C[B].y))){x.push(y+z);w[x[x.length-1]]=[A,B]}}}if(x.length==0){var E=[0,4]}else{E=w[Math.min.apply(Math,x)]}var H=C[E[0]].x,N=C[E[0]].y,L=C[E[1]].x,R=C[E[1]].y;y=Math.max(Math.abs(H-L)/2,10);z=Math.max(Math.abs(N-R)/2,10);var J=[H,H,H-y,H+y][E[0]].toFixed(3),P=[N-z,N+z,N,N][E[0]].toFixed(3),K=[0,0,0,0,L,L,L-y,L+y][E[1]].toFixed(3),Q=[0,0,0,0,N+z,N-z,R,R][E[1]].toFixed(3);var G=15;if(d.lineWidth>10){G=20}var F=2.4;var I=H.toFixed(3),M=L.toFixed(3),O=N.toFixed(3),S=R.toFixed(3);var D=["M",I,N.toFixed(3),"C",J,P,K,Q,M,S].join(",");if(d.blnStraight){M=(g+v.width/2);S=(h+v.height/2);D=["M",I,N.toFixed(3),"L",M,S].join(",")}if(d.showParentArrow){var o=Math.atan2(K-M,S-Q);if(d.blnStraight){o=Math.atan2(I-M,S-O)}o=(o/(2*Math.PI))*360}if(d.showChildArrow){var q=Math.atan2(M-K,Q-S);if(d.blnStraight){q=Math.atan2(M-I,O-S)}q=(q/(2*Math.PI))*360}var r="M"+L+" "+R+" L"+(L-G)+" "+(R-G/F)+" L"+(L-G)+" "+(R+G/F)+" L"+L+" "+R;var s="M"+H+" "+N+" L"+(H-G)+" "+(N-G/F)+" L"+(H-G)+" "+(N+G/F)+" L"+H+" "+N;return{path:D,parent:{arrowPath:r,arrowAngle:o,centerX:L,centerY:R},child:{arrowPath:s,arrowAngle:q,centerX:H,centerY:N}}}this.removeConnection=function(e){e.line.remove();if(e.showParentArrow){e.parentArrow.remove()}if(e.showChildArrow){e.childArrow.remove()}};var c=b();if(d.line===undefined){d.sb.extend(d,{line:this.path(c.path).attr({stroke:d.lineColor,fill:"none","stroke-width":d.lineWidth,"fill-opacity":d.lineOpacity,opacity:d.lineOpacity}),parentArrow:this.path(c.parent.arrowPath).attr({fill:d.lineColor,"fill-opacity":d.lineOpacity,stroke:"none",opacity:d.lineOpacity}).transform("r"+(90+c.parent.arrowAngle)+","+c.parent.centerX+","+c.parent.centerY),childArrow:this.path(c.child.arrowPath).attr({fill:d.lineColor,"fill-opacity":d.lineOpacity,stroke:"none",opacity:d.lineOpacity}).transform("r"+(90+c.child.arrowAngle)+","+c.child.centerX+","+c.child.centerY)});if(!d.showParentArrow){d.parentArrow.hide()}if(!d.showChildArrow){d.childArrow.hide()}}else{d.line.attr({path:c.path,stroke:d.lineColor,"stroke-width":d.lineWidth,"fill-opacity":d.lineOpacity,opacity:d.lineOpacity});if(d.showParentArrow){d.parentArrow.show();d.parentArrow.attr({path:c.parent.arrowPath,fill:d.lineColor,"stroke-width":d.lineWidth,"fill-opacity":d.lineOpacity,opacity:d.lineOpacity}).transform("r"+(90+c.parent.arrowAngle)+","+c.parent.centerX+","+c.parent.centerY)}else{if(d.parentArrow){d.parentArrow.hide()}}if(d.showChildArrow){d.childArrow.show();d.childArrow.attr({path:c.child.arrowPath,fill:d.lineColor,"stroke-width":d.lineWidth,"fill-opacity":d.lineOpacity,opacity:d.lineOpacity}).transform("r"+(90+c.child.arrowAngle)+","+c.child.centerX+","+c.child.centerY)}else{if(d.childArrow){d.childArrow.hide()}}}return d};(function(d){d.fn.handle=function(c,e){return this.path(b.handle+a)};d.fn.editor=function(c,e){return this.path(b.editor+a)};d.fn.deleter=function(c,e){return this.path(b.deleter+a)};d.fn.searcher=function(c,e){return this.path(b.searcher+a)};d.fn.link=function(c,e){return this.path(b.link+a)};d.fn.up=function(c,e){return this.path(b.up)};d.fn.down=function(c,e){return this.path(b.up).transform("r180")};d.fn.setting=function(c,e){return this.path(b.settings+a).transform("s,.9,.9")};d.fn.arrow=function(){return this.path(b.arrow+a)};d.fn.linkArrow=function(){return this.path(b.arrow+a).attr({fill:"#648CB2"})};d.fn.speechbubble=function(f,g,e){var c=this.set();c.push(this.path(b.speechbubble).transform(["t",f,",",g].join()).scale(6,4).scale(-1,1)).attr({fill:"#fff",stroke:"#000","stroke-width":3});c.push(this.text(f+10,g+10,e).attr({"font-size":12}));return c};d.fn.resize=function(c){return this.image(c,0,0,22,23)};d.fn.slider=function(m,r,j,l,q,o){var h=this.set();h.push(this.rect(10,10,10,m,5).attr({fill:"#ccc",stroke:"#333","stroke-width":2}));h.push(this.path(b.sliderHandle).attr({fill:"#eee",stroke:"#ccc"}).transform("r270"));h.setValue=function(v){var u=((v*m)/j);h[1].transform(["t",h[1].attr("x"),u,"r270"].join());f=h[1].attr("x"),c=h[1].attr("y"),g=u,e=0};var f,c,g,e=0;h.setValue(l);var k=function(u,v){};var n=function(v,w){w=g+w;if(w<0){w=0}if(w>m-15){w=m-15}e=w;h[1].transform(["t",f,w,"r270"].join());var u=(((w-c)*j)/m)+r;if(Slatebox.isFunction(q)){q.apply(this,[u])}};var s=function(){g=e-c;var u=((g*j)/m)+r;if(Slatebox.isFunction(q)){q.apply(this,[u])}if(Slatebox.isFunction(o)){o.apply(this,[u])}};h[1].drag(n,k,s);return h};var a="M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z";var b={handle:"M26.33,15.836l-3.893-1.545l3.136-7.9c0.28-0.705-0.064-1.505-0.771-1.785c-0.707-0.28-1.506,0.065-1.785,0.771l-3.136,7.9l-4.88-1.937l3.135-7.9c0.281-0.706-0.064-1.506-0.77-1.786c-0.706-0.279-1.506,0.065-1.785,0.771l-3.136,7.9L8.554,8.781l-1.614,4.066l2.15,0.854l-2.537,6.391c-0.61,1.54,0.143,3.283,1.683,3.895l1.626,0.646L8.985,26.84c-0.407,1.025,0.095,2.188,1.122,2.596l0.93,0.369c1.026,0.408,2.188-0.095,2.596-1.121l0.877-2.207l1.858,0.737c1.54,0.611,3.284-0.142,3.896-1.682l2.535-6.391l1.918,0.761L26.33,15.836z",editor:"M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z",deleter:"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z",searcher:"",up:"M1.67892,15.48059l23.55337,0l-11.37616,-13.92457l-12.17721,13.92457z",arrow:"M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM13.665,25.725l-3.536-3.539l6.187-6.187l-6.187-6.187l3.536-3.536l9.724,9.723L13.665,25.725z",settings:"M16.015,12.03c-2.156,0-3.903,1.747-3.903,3.903c0,2.155,1.747,3.903,3.903,3.903c0.494,0,0.962-0.102,1.397-0.27l0.836,1.285l1.359-0.885l-0.831-1.276c0.705-0.706,1.142-1.681,1.142-2.757C19.918,13.777,18.171,12.03,16.015,12.03zM16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM26.174,20.809c-0.241,0.504-0.513,0.99-0.826,1.45L22.19,21.58c-0.481,0.526-1.029,0.994-1.634,1.385l0.119,3.202c-0.507,0.23-1.028,0.421-1.569,0.57l-1.955-2.514c-0.372,0.051-0.75,0.086-1.136,0.086c-0.356,0-0.706-0.029-1.051-0.074l-1.945,2.5c-0.541-0.151-1.065-0.342-1.57-0.569l0.117-3.146c-0.634-0.398-1.208-0.88-1.712-1.427L6.78,22.251c-0.313-0.456-0.583-0.944-0.826-1.448l2.088-2.309c-0.226-0.703-0.354-1.451-0.385-2.223l-2.768-1.464c0.055-0.563,0.165-1.107,0.301-1.643l3.084-0.427c0.29-0.702,0.675-1.352,1.135-1.942L8.227,7.894c0.399-0.389,0.83-0.744,1.283-1.07l2.663,1.672c0.65-0.337,1.349-0.593,2.085-0.75l0.968-3.001c0.278-0.021,0.555-0.042,0.837-0.042c0.282,0,0.56,0.022,0.837,0.042l0.976,3.028c0.72,0.163,1.401,0.416,2.036,0.75l2.704-1.697c0.455,0.326,0.887,0.681,1.285,1.07l-1.216,2.986c0.428,0.564,0.793,1.181,1.068,1.845l3.185,0.441c0.135,0.535,0.247,1.081,0.302,1.643l-2.867,1.516c-0.034,0.726-0.15,1.43-0.355,2.1L26.174,20.809z",sliderHandle:"M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584z",speechbubble:"M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z",resizeMarker:"M -0.124,19.563999 19.440001,0M 3.891,20.542999 20.047001,4.3850002M 8.8249998,20.936001 20.936001,8.8249998",link:"",resizeMarker2:"M22.5,8.5v3.168l3.832,3.832L22.5,19.332V22.5l7-7L22.5,8.5zM8.5,22.5v-3.168L4.667,15.5L8.5,11.668V8.5l-7,7L8.5,22.5zM15.5,14.101c-0.928,0-1.68,0.751-1.68,1.68c0,0.927,0.752,1.681,1.68,1.681c0.927,0,1.68-0.754,1.68-1.681C17.18,14.852,16.427,14.101,15.5,14.101zM10.46,14.101c-0.928,0-1.68,0.751-1.68,1.68c0,0.927,0.752,1.681,1.68,1.681s1.68-0.754,1.68-1.681C12.14,14.852,11.388,14.101,10.46,14.101zM20.541,14.101c-0.928,0-1.682,0.751-1.682,1.68c0,0.927,0.754,1.681,1.682,1.681s1.68-0.754,1.68-1.681C22.221,14.852,21.469,14.101,20.541,14.101z"}})(Raphael);(function(a){Raphael.st.button=function(c){var f={mousedown:null,mouseover:null,node:{}};a.extend(f,c);var d=this,b=[];d.emd=function(g){_.invoke(b,"remove");f.mousedown.apply(this,[g,f.node])};d.emo=function(g){f.mouseover.apply(this,[g,f.node])};d.forEach(function(g){g.node.style.cursor="pointer";if(f.mousedown!==null){g.mousedown(d.emd)}if(f.mouseover!==null){g.mouseover(d.emo)}});d.gl=function(g){b.push(this.glow())};d.eg=function(g){_.invoke(b,"remove")};d.kg=function(g){_.invoke(b,"remove");b.push(g.glow())};var e=this[0];d.tmover=function(g){d.kg(e)};d.tmout=function(g){_.invoke(b,"remove")};d[0].mouseover(d.gl);d[0].mouseout(d.eg);d[1].mouseover(d.tmover);d[1].mouseout(d.tmout);return d}})(Slatebox);(function(a){Raphael.st.unbutton=function(){var b=this;b.forEach(function(c){c.unmousedown(b.emd);c.unmouseover(b.emo)});b[0].unmouseover(b.gl);b[0].unmouseout(b.eg);b[1].unmouseover(b.tmover);b[1].unmouseout(b.tmout);return b}})(Slatebox);